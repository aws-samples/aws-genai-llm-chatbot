// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`snapshot test with CMK 1`] = `
{
  "Description": "Description: (uksb-1tupboc45) (version:0.1.122) (tag:C1:0,C2:0,C3:0,C4:0,C5:0,C6:2,C7:0,C8:0) ",
  "Mappings": {
    "RagEnginesSageMakerModelImageRepositoryCfnMappingF3891114": {
      "af-south-1": {
        "account": "626614931356",
      },
      "ap-east-1": {
        "account": "871362719292",
      },
      "ap-northeast-1": {
        "account": "763104351884",
      },
      "ap-northeast-2": {
        "account": "763104351884",
      },
      "ap-northeast-3": {
        "account": "364406365360",
      },
      "ap-south-1": {
        "account": "763104351884",
      },
      "ap-south-2": {
        "account": "772153158452",
      },
      "ap-southeast-1": {
        "account": "763104351884",
      },
      "ap-southeast-2": {
        "account": "763104351884",
      },
      "ap-southeast-3": {
        "account": "907027046896",
      },
      "ap-southeast-4": {
        "account": "457447274322",
      },
      "ca-central-1": {
        "account": "763104351884",
      },
      "cn-north-1": {
        "account": "727897471807",
      },
      "cn-northwest-1": {
        "account": "727897471807",
      },
      "eu-central-1": {
        "account": "763104351884",
      },
      "eu-central-2": {
        "account": "380420809688",
      },
      "eu-north-1": {
        "account": "763104351884",
      },
      "eu-south-1": {
        "account": "692866216735",
      },
      "eu-south-2": {
        "account": "503227376785",
      },
      "eu-west-1": {
        "account": "763104351884",
      },
      "eu-west-2": {
        "account": "763104351884",
      },
      "eu-west-3": {
        "account": "763104351884",
      },
      "me-central-1": {
        "account": "914824155844",
      },
      "me-south-1": {
        "account": "217643126080",
      },
      "sa-east-1": {
        "account": "763104351884",
      },
      "us-east-1": {
        "account": "763104351884",
      },
      "us-east-2": {
        "account": "763104351884",
      },
      "us-gov-east-1": {
        "account": "446045086412",
      },
      "us-gov-west-1": {
        "account": "442386744353",
      },
      "us-iso-east-1": {
        "account": "886529160074",
      },
      "us-isob-east-1": {
        "account": "094389454867",
      },
      "us-west-1": {
        "account": "763104351884",
      },
      "us-west-2": {
        "account": "763104351884",
      },
    },
  },
  "Metadata": {
    "cdk_nag": {
      "rules_to_suppress": [
        {
          "id": "CdkNagValidationFailure",
          "reason": "Intrinstic function references.",
        },
        {
          "id": "AwsSolutions-L1",
          "reason": "Not yet upgraded from Python 3.11 to 3.12.",
        },
      ],
    },
  },
  "Outputs": {
    "AuthenticationUserPoolIdF0D106F7": {
      "Value": {
        "Ref": "AuthenticationUserPool28698864",
      },
    },
    "AuthenticationUserPoolLink55CE7EC4": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://us-east-1.console.aws.amazon.com/cognito/v2/idp/user-pools/",
            {
              "Ref": "AuthenticationUserPool28698864",
            },
            "/users?region=us-east-1",
          ],
        ],
      },
    },
    "AuthenticationUserPoolWebClientId80D5526A": {
      "Value": {
        "Ref": "AuthenticationUserPoolUserPoolClient8AE1704E",
      },
    },
    "ChatBotApiGraphqlAPIURL702C0AD7": {
      "Value": {
        "Fn::GetAtt": [
          "ChatBotApiChatbotApiBABF9B87",
          "GraphQLUrl",
        ],
      },
    },
    "ChatBotApiGraphqlapiIdF7B33EFE": {
      "Value": {
        "Fn::GetAtt": [
          "ChatBotApiChatbotApiBABF9B87",
          "ApiId",
        ],
      },
    },
    "IdeficsInterfaceChatbotFilesPrivateApiEndpoint914161CC": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Ref": "IdeficsInterfaceChatbotFilesPrivateApiA1587730",
            },
            ".execute-api.us-east-1.",
            {
              "Ref": "AWS::URLSuffix",
            },
            "/",
            {
              "Ref": "IdeficsInterfaceChatbotFilesPrivateApiDeploymentStageprodF1E02758",
            },
            "/",
          ],
        ],
      },
    },
    "SharedApiKeysSecretName3D265ECA": {
      "Value": {
        "Fn::Join": [
          "-",
          [
            {
              "Fn::Select": [
                0,
                {
                  "Fn::Split": [
                    "-",
                    {
                      "Fn::Select": [
                        6,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "SharedApiKeysSecret9EA666ED",
                            },
                          ],
                        },
                      ],
                    },
                  ],
                },
              ],
            },
            {
              "Fn::Select": [
                1,
                {
                  "Fn::Split": [
                    "-",
                    {
                      "Fn::Select": [
                        6,
                        {
                          "Fn::Split": [
                            ":",
                            {
                              "Ref": "SharedApiKeysSecret9EA666ED",
                            },
                          ],
                        },
                      ],
                    },
                  ],
                },
              ],
            },
          ],
        ],
      },
    },
    "UserInterfacePrivateWebsiteDomain028FEE0A": {
      "Value": "https://undefined",
    },
    "UserInterfacePrivateWebsiteLoadBalancerDNSA116C894": {
      "Value": {
        "Fn::GetAtt": [
          "UserInterfacePrivateWebsiteALB67ED856F",
          "DNSName",
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AWS679f53fac002430cb0da5b7982bd22872D164C4C": {
      "DependsOn": [
        "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Timeout": 120,
      },
      "Type": "AWS::Lambda::Function",
    },
    "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "AuthenticationUserPool28698864": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-COG1",
              "reason": "Default password policy requires min length of 8, digits, lowercase characters, symbols and uppercase characters: https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_cognito.PasswordPolicy.html",
            },
            {
              "id": "AwsSolutions-COG2",
              "reason": "MFA not required for user usage.",
            },
          ],
        },
      },
      "Properties": {
        "AccountRecoverySetting": {
          "RecoveryMechanisms": [
            {
              "Name": "verified_phone_number",
              "Priority": 1,
            },
            {
              "Name": "verified_email",
              "Priority": 2,
            },
          ],
        },
        "AdminCreateUserConfig": {
          "AllowAdminCreateUserOnly": true,
        },
        "AutoVerifiedAttributes": [
          "email",
          "phone_number",
        ],
        "EmailVerificationMessage": "The verification code to your new account is {####}",
        "EmailVerificationSubject": "Verify your new account",
        "EnabledMfas": [
          "SMS_MFA",
        ],
        "MfaConfiguration": "OPTIONAL",
        "SmsConfiguration": {
          "ExternalId": "prefixGenAIChatBotStackAuthenticationUserPoolAD499457",
          "SnsCallerArn": {
            "Fn::GetAtt": [
              "AuthenticationUserPoolsmsRole5227CBC5",
              "Arn",
            ],
          },
        },
        "SmsVerificationMessage": "The verification code to your new account is {####}",
        "UserPoolAddOns": {
          "AdvancedSecurityMode": "ENFORCED",
        },
        "UsernameAttributes": [
          "email",
        ],
        "VerificationMessageTemplate": {
          "DefaultEmailOption": "CONFIRM_WITH_CODE",
          "EmailMessage": "The verification code to your new account is {####}",
          "EmailSubject": "Verify your new account",
          "SmsMessage": "The verification code to your new account is {####}",
        },
      },
      "Type": "AWS::Cognito::UserPool",
      "UpdateReplacePolicy": "Retain",
    },
    "AuthenticationUserPoolUserPoolClient8AE1704E": {
      "Properties": {
        "AllowedOAuthFlows": [
          "implicit",
          "code",
        ],
        "AllowedOAuthFlowsUserPoolClient": true,
        "AllowedOAuthScopes": [
          "profile",
          "phone",
          "email",
          "openid",
          "aws.cognito.signin.user.admin",
        ],
        "CallbackURLs": [
          "https://example.com",
        ],
        "ExplicitAuthFlows": [
          "ALLOW_USER_PASSWORD_AUTH",
          "ALLOW_ADMIN_USER_PASSWORD_AUTH",
          "ALLOW_USER_SRP_AUTH",
          "ALLOW_REFRESH_TOKEN_AUTH",
        ],
        "GenerateSecret": false,
        "SupportedIdentityProviders": [
          "COGNITO",
        ],
        "UserPoolId": {
          "Ref": "AuthenticationUserPool28698864",
        },
      },
      "Type": "AWS::Cognito::UserPoolClient",
    },
    "AuthenticationUserPoolsmsRole5227CBC5": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Condition": {
                "StringEquals": {
                  "sts:ExternalId": "prefixGenAIChatBotStackAuthenticationUserPoolAD499457",
                },
              },
              "Effect": "Allow",
              "Principal": {
                "Service": "cognito-idp.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": "sns:Publish",
                  "Effect": "Allow",
                  "Resource": "*",
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "sns-publish",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "BucketNotificationsHandler050a0587b7544547bf325f094a3db8347ECC3691": {
      "DependsOn": [
        "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleDefaultPolicy2CF63D36",
        "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC",
      ],
      "Properties": {
        "Code": {
          "ZipFile": "import boto3  # type: ignore
import json
import logging
import urllib.request

s3 = boto3.client("s3")

EVENTBRIDGE_CONFIGURATION = 'EventBridgeConfiguration'
CONFIGURATION_TYPES = ["TopicConfigurations", "QueueConfigurations", "LambdaFunctionConfigurations"]

def handler(event: dict, context):
  response_status = "SUCCESS"
  error_message = ""
  try:
    props = event["ResourceProperties"]
    notification_configuration = props["NotificationConfiguration"]
    managed = props.get('Managed', 'true').lower() == 'true'
    skipDestinationValidation = props.get('SkipDestinationValidation', 'false').lower() == 'true'
    stack_id = event['StackId']
    old = event.get("OldResourceProperties", {}).get("NotificationConfiguration", {})
    if managed:
      config = handle_managed(event["RequestType"], notification_configuration)
    else:
      config = handle_unmanaged(props["BucketName"], stack_id, event["RequestType"], notification_configuration, old)
    s3.put_bucket_notification_configuration(Bucket=props["BucketName"], NotificationConfiguration=config, SkipDestinationValidation=skipDestinationValidation)
  except Exception as e:
    logging.exception("Failed to put bucket notification configuration")
    response_status = "FAILED"
    error_message = f"Error: {str(e)}. "
  finally:
    submit_response(event, context, response_status, error_message)

def handle_managed(request_type, notification_configuration):
  if request_type == 'Delete':
    return {}
  return notification_configuration

def handle_unmanaged(bucket, stack_id, request_type, notification_configuration, old):
  def get_id(n):
    n['Id'] = ''
    strToHash=json.dumps(n, sort_keys=True).replace('"Name": "prefix"', '"Name": "Prefix"').replace('"Name": "suffix"', '"Name": "Suffix"')
    return f"{stack_id}-{hash(strToHash)}"
  def with_id(n):
    n['Id'] = get_id(n)
    return n

  external_notifications = {}
  existing_notifications = s3.get_bucket_notification_configuration(Bucket=bucket)
  for t in CONFIGURATION_TYPES:
    if request_type == 'Update':
        old_incoming_ids = [get_id(n) for n in old.get(t, [])]
        external_notifications[t] = [n for n in existing_notifications.get(t, []) if not get_id(n) in old_incoming_ids]      
    elif request_type == 'Delete':
        external_notifications[t] = [n for n in existing_notifications.get(t, []) if not n['Id'].startswith(f"{stack_id}-")]
    elif request_type == 'Create':
        external_notifications[t] = [n for n in existing_notifications.get(t, [])]
  if EVENTBRIDGE_CONFIGURATION in existing_notifications:
    external_notifications[EVENTBRIDGE_CONFIGURATION] = existing_notifications[EVENTBRIDGE_CONFIGURATION]

  if request_type == 'Delete':
    return external_notifications

  notifications = {}
  for t in CONFIGURATION_TYPES:
    external = external_notifications.get(t, [])
    incoming = [with_id(n) for n in notification_configuration.get(t, [])]
    notifications[t] = external + incoming

  if EVENTBRIDGE_CONFIGURATION in notification_configuration:
    notifications[EVENTBRIDGE_CONFIGURATION] = notification_configuration[EVENTBRIDGE_CONFIGURATION]
  elif EVENTBRIDGE_CONFIGURATION in external_notifications:
    notifications[EVENTBRIDGE_CONFIGURATION] = external_notifications[EVENTBRIDGE_CONFIGURATION]

  return notifications

def submit_response(event: dict, context, response_status: str, error_message: str):
  response_body = json.dumps(
    {
      "Status": response_status,
      "Reason": f"{error_message}See the details in CloudWatch Log Stream: {context.log_stream_name}",
      "PhysicalResourceId": event.get("PhysicalResourceId") or event["LogicalResourceId"],
      "StackId": event["StackId"],
      "RequestId": event["RequestId"],
      "LogicalResourceId": event["LogicalResourceId"],
      "NoEcho": False,
    }
  ).encode("utf-8")
  headers = {"content-type": "", "content-length": str(len(response_body))}
  try:
    req = urllib.request.Request(url=event["ResponseURL"], headers=headers, data=response_body, method="PUT")
    with urllib.request.urlopen(req) as response:
      print(response.read().decode("utf-8"))
    print("Status code: " + response.reason)
  except Exception as e:
      print("send(..) failed executing request.urlopen(..): " + str(e))",
        },
        "Description": "AWS CloudFormation handler for "Custom::S3BucketNotifications" resources (@aws-cdk/aws-s3)",
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
        "Timeout": 300,
      },
      "Type": "AWS::Lambda::Function",
    },
    "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleDefaultPolicy2CF63D36": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:PutBucketNotification",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleDefaultPolicy2CF63D36",
        "Roles": [
          {
            "Ref": "BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ChatBotApiChatBucketsFilesBucket1D4E273A": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "AccelerateConfiguration": {
          "AccelerationStatus": "Enabled",
        },
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "KMSMasterKeyID": {
                  "Fn::GetAtt": [
                    "SharedKMSKey7BCBB616",
                    "Arn",
                  ],
                },
                "SSEAlgorithm": "aws:kms",
              },
            },
          ],
        },
        "CorsConfiguration": {
          "CorsRules": [
            {
              "AllowedHeaders": [
                "*",
              ],
              "AllowedMethods": [
                "PUT",
                "POST",
                "GET",
                "HEAD",
              ],
              "AllowedOrigins": [
                "*",
              ],
              "ExposedHeaders": [
                "ETag",
              ],
              "MaxAge": 3000,
            },
            {
              "AllowedHeaders": [
                "*",
              ],
              "AllowedMethods": [
                "GET",
                "PUT",
                "POST",
                "DELETE",
              ],
              "AllowedOrigins": [
                "*",
              ],
              "ExposedHeaders": [
                "x-amz-server-side-encryption",
                "x-amz-request-id",
                "x-amz-id-2",
                "ETag",
              ],
              "MaxAge": 3000,
            },
          ],
        },
        "LoggingConfiguration": {
          "DestinationBucketName": {
            "Ref": "ChatBotApiChatBucketsLogsBucket829E6C74",
          },
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "VersioningConfiguration": {
          "Status": "Enabled",
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "ChatBotApiChatBucketsFilesBucketPolicy3E92F963": {
      "Properties": {
        "Bucket": {
          "Ref": "ChatBotApiChatBucketsFilesBucket1D4E273A",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ChatBotApiChatBucketsFilesBucket1D4E273A",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ChatBotApiChatBucketsFilesBucket1D4E273A",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "ChatBotApiChatBucketsLogsBucket829E6C74": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-S1",
              "reason": "Logging bucket does not require it's own access logs.",
            },
          ],
        },
      },
      "Properties": {
        "AccessControl": "LogDeliveryWrite",
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256",
              },
            },
          ],
        },
        "OwnershipControls": {
          "Rules": [
            {
              "ObjectOwnership": "ObjectWriter",
            },
          ],
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "VersioningConfiguration": {
          "Status": "Enabled",
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "ChatBotApiChatBucketsLogsBucketPolicy7FD1B7BE": {
      "Properties": {
        "Bucket": {
          "Ref": "ChatBotApiChatBucketsLogsBucket829E6C74",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ChatBotApiChatBucketsLogsBucket829E6C74",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ChatBotApiChatBucketsLogsBucket829E6C74",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "ChatBotApiChatBucketsUserFeedbackBucketF010A391": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "KMSMasterKeyID": {
                  "Fn::GetAtt": [
                    "SharedKMSKey7BCBB616",
                    "Arn",
                  ],
                },
                "SSEAlgorithm": "aws:kms",
              },
            },
          ],
        },
        "LoggingConfiguration": {
          "DestinationBucketName": {
            "Ref": "ChatBotApiChatBucketsLogsBucket829E6C74",
          },
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "VersioningConfiguration": {
          "Status": "Enabled",
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "ChatBotApiChatBucketsUserFeedbackBucketPolicy277B5800": {
      "Properties": {
        "Bucket": {
          "Ref": "ChatBotApiChatBucketsUserFeedbackBucketF010A391",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ChatBotApiChatBucketsUserFeedbackBucketF010A391",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ChatBotApiChatBucketsUserFeedbackBucketF010A391",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "ChatBotApiChatDynamoDBTablesSessionsTable92B891E3": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "SessionId",
            "AttributeType": "S",
          },
          {
            "AttributeName": "UserId",
            "AttributeType": "S",
          },
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "byUserId",
            "KeySchema": [
              {
                "AttributeName": "UserId",
                "KeyType": "HASH",
              },
            ],
            "Projection": {
              "ProjectionType": "ALL",
            },
          },
        ],
        "KeySchema": [
          {
            "AttributeName": "SessionId",
            "KeyType": "HASH",
          },
          {
            "AttributeName": "UserId",
            "KeyType": "RANGE",
          },
        ],
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true,
        },
        "SSESpecification": {
          "KMSMasterKeyId": {
            "Fn::GetAtt": [
              "SharedKMSKey7BCBB616",
              "Arn",
            ],
          },
          "SSEEnabled": true,
          "SSEType": "KMS",
        },
      },
      "Type": "AWS::DynamoDB::Table",
      "UpdateReplacePolicy": "Retain",
    },
    "ChatBotApiChatbotApiBABF9B87": {
      "Properties": {
        "AdditionalAuthenticationProviders": [
          {
            "AuthenticationType": "AWS_IAM",
          },
        ],
        "AuthenticationType": "AMAZON_COGNITO_USER_POOLS",
        "LogConfig": {
          "CloudWatchLogsRoleArn": {
            "Fn::GetAtt": [
              "ChatBotApiapiLoggingRoleD60CA740",
              "Arn",
            ],
          },
          "FieldLogLevel": "INFO",
        },
        "Name": "ChatbotGraphqlApi",
        "UserPoolConfig": {
          "AwsRegion": "us-east-1",
          "DefaultAction": "ALLOW",
          "UserPoolId": {
            "Ref": "AuthenticationUserPool28698864",
          },
        },
        "Visibility": "PRIVATE",
        "XrayEnabled": false,
      },
      "Type": "AWS::AppSync::GraphQLApi",
    },
    "ChatBotApiChatbotApiLogRetention47D8853A": {
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/appsync/apis/",
              {
                "Fn::GetAtt": [
                  "ChatBotApiChatbotApiBABF9B87",
                  "ApiId",
                ],
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "ChatBotApiChatbotApiSchemaAB63459C": {
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "Definition": "# Workspaces

input CreateWorkspaceAuroraInput {
  name: String!
  kind: String!
  embeddingsModelProvider: String!
  embeddingsModelName: String!
  crossEncoderModelProvider: String
  crossEncoderModelName: String
  languages: [String!]!
  metric: String!
  index: Boolean!
  hybridSearch: Boolean!
  chunkingStrategy: String!
  chunkSize: Int!
  chunkOverlap: Int!
}

input CreateWorkspaceKendraInput {
  name: String!
  kind: String!
  kendraIndexId: String!
  useAllData: Boolean!
}

input CreateWorkspaceBedrockKBInput {
  name: String!
  kind: String!
  knowledgeBaseId: String!
  hybridSearch: Boolean!
}

input CreateWorkspaceOpenSearchInput {
  name: String!
  kind: String!
  embeddingsModelProvider: String!
  embeddingsModelName: String!
  crossEncoderModelProvider: String
  crossEncoderModelName: String
  languages: [String!]!
  hybridSearch: Boolean!
  chunkingStrategy: String!
  chunkSize: Int!
  chunkOverlap: Int!
}

input CalculateEmbeddingsInput {
  provider: String!
  model: String!
  passages: [String]!
  task: String!
}

type CrawlerProperties @aws_cognito_user_pools {
  followLinks: Boolean
  limit: Int
  contentTypes: [String!]!
}

type CrossEncoderData @aws_cognito_user_pools {
  provider: String!
  name: String!
  default: Boolean!
}

type DeleteSessionResult @aws_cognito_user_pools {
  id: String
  deleted: Boolean!
}

type DetectedLanguage @aws_cognito_user_pools {
  code: String!
  score: Float!
}

type Document @aws_cognito_user_pools {
  workspaceId: String!
  id: String!
  type: String!
  subType: String
  status: String
  title: String
  path: String
  sizeInBytes: Int
  vectors: Int
  subDocuments: Int
  crawlerProperties: CrawlerProperties
  errors: [String!]
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime
  rssFeedId: String
  rssLastCheckedAt: AWSDateTime
}

type DocumentResult @aws_cognito_user_pools {
  workspaceId: String!
  documentId: String!
  status: String
}

type DeleteDocumentResult @aws_cognito_user_pools {
  documentId: String!
  deleted: Boolean!
}

type UserFeedbackResult @aws_cognito_user_pools {
  feedback_id: String!
}

input DocumentSubscriptionStatusInput {
  workspaceId: String!
  documentId: String!
  status: String!
}

type DocumentsResult @aws_cognito_user_pools {
  items: [Document]!
  lastDocumentId: String
}

type Embedding @aws_cognito_user_pools {
  passage: String
  vector: [Float!]!
}

type EmbeddingModel @aws_cognito_user_pools {
  provider: String!
  name: String!
  dimensions: Int!
  default: Boolean
}

input FileUploadInput {
  workspaceId: String
  fileName: String!
}

type FileUploadResult @aws_cognito_user_pools {
  url: String!
  fields: String
}

input GetDocumentInput {
  workspaceId: String!
  documentId: String!
}

input GetRSSPostsInput {
  workspaceId: String!
  documentId: String!
  lastDocumentId: String
}

type KendraIndex @aws_cognito_user_pools {
  id: String!
  name: String!
  external: Boolean!
}

type BedrockKB @aws_cognito_user_pools {
  id: String!
  name: String!
  external: Boolean!
}

input ListDocumentsInput {
  workspaceId: String!
  documentType: String!
  lastDocumentId: String
}

type Model @aws_cognito_user_pools {
  name: String!
  provider: String!
  interface: String!
  ragSupported: Boolean!
  inputModalities: [String!]!
  outputModalities: [String!]!
  streaming: Boolean!
}

type PassageRank @aws_cognito_user_pools {
  score: Float!
  passage: String!
}

input QnADocumentInput {
  workspaceId: String!
  question: String!
  answer: String!
}

type RagEngine @aws_cognito_user_pools {
  id: String!
  name: String!
  enabled: Boolean!
}

input RankPassagesInput {
  provider: String!
  model: String!
  reference: String!
  passages: [String]!
}

input RssFeedInput {
  workspaceId: String!
  address: String!
  limit: Int!
  title: String
  followLinks: Boolean!
  contentTypes: [String!]!
}

input SemanticSearchInput {
  workspaceId: String!
  query: String!
}

type SemanticSearchItem @aws_cognito_user_pools {
  sources: [String]
  chunkId: String
  workspaceId: ID!
  documentId: String
  documentSubId: String
  documentSubType: String
  documentType: String!
  path: String
  language: String
  title: String
  content: String
  contentComplement: String
  vectorSearchScore: Float
  keywordSearchScore: Float
  score: Float
}

type SemanticSearchResult @aws_cognito_user_pools {
  engine: String!
  workspaceId: String!
  queryLanguage: String
  supportedLanguages: [String!]
  detectedLanguages: [DetectedLanguage!]
  items: [SemanticSearchItem!]
  vectorSearchMetric: String
  vectorSearchItems: [SemanticSearchItem!]
  keywordSearchItems: [SemanticSearchItem!]
}

type Session @aws_cognito_user_pools {
  id: String!
  title: String
  startTime: AWSDateTime!
  history: [SessionHistoryItem]
}

type SessionHistoryItem @aws_cognito_user_pools {
  type: String!
  content: String!
  metadata: String
}

input DeleteDocumentInput {
  workspaceId: String!
  documentId: String!
}

input UserFeedbackInput {
  sessionId: String!
  key: Int!
  feedback: String!
  prompt: String!
  completion: String!
  model: String!
}

input TextDocumentInput {
  workspaceId: String!
  title: String!
  content: String!
}

input WebsiteInput {
  workspaceId: String!
  sitemap: Boolean!
  address: String!
  followLinks: Boolean!
  limit: Int!
  contentTypes: [String!]!
}

type Workspace @aws_cognito_user_pools {
  id: String!
  name: String!
  formatVersion: Int
  engine: String!
  status: String
  aossEngine: String
  languages: [String]
  hasIndex: Boolean
  embeddingsModelProvider: String
  embeddingsModelName: String
  embeddingsModelDimensions: Int
  crossEncoderModelName: String
  crossEncoderModelProvider: String
  metric: String
  index: Boolean
  hybridSearch: Boolean
  chunkingStrategy: String
  chunkSize: Int
  chunkOverlap: Int
  vectors: Int
  documents: Int
  sizeInBytes: Int
  kendraIndexId: String
  kendraIndexExternal: Boolean
  kendraUseAllData: Boolean
  knowledgeBaseId: String
  knowledgeBaseExternal: Boolean
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type Channel @aws_iam @aws_cognito_user_pools {
  data: String
  sessionId: String
  userId: String
}

type Mutation {
  createKendraWorkspace(input: CreateWorkspaceKendraInput!): Workspace!
    @aws_cognito_user_pools
  createBedrockKBWorkspace(input: CreateWorkspaceBedrockKBInput!): Workspace!
    @aws_cognito_user_pools
  createOpenSearchWorkspace(input: CreateWorkspaceOpenSearchInput!): Workspace!
    @aws_cognito_user_pools
  createAuroraWorkspace(input: CreateWorkspaceAuroraInput!): Workspace!
    @aws_cognito_user_pools
  startKendraDataSync(workspaceId: String!): Boolean @aws_cognito_user_pools
  deleteWorkspace(workspaceId: String!): Boolean @aws_cognito_user_pools
  deleteDocument(input: DeleteDocumentInput!): DeleteDocumentResult @aws_cognito_user_pools
  addTextDocument(input: TextDocumentInput!): DocumentResult
    @aws_cognito_user_pools
  addUserFeedback(input: UserFeedbackInput!): UserFeedbackResult
    @aws_cognito_user_pools
  addQnADocument(input: QnADocumentInput!): DocumentResult
    @aws_cognito_user_pools
  setDocumentSubscriptionStatus(
    input: DocumentSubscriptionStatusInput!
  ): DocumentResult @aws_cognito_user_pools
  addWebsite(input: WebsiteInput!): DocumentResult @aws_cognito_user_pools
  addRssFeed(input: RssFeedInput!): DocumentResult @aws_cognito_user_pools
  updateRssFeed(input: RssFeedInput!): DocumentResult @aws_cognito_user_pools
  deleteUserSessions: [DeleteSessionResult!] @aws_cognito_user_pools
  deleteSession(id: String!): DeleteSessionResult @aws_cognito_user_pools
  # Real-time
  sendQuery(data: String): String @aws_cognito_user_pools
  publishResponse(sessionId: String, userId: String, data: String): Channel
    @aws_iam
}

type Query {
  checkHealth: Boolean @aws_cognito_user_pools
  getUploadFileURL(input: FileUploadInput!): FileUploadResult
    @aws_cognito_user_pools
  getFileURL(fileName: String!): String
    @aws_cognito_user_pools
  listModels: [Model!]! @aws_cognito_user_pools
  listWorkspaces: [Workspace!]! @aws_cognito_user_pools
  getWorkspace(workspaceId: String!): Workspace @aws_cognito_user_pools
  listRagEngines: [RagEngine!]! @aws_cognito_user_pools
  performSemanticSearch(input: SemanticSearchInput!): SemanticSearchResult!
    @aws_cognito_user_pools
  listSessions: [Session!]! @aws_cognito_user_pools
  listEmbeddingModels: [EmbeddingModel!]! @aws_cognito_user_pools
  calculateEmbeddings(input: CalculateEmbeddingsInput!): [Embedding]!
    @aws_cognito_user_pools
  getSession(id: String!): Session @aws_cognito_user_pools
  listKendraIndexes: [KendraIndex!]! @aws_cognito_user_pools
  listBedrockKnowledgeBases: [BedrockKB!]! @aws_cognito_user_pools
  isKendraDataSynching(workspaceId: String!): Boolean @aws_cognito_user_pools
  listDocuments(input: ListDocumentsInput!): DocumentsResult!
    @aws_cognito_user_pools
  getDocument(input: GetDocumentInput!): Document @aws_cognito_user_pools
  getRSSPosts(input: GetRSSPostsInput!): DocumentsResult @aws_cognito_user_pools
  listCrossEncoders: [CrossEncoderData!] @aws_cognito_user_pools
  rankPassages(input: RankPassagesInput!): [PassageRank!]!
    @aws_cognito_user_pools
}

type Subscription {
  receiveMessages(sessionId: String): Channel
    @aws_subscribe(mutations: ["publishResponse"])
    @aws_cognito_user_pools
}

schema {
  query: Query
  mutation: Mutation
  subscription: Subscription
}
",
      },
      "Type": "AWS::AppSync::GraphQLSchema",
    },
    "ChatBotApiChatbotApiaddQnADocumentresolver0E42B1E1": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "addQnADocument",
        "Kind": "UNIT",
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApiaddRssFeedresolverC0B93294": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "addRssFeed",
        "Kind": "UNIT",
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApiaddTextDocumentresolver64816686": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "addTextDocument",
        "Kind": "UNIT",
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApiaddUserFeedbackresolverA9A18C71": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "addUserFeedback",
        "Kind": "UNIT",
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApiaddWebsiteresolver9EDF5189": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "addWebsite",
        "Kind": "UNIT",
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApicalculateEmbeddingsresolver389E28D0": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "calculateEmbeddings",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApicheckHealthresolverD826A593": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "checkHealth",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApicreateAuroraWorkspaceresolverE23FA7FB": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "createAuroraWorkspace",
        "Kind": "UNIT",
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApicreateBedrockKBWorkspaceresolver5A858BF0": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "createBedrockKBWorkspace",
        "Kind": "UNIT",
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApicreateKendraWorkspaceresolver9DD5A5C3": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "createKendraWorkspace",
        "Kind": "UNIT",
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApicreateOpenSearchWorkspaceresolverE626C11D": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "createOpenSearchWorkspace",
        "Kind": "UNIT",
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApideleteDocumentresolver3EA744DA": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "deleteDocument",
        "Kind": "UNIT",
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApideleteSessionresolver07BBAC30": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "deleteSession",
        "Kind": "UNIT",
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApideleteUserSessionsresolver40118F44": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "deleteUserSessions",
        "Kind": "UNIT",
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApideleteWorkspaceresolverD95E05B0": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "deleteWorkspace",
        "Kind": "UNIT",
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApigetDocumentresolver0ACC138D": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "getDocument",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApigetFileURLresolverE31CCD1D": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "getFileURL",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApigetRSSPostsresolver7E31787C": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "getRSSPosts",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApigetSessionresolverD6EE62BE": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "getSession",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApigetUploadFileURLresolverC8E8309C": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "getUploadFileURL",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApigetWorkspaceresolverC342CF8A": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "getWorkspace",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApiisKendraDataSynchingresolver8EE2F9B9": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "isKendraDataSynching",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApilistBedrockKnowledgeBasesresolver175339F2": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "listBedrockKnowledgeBases",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApilistCrossEncodersresolverD2CD824C": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "listCrossEncoders",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApilistDocumentsresolver5A273A18": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "listDocuments",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApilistEmbeddingModelsresolver17768F67": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "listEmbeddingModels",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApilistKendraIndexesresolver241AADC9": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "listKendraIndexes",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApilistModelsresolver9788334D": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "listModels",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApilistRagEnginesresolver12D4D846": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "listRagEngines",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApilistSessionsresolverDCF2BA04": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "listSessions",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApilistWorkspacesresolver71CC260E": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "listWorkspaces",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApinone25580B40": {
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "Name": "relaysource",
        "Type": "NONE",
      },
      "Type": "AWS::AppSync::DataSource",
    },
    "ChatBotApiChatbotApiperformSemanticSearchresolverB90C4EFA": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "performSemanticSearch",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApiproxyResolverFunction257648DA": {
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "LambdaConfig": {
          "LambdaFunctionArn": {
            "Fn::GetAtt": [
              "ChatBotApiRestApiGraphQLApiHandler140797C1",
              "Arn",
            ],
          },
        },
        "Name": "proxyResolverFunction",
        "ServiceRoleArn": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiproxyResolverFunctionServiceRoleED08E348",
            "Arn",
          ],
        },
        "Type": "AWS_LAMBDA",
      },
      "Type": "AWS::AppSync::DataSource",
    },
    "ChatBotApiChatbotApiproxyResolverFunctionServiceRoleDefaultPolicy30623CC7": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ChatBotApiRestApiGraphQLApiHandler140797C1",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ChatBotApiRestApiGraphQLApiHandler140797C1",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ChatBotApiChatbotApiproxyResolverFunctionServiceRoleDefaultPolicy30623CC7",
        "Roles": [
          {
            "Ref": "ChatBotApiChatbotApiproxyResolverFunctionServiceRoleED08E348",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ChatBotApiChatbotApiproxyResolverFunctionServiceRoleED08E348": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "appsync.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "ChatBotApiChatbotApipublishresponseresolverA90F9A7F": {
      "DependsOn": [
        "ChatBotApiChatbotApinone25580B40",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "CodeS3Location": "s3://cdk-hnb659fds-assets-111111111-us-east-1/9674d65c2dc89ec931ff3f617d44972d1710ea521a654eb3b1b294814a6392dc.js",
        "DataSourceName": "relaysource",
        "FieldName": "publishResponse",
        "Kind": "UNIT",
        "Runtime": {
          "Name": "APPSYNC_JS",
          "RuntimeVersion": "1.0.0",
        },
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApirankPassagesresolver9E89A88F": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "rankPassages",
        "Kind": "UNIT",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApirealtimeResolverFunction59BA0662": {
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "LambdaConfig": {
          "LambdaFunctionArn": {
            "Fn::GetAtt": [
              "ChatBotApiRealtimeResolverslambdaresolver5D979DE8",
              "Arn",
            ],
          },
        },
        "Name": "realtimeResolverFunction",
        "ServiceRoleArn": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApirealtimeResolverFunctionServiceRoleB31DC0B5",
            "Arn",
          ],
        },
        "Type": "AWS_LAMBDA",
      },
      "Type": "AWS::AppSync::DataSource",
    },
    "ChatBotApiChatbotApirealtimeResolverFunctionServiceRoleB31DC0B5": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "appsync.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "ChatBotApiChatbotApirealtimeResolverFunctionServiceRoleDefaultPolicyB5AF7A8C": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ChatBotApiRealtimeResolverslambdaresolver5D979DE8",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ChatBotApiRealtimeResolverslambdaresolver5D979DE8",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ChatBotApiChatbotApirealtimeResolverFunctionServiceRoleDefaultPolicyB5AF7A8C",
        "Roles": [
          {
            "Ref": "ChatBotApiChatbotApirealtimeResolverFunctionServiceRoleB31DC0B5",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ChatBotApiChatbotApisendmessageresolverAB637F2E": {
      "DependsOn": [
        "ChatBotApiChatbotApirealtimeResolverFunction59BA0662",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "realtimeResolverFunction",
        "FieldName": "sendQuery",
        "Kind": "UNIT",
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApisetDocumentSubscriptionStatusresolver0BBB6F3B": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "setDocumentSubscriptionStatus",
        "Kind": "UNIT",
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApistartKendraDataSyncresolverD85D1770": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "startKendraDataSync",
        "Kind": "UNIT",
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApisubscriptionresolver0F7FFDEF": {
      "DependsOn": [
        "ChatBotApiChatbotApinone25580B40",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "CodeS3Location": "s3://cdk-hnb659fds-assets-111111111-us-east-1/4edd9618bc0937271352df1dcc99520e7cc9bc3f1a5fa7952dc8f1858f6c768e.js",
        "DataSourceName": "relaysource",
        "FieldName": "receiveMessages",
        "Kind": "UNIT",
        "Runtime": {
          "Name": "APPSYNC_JS",
          "RuntimeVersion": "1.0.0",
        },
        "TypeName": "Subscription",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiChatbotApiupdateRssFeedresolver7A2456F5": {
      "DependsOn": [
        "ChatBotApiChatbotApiproxyResolverFunction257648DA",
        "ChatBotApiChatbotApiSchemaAB63459C",
      ],
      "Properties": {
        "ApiId": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "ApiId",
          ],
        },
        "DataSourceName": "proxyResolverFunction",
        "FieldName": "updateRssFeed",
        "Kind": "UNIT",
        "TypeName": "Mutation",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "ChatBotApiRealtimeMessagesTopicCC5C5EA4": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SNS2",
              "reason": "No sensitive data in topic.",
            },
            {
              "id": "AwsSolutions-SNS3",
              "reason": "No sensitive data in topic.",
            },
          ],
        },
      },
      "Properties": {
        "KmsMasterKeyId": {
          "Fn::GetAtt": [
            "SharedKMSKey7BCBB616",
            "Arn",
          ],
        },
        "TracingConfig": "PassThrough",
      },
      "Type": "AWS::SNS::Topic",
    },
    "ChatBotApiRealtimeOutgoingMessagesDLQ07751960": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "KmsMasterKeyId": {
          "Fn::GetAtt": [
            "SharedQueueKMSKey26598E83",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SQS::Queue",
      "UpdateReplacePolicy": "Delete",
    },
    "ChatBotApiRealtimeOutgoingMessagesDLQPolicy709D8CBC": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sqs:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "ChatBotApiRealtimeOutgoingMessagesDLQ07751960",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Queues": [
          {
            "Ref": "ChatBotApiRealtimeOutgoingMessagesDLQ07751960",
          },
        ],
      },
      "Type": "AWS::SQS::QueuePolicy",
    },
    "ChatBotApiRealtimeOutgoingMessagesQueue92DD6F2A": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "KmsMasterKeyId": {
          "Fn::GetAtt": [
            "SharedQueueKMSKey26598E83",
            "Arn",
          ],
        },
        "RedrivePolicy": {
          "deadLetterTargetArn": {
            "Fn::GetAtt": [
              "ChatBotApiRealtimeOutgoingMessagesDLQ07751960",
              "Arn",
            ],
          },
          "maxReceiveCount": 3,
        },
      },
      "Type": "AWS::SQS::Queue",
      "UpdateReplacePolicy": "Delete",
    },
    "ChatBotApiRealtimeOutgoingMessagesQueuePolicy1CF29958": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sqs:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "ChatBotApiRealtimeOutgoingMessagesQueue92DD6F2A",
                  "Arn",
                ],
              },
            },
            {
              "Action": "sqs:SendMessage",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "events.amazonaws.com",
                  "sqs.amazonaws.com",
                ],
              },
              "Resource": {
                "Fn::GetAtt": [
                  "ChatBotApiRealtimeOutgoingMessagesQueue92DD6F2A",
                  "Arn",
                ],
              },
            },
            {
              "Action": "sqs:SendMessage",
              "Condition": {
                "ArnEquals": {
                  "aws:SourceArn": {
                    "Ref": "ChatBotApiRealtimeMessagesTopicCC5C5EA4",
                  },
                },
              },
              "Effect": "Allow",
              "Principal": {
                "Service": "sns.amazonaws.com",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "ChatBotApiRealtimeOutgoingMessagesQueue92DD6F2A",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Queues": [
          {
            "Ref": "ChatBotApiRealtimeOutgoingMessagesQueue92DD6F2A",
          },
        ],
      },
      "Type": "AWS::SQS::QueuePolicy",
    },
    "ChatBotApiRealtimeOutgoingMessagesQueueprefixGenAIChatBotStackChatBotApiRealtimeMessagesTopic54DE4F2916CB8B27": {
      "DependsOn": [
        "ChatBotApiRealtimeOutgoingMessagesQueuePolicy1CF29958",
      ],
      "Properties": {
        "Endpoint": {
          "Fn::GetAtt": [
            "ChatBotApiRealtimeOutgoingMessagesQueue92DD6F2A",
            "Arn",
          ],
        },
        "FilterPolicy": {
          "direction": [
            "OUT",
          ],
        },
        "FilterPolicyScope": "MessageBody",
        "Protocol": "sqs",
        "TopicArn": {
          "Ref": "ChatBotApiRealtimeMessagesTopicCC5C5EA4",
        },
      },
      "Type": "AWS::SNS::Subscription",
    },
    "ChatBotApiRealtimeResolverslambdaresolver5D979DE8": {
      "DependsOn": [
        "ChatBotApiRealtimeResolverslambdaresolverServiceRoleDefaultPolicy1EC0C731",
        "ChatBotApiRealtimeResolverslambdaresolverServiceRole0567D563",
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "Appsync resolver handling LLM Queries",
        "Environment": {
          "Variables": {
            "AWS_XRAY_SDK_ENABLED": "false",
            "LOG_LEVEL": "INFO",
            "POWERTOOLS_DEV": "false",
            "POWERTOOLS_LOGGER_LOG_EVENT": "false",
            "POWERTOOLS_SERVICE_NAME": "chatbot",
            "POWERTOOLS_TRACE_DISABLED": "true",
            "SNS_TOPIC_ARN": {
              "Ref": "ChatBotApiRealtimeMessagesTopicCC5C5EA4",
            },
          },
        },
        "Handler": "index.handler",
        "Layers": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":lambda:",
                {
                  "Ref": "AWS::Region",
                },
                ":017000801446:layer:AWSLambdaPowertoolsPythonV3-python311-x86_64:2",
              ],
            ],
          },
        ],
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "Role": {
          "Fn::GetAtt": [
            "ChatBotApiRealtimeResolverslambdaresolverServiceRole0567D563",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "ChatBotApiRealtimeResolverslambdaresolverSecurityGroup2B710F3E",
                "GroupId",
              ],
            },
          ],
          "SubnetIds": [
            {
              "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
            },
            {
              "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
            },
            {
              "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
            },
          ],
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "ChatBotApiRealtimeResolverslambdaresolverSecurityGroup2B710F3E": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "GroupDescription": "Automatic security group for Lambda Function prefixGenAIChatBotStackChatBotApiRealtimeResolverslambdaresolver6C8033F2",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ChatBotApiRealtimeResolverslambdaresolverServiceRole0567D563": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "ChatBotApiRealtimeResolverslambdaresolverServiceRoleDefaultPolicy1EC0C731": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sns:Publish",
              "Effect": "Allow",
              "Resource": {
                "Ref": "ChatBotApiRealtimeMessagesTopicCC5C5EA4",
              },
            },
            {
              "Action": [
                "kms:GenerateDataKey",
                "kms:Decrypt",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ChatBotApiRealtimeResolverslambdaresolverServiceRoleDefaultPolicy1EC0C731",
        "Roles": [
          {
            "Ref": "ChatBotApiRealtimeResolverslambdaresolverServiceRole0567D563",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ChatBotApiRealtimeResolversoutgoingmessagehandler5003C783": {
      "DependsOn": [
        "ChatBotApiRealtimeResolversoutgoingmessagehandlerServiceRoleDefaultPolicyAF38C3F9",
        "ChatBotApiRealtimeResolversoutgoingmessagehandlerServiceRole4EAAFFB4",
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "Sends LLM Responses to Appsync",
        "Environment": {
          "Variables": {
            "AWS_XRAY_SDK_ENABLED": "false",
            "GRAPHQL_ENDPOINT": {
              "Fn::GetAtt": [
                "ChatBotApiChatbotApiBABF9B87",
                "GraphQLUrl",
              ],
            },
            "LOG_LEVEL": "INFO",
            "POWERTOOLS_DEV": "false",
            "POWERTOOLS_LOGGER_LOG_EVENT": "false",
            "POWERTOOLS_SERVICE_NAME": "chatbot",
            "POWERTOOLS_TRACE_DISABLED": "true",
          },
        },
        "Handler": "index.handler",
        "Layers": [
          "arn:aws:lambda:us-east-1:094274105915:layer:AWSLambdaPowertoolsTypeScript:22",
        ],
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "Role": {
          "Fn::GetAtt": [
            "ChatBotApiRealtimeResolversoutgoingmessagehandlerServiceRole4EAAFFB4",
            "Arn",
          ],
        },
        "Runtime": "nodejs18.x",
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "ChatBotApiRealtimeResolversoutgoingmessagehandlerSecurityGroupD99FD186",
                "GroupId",
              ],
            },
          ],
          "SubnetIds": [
            {
              "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
            },
            {
              "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
            },
            {
              "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
            },
          ],
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "ChatBotApiRealtimeResolversoutgoingmessagehandlerSecurityGroupD99FD186": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "GroupDescription": "Automatic security group for Lambda Function prefixGenAIChatBotStackChatBotApiRealtimeResolversoutgoingmessagehandlerC2455B4B",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ChatBotApiRealtimeResolversoutgoingmessagehandlerServiceRole4EAAFFB4": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "ChatBotApiRealtimeResolversoutgoingmessagehandlerServiceRoleDefaultPolicyAF38C3F9": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "sqs:ReceiveMessage",
                "sqs:ChangeMessageVisibility",
                "sqs:GetQueueUrl",
                "sqs:DeleteMessage",
                "sqs:GetQueueAttributes",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "ChatBotApiRealtimeOutgoingMessagesQueue92DD6F2A",
                  "Arn",
                ],
              },
            },
            {
              "Action": "kms:Decrypt",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedQueueKMSKey26598E83",
                  "Arn",
                ],
              },
            },
            {
              "Action": "appsync:GraphQL",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":appsync:us-east-1:111111111:apis/",
                    {
                      "Fn::GetAtt": [
                        "ChatBotApiChatbotApiBABF9B87",
                        "ApiId",
                      ],
                    },
                    "/types/Mutation/*",
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ChatBotApiRealtimeResolversoutgoingmessagehandlerServiceRoleDefaultPolicyAF38C3F9",
        "Roles": [
          {
            "Ref": "ChatBotApiRealtimeResolversoutgoingmessagehandlerServiceRole4EAAFFB4",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ChatBotApiRealtimeResolversoutgoingmessagehandlerSqsEventSourceprefixGenAIChatBotStackChatBotApiRealtimeOutgoingMessagesQueue8BF14368786C9FC8": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "EventSourceArn": {
          "Fn::GetAtt": [
            "ChatBotApiRealtimeOutgoingMessagesQueue92DD6F2A",
            "Arn",
          ],
        },
        "FunctionName": {
          "Ref": "ChatBotApiRealtimeResolversoutgoingmessagehandler5003C783",
        },
      },
      "Type": "AWS::Lambda::EventSourceMapping",
    },
    "ChatBotApiRestApiApiSecurityGroupC0E40B67": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/ChatBotApi/RestApi/ApiSecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "ChatBotApiRestApiGraphQLApiHandler140797C1": {
      "DependsOn": [
        "ChatBotApiRestApiGraphQLApiHandlerServiceRoleDefaultPolicy409D1897",
        "ChatBotApiRestApiGraphQLApiHandlerServiceRole8BB05949",
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "Architectures": [
          "x86_64",
        ],
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "Main Appsync resolver",
        "Environment": {
          "Variables": {
            "API_KEYS_SECRETS_ARN": {
              "Ref": "SharedApiKeysSecret9EA666ED",
            },
            "AURORA_DB_HOST": {
              "Fn::GetAtt": [
                "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                "Endpoint.Address",
              ],
            },
            "AURORA_DB_PORT": {
              "Fn::GetAtt": [
                "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                "Endpoint.Port",
              ],
            },
            "AURORA_DB_USER": "aurora_db_iam_read",
            "AWS_XRAY_SDK_ENABLED": "false",
            "CHATBOT_FILES_BUCKET_NAME": {
              "Ref": "ChatBotApiChatBucketsFilesBucket1D4E273A",
            },
            "CONFIG_PARAMETER_NAME": {
              "Ref": "SharedConfig358B4A20",
            },
            "CREATE_AURORA_WORKSPACE_WORKFLOW_ARN": {
              "Ref": "RagEnginesAuroraPgVectorCreateAuroraWorkspace50EFF4E7",
            },
            "CREATE_KENDRA_WORKSPACE_WORKFLOW_ARN": {
              "Ref": "RagEnginesKendraRetrievalCreateKendraWorkspace5D8DE7EF",
            },
            "CREATE_OPEN_SEARCH_WORKSPACE_WORKFLOW_ARN": {
              "Ref": "RagEnginesOpenSearchVectorCreateOpenSearchWorkspace2B2FCA5B",
            },
            "DEFAULT_KENDRA_INDEX_ID": {
              "Fn::GetAtt": [
                "RagEnginesKendraRetrievalIndex922B65FC",
                "Id",
              ],
            },
            "DEFAULT_KENDRA_INDEX_NAME": "prefix-cmk-genaichatbot-work",
            "DEFAULT_KENDRA_S3_DATA_SOURCE_BUCKET_NAME": {
              "Ref": "RagEnginesKendraRetrievalKendraDataBucket1627A447",
            },
            "DEFAULT_KENDRA_S3_DATA_SOURCE_ID": {
              "Fn::GetAtt": [
                "RagEnginesKendraRetrievalKendraS3DataSourceCMKB964C6CC",
                "Id",
              ],
            },
            "DELETE_DOCUMENT_WORKFLOW_ARN": {
              "Ref": "RagEnginesWorkspacesDeleteDocumentA1FD6471",
            },
            "DELETE_WORKSPACE_WORKFLOW_ARN": {
              "Ref": "RagEnginesWorkspacesDeleteWorkspace6908C6DA",
            },
            "DOCUMENTS_BY_COMPOUND_KEY_INDEX_NAME": "by_compound_key_idx",
            "DOCUMENTS_BY_STATUS_INDEX": "by_status_idx",
            "DOCUMENTS_TABLE_NAME": {
              "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
            },
            "FILE_IMPORT_WORKFLOW_ARN": {
              "Ref": "RagEnginesDataImportFileImportWorkflowFileImportStateMachine398F0217",
            },
            "LOG_LEVEL": "INFO",
            "MODELS_PARAMETER_NAME": {
              "Ref": "ModelsModelsParameter4A14799B",
            },
            "OPEN_SEARCH_COLLECTION_ENDPOINT": {
              "Fn::GetAtt": [
                "RagEnginesOpenSearchVectorOpenSearchCollectionCMK872E47D8",
                "CollectionEndpoint",
              ],
            },
            "POWERTOOLS_DEV": "false",
            "POWERTOOLS_LOGGER_LOG_EVENT": "false",
            "POWERTOOLS_SERVICE_NAME": "chatbot",
            "POWERTOOLS_TRACE_DISABLED": "true",
            "PROCESSING_BUCKET_NAME": {
              "Ref": "RagEnginesDataImportProcessingBucketA7BE9701",
            },
            "RSS_FEED_INGESTOR_FUNCTION": {
              "Fn::GetAtt": [
                "RagEnginesDataImportRssSubscriptionRssIngestorC19E7D9E",
                "Arn",
              ],
            },
            "SAGEMAKER_RAG_MODELS_ENDPOINT": {
              "Fn::GetAtt": [
                "RagEnginesSageMakerModelMultiAB24AEndpoint6DA7D681",
                "EndpointName",
              ],
            },
            "SESSIONS_BY_USER_ID_INDEX_NAME": "byUserId",
            "SESSIONS_TABLE_NAME": {
              "Ref": "ChatBotApiChatDynamoDBTablesSessionsTable92B891E3",
            },
            "UPLOAD_BUCKET_NAME": {
              "Ref": "RagEnginesDataImportUploadBucket061D697E",
            },
            "USER_FEEDBACK_BUCKET_NAME": {
              "Ref": "ChatBotApiChatBucketsUserFeedbackBucketF010A391",
            },
            "WEBSITE_CRAWLING_WORKFLOW_ARN": {
              "Ref": "RagEnginesDataImportWebsiteCrawlingWorkflowWebsiteCrawling9B1CEC96",
            },
            "WORKSPACES_BY_OBJECT_TYPE_INDEX_NAME": "by_object_type_idx",
            "WORKSPACES_TABLE_NAME": {
              "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
            },
            "X_ORIGIN_VERIFY_SECRET_ARN": {
              "Ref": "SharedXOriginVerifySecret258B0376",
            },
          },
        },
        "Handler": "index.handler",
        "Layers": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":lambda:",
                {
                  "Ref": "AWS::Region",
                },
                ":017000801446:layer:AWSLambdaPowertoolsPythonV3-python311-x86_64:2",
              ],
            ],
          },
          {
            "Ref": "SharedCommonLayerFC89CBCE",
          },
        ],
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "MemorySize": 512,
        "Role": {
          "Fn::GetAtt": [
            "ChatBotApiRestApiGraphQLApiHandlerServiceRole8BB05949",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
        "Timeout": 600,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "ChatBotApiRestApiApiSecurityGroupC0E40B67",
                "GroupId",
              ],
            },
          ],
          "SubnetIds": [
            {
              "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
            },
            {
              "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
            },
            {
              "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
            },
          ],
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "ChatBotApiRestApiGraphQLApiHandlerLogRetention1384D66B": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "ChatBotApiRestApiGraphQLApiHandler140797C1",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "ChatBotApiRestApiGraphQLApiHandlerServiceRole8BB05949": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "ChatBotApiRestApiGraphQLApiHandlerServiceRoleDefaultPolicy409D1897": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportRssSubscriptionRssIngestorC19E7D9E",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportRssSubscriptionRssIngestorC19E7D9E",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "rds-db:connect",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":rds-db:us-east-1:111111111:dbuser:",
                    {
                      "Fn::GetAtt": [
                        "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                        "DBClusterResourceId",
                      ],
                    },
                    "/aurora_db_iam_read",
                  ],
                ],
              },
            },
            {
              "Action": "states:StartExecution",
              "Effect": "Allow",
              "Resource": {
                "Ref": "RagEnginesAuroraPgVectorCreateAuroraWorkspace50EFF4E7",
              },
            },
            {
              "Action": "aoss:APIAccessAll",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RagEnginesOpenSearchVectorOpenSearchCollectionCMK872E47D8",
                  "Arn",
                ],
              },
            },
            {
              "Action": "states:StartExecution",
              "Effect": "Allow",
              "Resource": {
                "Ref": "RagEnginesOpenSearchVectorCreateOpenSearchWorkspace2B2FCA5B",
              },
            },
            {
              "Action": "states:StartExecution",
              "Effect": "Allow",
              "Resource": {
                "Ref": "RagEnginesKendraRetrievalCreateKendraWorkspace5D8DE7EF",
              },
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesKendraRetrievalKendraDataBucket1627A447",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesKendraRetrievalKendraDataBucket1627A447",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "kendra:Retrieve",
                "kendra:Query",
                "kendra:BatchDeleteDocument",
                "kendra:BatchPutDocument",
                "kendra:StartDataSourceSyncJob",
                "kendra:DescribeDataSourceSyncJob",
                "kendra:StopDataSourceSyncJob",
                "kendra:ListDataSourceSyncJobs",
                "kendra:ListDataSources",
                "kendra:DescribeIndex",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesKendraRetrievalIndex922B65FC",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesKendraRetrievalIndex922B65FC",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "states:StartExecution",
              "Effect": "Allow",
              "Resource": {
                "Ref": "RagEnginesDataImportFileImportWorkflowFileImportStateMachine398F0217",
              },
            },
            {
              "Action": "states:StartExecution",
              "Effect": "Allow",
              "Resource": {
                "Ref": "RagEnginesDataImportWebsiteCrawlingWorkflowWebsiteCrawling9B1CEC96",
              },
            },
            {
              "Action": "states:StartExecution",
              "Effect": "Allow",
              "Resource": {
                "Ref": "RagEnginesWorkspacesDeleteWorkspace6908C6DA",
              },
            },
            {
              "Action": "states:StartExecution",
              "Effect": "Allow",
              "Resource": {
                "Ref": "RagEnginesWorkspacesDeleteDocumentA1FD6471",
              },
            },
            {
              "Action": "sagemaker:InvokeEndpoint",
              "Effect": "Allow",
              "Resource": {
                "Ref": "RagEnginesSageMakerModelMultiAB24AEndpoint6DA7D681",
              },
            },
            {
              "Action": "sagemaker:InvokeEndpoint",
              "Effect": "Allow",
              "Resource": {
                "Ref": "ModelsamazonFalconLiteendpointFalconLite71C23411",
              },
            },
            {
              "Action": "sagemaker:InvokeEndpoint",
              "Effect": "Allow",
              "Resource": {
                "Ref": "ModelsHuggingFaceM4idefics80binstructendpointIDEFICS80BBC34A48F",
              },
            },
            {
              "Action": [
                "comprehend:DetectDominantLanguage",
                "comprehend:DetectSentiment",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SharedXOriginVerifySecret258B0376",
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SharedApiKeysSecret9EA666ED",
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:us-east-1:111111111:parameter/",
                    {
                      "Ref": "SharedConfig358B4A20",
                    },
                  ],
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:us-east-1:111111111:parameter/",
                    {
                      "Ref": "ModelsModelsParameter4A14799B",
                    },
                  ],
                ],
              },
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ChatBotApiChatDynamoDBTablesSessionsTable92B891E3",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ChatBotApiChatDynamoDBTablesSessionsTable92B891E3",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ChatBotApiChatBucketsUserFeedbackBucketF010A391",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ChatBotApiChatBucketsUserFeedbackBucketF010A391",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ChatBotApiChatBucketsFilesBucket1D4E273A",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ChatBotApiChatBucketsFilesBucket1D4E273A",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportUploadBucket061D697E",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportUploadBucket061D697E",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportProcessingBucketA7BE9701",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportProcessingBucketA7BE9701",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "bedrock:ListFoundationModels",
                "bedrock:ListCustomModels",
                "bedrock:InvokeModel",
                "bedrock:InvokeModelWithResponseStream",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ChatBotApiRestApiGraphQLApiHandlerServiceRoleDefaultPolicy409D1897",
        "Roles": [
          {
            "Ref": "ChatBotApiRestApiGraphQLApiHandlerServiceRole8BB05949",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ChatBotApiVPCPublicIPsAE6206D3": {
      "Properties": {
        "Addresses": [
          {
            "Fn::Join": [
              "",
              [
                {
                  "Fn::GetAtt": [
                    "SharedVPCpublicSubnet1EIPA9E2FC1C",
                    "PublicIp",
                  ],
                },
                "/32",
              ],
            ],
          },
        ],
        "IPAddressVersion": "IPV4",
        "Scope": "REGIONAL",
      },
      "Type": "AWS::WAFv2::IPSet",
    },
    "ChatBotApiWafAppsync9FEB4E22": {
      "Properties": {
        "DefaultAction": {
          "Allow": {},
        },
        "Description": "WAFv2 ACL for APPSync",
        "Name": "WafAppsync",
        "Rules": [
          {
            "Action": {
              "Block": {},
            },
            "Name": "LimitRequestsPerIP",
            "Priority": 10,
            "Statement": {
              "RateBasedStatement": {
                "AggregateKeyType": "IP",
                "EvaluationWindowSec": 600,
                "Limit": 400,
              },
            },
            "VisibilityConfig": {
              "CloudWatchMetricsEnabled": true,
              "MetricName": "LimitRequestsPerIP",
              "SampledRequestsEnabled": true,
            },
          },
          {
            "Action": {
              "Block": {
                "CustomResponse": {
                  "ResponseCode": 429,
                },
              },
            },
            "Name": "LimitLLMRequestsPerIP",
            "Priority": 1,
            "Statement": {
              "RateBasedStatement": {
                "AggregateKeyType": "IP",
                "EvaluationWindowSec": 600,
                "Limit": 100,
                "ScopeDownStatement": {
                  "AndStatement": {
                    "Statements": [
                      {
                        "ByteMatchStatement": {
                          "FieldToMatch": {
                            "UriPath": {},
                          },
                          "PositionalConstraint": "EXACTLY",
                          "SearchString": "/graphql",
                          "TextTransformations": [
                            {
                              "Priority": 0,
                              "Type": "NONE",
                            },
                          ],
                        },
                      },
                      {
                        "ByteMatchStatement": {
                          "FieldToMatch": {
                            "Body": {
                              "OversizeHandling": "MATCH",
                            },
                          },
                          "PositionalConstraint": "CONTAINS",
                          "SearchString": "mutation SendQuery(",
                          "TextTransformations": [
                            {
                              "Priority": 0,
                              "Type": "NONE",
                            },
                          ],
                        },
                      },
                    ],
                  },
                },
              },
            },
            "VisibilityConfig": {
              "CloudWatchMetricsEnabled": true,
              "MetricName": "LimitRequestsPerIP",
              "SampledRequestsEnabled": true,
            },
          },
          {
            "Action": {
              "Allow": {},
            },
            "Name": "AllowInternalCalls",
            "Priority": 2,
            "Statement": {
              "IPSetReferenceStatement": {
                "Arn": {
                  "Fn::GetAtt": [
                    "ChatBotApiVPCPublicIPsAE6206D3",
                    "Arn",
                  ],
                },
              },
            },
            "VisibilityConfig": {
              "CloudWatchMetricsEnabled": false,
              "MetricName": "AllowInternalCalls",
              "SampledRequestsEnabled": false,
            },
          },
        ],
        "Scope": "REGIONAL",
        "VisibilityConfig": {
          "CloudWatchMetricsEnabled": true,
          "MetricName": "WafAppsync",
          "SampledRequestsEnabled": true,
        },
      },
      "Type": "AWS::WAFv2::WebACL",
    },
    "ChatBotApiWebACLAssociation24C73AD5": {
      "Properties": {
        "ResourceArn": {
          "Fn::GetAtt": [
            "ChatBotApiChatbotApiBABF9B87",
            "Arn",
          ],
        },
        "WebACLArn": {
          "Fn::GetAtt": [
            "ChatBotApiWafAppsync9FEB4E22",
            "Arn",
          ],
        },
      },
      "Type": "AWS::WAFv2::WebACLAssociation",
    },
    "ChatBotApiapiLoggingRoleD60CA740": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "Access to all log groups required for CloudWatch log group creation.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "appsync.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": "logs:*",
                  "Effect": "Allow",
                  "Resource": "*",
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "loggingPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C81C01536": {
      "DependsOn": [
        "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF",
        "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-L1",
              "reason": "Lambda function created implicitly by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Environment": {
          "Variables": {
            "AWS_CA_BUNDLE": "/etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem",
          },
        },
        "Handler": "index.handler",
        "Layers": [
          {
            "Ref": "RagEnginesSageMakerModelMultiAB24AScriptAwsCliLayer3B70313A",
          },
        ],
        "Role": {
          "Fn::GetAtt": [
            "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::cdk-hnb659fds-assets-111111111-us-east-1",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::cdk-hnb659fds-assets-111111111-us-east-1/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesSageMakerModelMultiAB24ABucketF09A69F9",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesSageMakerModelMultiAB24ABucketF09A69F9",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "UserInterfaceWebsiteBucket2BDEA247",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "UserInterfaceWebsiteBucket2BDEA247",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF",
        "Roles": [
          {
            "Ref": "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F": {
      "DependsOn": [
        "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": {
          "Fn::Join": [
            "",
            [
              "Lambda function for auto-deleting objects in ",
              {
                "Ref": "UserInterfaceWebsiteBucket2BDEA247",
              },
              " S3 bucket.",
            ],
          ],
        },
        "Handler": "index.handler",
        "MemorySize": 128,
        "Role": {
          "Fn::GetAtt": [
            "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Sub": "arn:\${AWS::Partition}:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "IdeficsInterfaceChatbotFilesPrivateApiA1587730": {
      "Properties": {
        "BinaryMediaTypes": [
          "*/*",
        ],
        "EndpointConfiguration": {
          "Types": [
            "PRIVATE",
          ],
          "VpcEndpointIds": [
            {
              "Ref": "SharedVPCPrivateApiEndpoint099B15FE",
            },
          ],
        },
        "Name": "ChatbotFilesPrivateApi",
        "Policy": {
          "Statement": [
            {
              "Action": "execute-api:Invoke",
              "Effect": "Allow",
              "Principal": {
                "AWS": "*",
              },
              "Resource": "execute-api:/*/*/*",
            },
            {
              "Action": "execute-api:Invoke",
              "Condition": {
                "StringNotEquals": {
                  "aws:SourceVpce": {
                    "Ref": "SharedVPCPrivateApiEndpoint099B15FE",
                  },
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": "execute-api:/*/*/*",
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::ApiGateway::RestApi",
    },
    "IdeficsInterfaceChatbotFilesPrivateApiAccessLogs72EB0CAA": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "RetentionInDays": 731,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "IdeficsInterfaceChatbotFilesPrivateApiAccount77BB84A1": {
      "DeletionPolicy": "Retain",
      "DependsOn": [
        "IdeficsInterfaceChatbotFilesPrivateApiA1587730",
      ],
      "Properties": {
        "CloudWatchRoleArn": {
          "Fn::GetAtt": [
            "IdeficsInterfaceChatbotFilesPrivateApiCloudWatchRole72A1711C",
            "Arn",
          ],
        },
      },
      "Type": "AWS::ApiGateway::Account",
      "UpdateReplacePolicy": "Retain",
    },
    "IdeficsInterfaceChatbotFilesPrivateApiCloudWatchRole72A1711C": {
      "DeletionPolicy": "Retain",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "apigateway.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonAPIGatewayPushToCloudWatchLogs",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
      "UpdateReplacePolicy": "Retain",
    },
    "IdeficsInterfaceChatbotFilesPrivateApiDeploymentA0338B5C9598f9463b17b50e4bc71954b6781eca": {
      "DependsOn": [
        "IdeficsInterfaceChatbotFilesPrivateApifolderkeyGET8832AC7C",
        "IdeficsInterfaceChatbotFilesPrivateApifolderkeyF8CDCEB5",
        "IdeficsInterfaceChatbotFilesPrivateApifolderAFB6ED45",
        "IdeficsInterfaceChatbotFilesPrivateApiValidateRequest8E2961DC",
      ],
      "Properties": {
        "Description": "Automatically created by the RestApi construct",
        "RestApiId": {
          "Ref": "IdeficsInterfaceChatbotFilesPrivateApiA1587730",
        },
      },
      "Type": "AWS::ApiGateway::Deployment",
    },
    "IdeficsInterfaceChatbotFilesPrivateApiDeploymentStageprodF1E02758": {
      "DependsOn": [
        "IdeficsInterfaceChatbotFilesPrivateApiAccount77BB84A1",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-APIG3",
              "reason": "WAF not required due to configured Cognito auth.",
            },
          ],
        },
      },
      "Properties": {
        "AccessLogSetting": {
          "DestinationArn": {
            "Fn::GetAtt": [
              "IdeficsInterfaceChatbotFilesPrivateApiAccessLogs72EB0CAA",
              "Arn",
            ],
          },
          "Format": "{"requestId":"$context.requestId","ip":"$context.identity.sourceIp","user":"$context.identity.user","caller":"$context.identity.caller","requestTime":"$context.requestTime","httpMethod":"$context.httpMethod","resourcePath":"$context.resourcePath","status":"$context.status","protocol":"$context.protocol","responseLength":"$context.responseLength"}",
        },
        "DeploymentId": {
          "Ref": "IdeficsInterfaceChatbotFilesPrivateApiDeploymentA0338B5C9598f9463b17b50e4bc71954b6781eca",
        },
        "MethodSettings": [
          {
            "DataTraceEnabled": false,
            "HttpMethod": "*",
            "LoggingLevel": "INFO",
            "MetricsEnabled": true,
            "ResourcePath": "/*",
          },
        ],
        "RestApiId": {
          "Ref": "IdeficsInterfaceChatbotFilesPrivateApiA1587730",
        },
        "StageName": "prod",
        "TracingEnabled": true,
      },
      "Type": "AWS::ApiGateway::Stage",
    },
    "IdeficsInterfaceChatbotFilesPrivateApiValidateRequest8E2961DC": {
      "Properties": {
        "Name": "chatbot-files-private-api-validator",
        "RestApiId": {
          "Ref": "IdeficsInterfaceChatbotFilesPrivateApiA1587730",
        },
        "ValidateRequestBody": true,
        "ValidateRequestParameters": true,
      },
      "Type": "AWS::ApiGateway::RequestValidator",
    },
    "IdeficsInterfaceChatbotFilesPrivateApifolderAFB6ED45": {
      "Properties": {
        "ParentId": {
          "Fn::GetAtt": [
            "IdeficsInterfaceChatbotFilesPrivateApiA1587730",
            "RootResourceId",
          ],
        },
        "PathPart": "{folder}",
        "RestApiId": {
          "Ref": "IdeficsInterfaceChatbotFilesPrivateApiA1587730",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "IdeficsInterfaceChatbotFilesPrivateApifolderkeyF8CDCEB5": {
      "Properties": {
        "ParentId": {
          "Ref": "IdeficsInterfaceChatbotFilesPrivateApifolderAFB6ED45",
        },
        "PathPart": "{key}",
        "RestApiId": {
          "Ref": "IdeficsInterfaceChatbotFilesPrivateApiA1587730",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "IdeficsInterfaceChatbotFilesPrivateApifolderkeyGET8832AC7C": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-APIG4",
              "reason": "Private API within a VPC.",
            },
            {
              "id": "AwsSolutions-COG4",
              "reason": "Private API within a VPC.",
            },
          ],
        },
      },
      "Properties": {
        "AuthorizationType": "NONE",
        "HttpMethod": "GET",
        "Integration": {
          "Credentials": {
            "Fn::GetAtt": [
              "IdeficsInterfaceS3IntegrationRole419A2409",
              "Arn",
            ],
          },
          "IntegrationHttpMethod": "GET",
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Content-Type": "integration.response.header.Content-Type",
              },
              "StatusCode": "200",
            },
          ],
          "RequestParameters": {
            "integration.request.path.folder": "method.request.path.folder",
            "integration.request.path.key": "method.request.path.key",
          },
          "Type": "AWS",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:",
                {
                  "Ref": "AWS::Region",
                },
                ":s3:path/",
                {
                  "Ref": "ChatBotApiChatBucketsFilesBucket1D4E273A",
                },
                "/private/{folder}/{key}",
              ],
            ],
          },
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Content-Type": true,
            },
            "StatusCode": "200",
          },
        ],
        "RequestParameters": {
          "method.request.header.Content-Type": true,
          "method.request.path.folder": true,
          "method.request.path.key": true,
        },
        "ResourceId": {
          "Ref": "IdeficsInterfaceChatbotFilesPrivateApifolderkeyF8CDCEB5",
        },
        "RestApiId": {
          "Ref": "IdeficsInterfaceChatbotFilesPrivateApiA1587730",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "IdeficsInterfaceDLQ42807B03": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "KmsMasterKeyId": {
          "Fn::GetAtt": [
            "SharedQueueKMSKey26598E83",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SQS::Queue",
      "UpdateReplacePolicy": "Delete",
    },
    "IdeficsInterfaceDLQPolicy2427EBEB": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sqs:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "IdeficsInterfaceDLQ42807B03",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Queues": [
          {
            "Ref": "IdeficsInterfaceDLQ42807B03",
          },
        ],
      },
      "Type": "AWS::SQS::QueuePolicy",
    },
    "IdeficsInterfaceIdeficsIngestionQueue53735B5C": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "KmsMasterKeyId": {
          "Fn::GetAtt": [
            "SharedQueueKMSKey26598E83",
            "Arn",
          ],
        },
        "RedrivePolicy": {
          "deadLetterTargetArn": {
            "Fn::GetAtt": [
              "IdeficsInterfaceDLQ42807B03",
              "Arn",
            ],
          },
          "maxReceiveCount": 3,
        },
        "VisibilityTimeout": 5400,
      },
      "Type": "AWS::SQS::Queue",
      "UpdateReplacePolicy": "Delete",
    },
    "IdeficsInterfaceIdeficsIngestionQueuePolicy87BD70F2": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sqs:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "IdeficsInterfaceIdeficsIngestionQueue53735B5C",
                  "Arn",
                ],
              },
            },
            {
              "Action": "sqs:SendMessage",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "events.amazonaws.com",
                  "sqs.amazonaws.com",
                ],
              },
              "Resource": {
                "Fn::GetAtt": [
                  "IdeficsInterfaceIdeficsIngestionQueue53735B5C",
                  "Arn",
                ],
              },
            },
            {
              "Action": "sqs:SendMessage",
              "Condition": {
                "ArnEquals": {
                  "aws:SourceArn": {
                    "Ref": "ChatBotApiRealtimeMessagesTopicCC5C5EA4",
                  },
                },
              },
              "Effect": "Allow",
              "Principal": {
                "Service": "sns.amazonaws.com",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "IdeficsInterfaceIdeficsIngestionQueue53735B5C",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Queues": [
          {
            "Ref": "IdeficsInterfaceIdeficsIngestionQueue53735B5C",
          },
        ],
      },
      "Type": "AWS::SQS::QueuePolicy",
    },
    "IdeficsInterfaceIdeficsIngestionQueueprefixGenAIChatBotStackChatBotApiRealtimeMessagesTopic54DE4F2921FDE5DC": {
      "DependsOn": [
        "IdeficsInterfaceIdeficsIngestionQueuePolicy87BD70F2",
      ],
      "Properties": {
        "Endpoint": {
          "Fn::GetAtt": [
            "IdeficsInterfaceIdeficsIngestionQueue53735B5C",
            "Arn",
          ],
        },
        "FilterPolicy": {
          "direction": [
            "IN",
          ],
          "modelInterface": [
            "multimodal",
          ],
        },
        "FilterPolicyScope": "MessageBody",
        "Protocol": "sqs",
        "TopicArn": {
          "Ref": "ChatBotApiRealtimeMessagesTopicCC5C5EA4",
        },
      },
      "Type": "AWS::SNS::Subscription",
    },
    "IdeficsInterfaceMultiModalInterfaceRequestHandler73848B25": {
      "DependsOn": [
        "IdeficsInterfaceMultiModalInterfaceRequestHandlerServiceRoleDefaultPolicy4BC11D12",
        "IdeficsInterfaceMultiModalInterfaceRequestHandlerServiceRole73CECC06",
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "Architectures": [
          "x86_64",
        ],
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "Multi modal request handler",
        "Environment": {
          "Variables": {
            "AWS_XRAY_SDK_ENABLED": "false",
            "CHATBOT_FILES_BUCKET_NAME": {
              "Ref": "ChatBotApiChatBucketsFilesBucket1D4E273A",
            },
            "CHATBOT_FILES_PRIVATE_API": {
              "Fn::Join": [
                "",
                [
                  "https://",
                  {
                    "Ref": "IdeficsInterfaceChatbotFilesPrivateApiA1587730",
                  },
                  ".execute-api.us-east-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/",
                  {
                    "Ref": "IdeficsInterfaceChatbotFilesPrivateApiDeploymentStageprodF1E02758",
                  },
                  "/",
                ],
              ],
            },
            "CONFIG_PARAMETER_NAME": {
              "Ref": "SharedConfig358B4A20",
            },
            "LOG_LEVEL": "INFO",
            "MESSAGES_TOPIC_ARN": {
              "Ref": "ChatBotApiRealtimeMessagesTopicCC5C5EA4",
            },
            "POWERTOOLS_DEV": "false",
            "POWERTOOLS_LOGGER_LOG_EVENT": "false",
            "POWERTOOLS_SERVICE_NAME": "chatbot",
            "POWERTOOLS_TRACE_DISABLED": "true",
            "SAGEMAKER_ENDPOINT_HUGGINGFACEM4IDEFICS80BINSTRUCT": {
              "Fn::GetAtt": [
                "ModelsHuggingFaceM4idefics80binstructendpointIDEFICS80BBC34A48F",
                "EndpointName",
              ],
            },
            "SESSIONS_BY_USER_ID_INDEX_NAME": "byUserId",
            "SESSIONS_TABLE_NAME": {
              "Ref": "ChatBotApiChatDynamoDBTablesSessionsTable92B891E3",
            },
          },
        },
        "Handler": "index.handler",
        "Layers": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":lambda:",
                {
                  "Ref": "AWS::Region",
                },
                ":017000801446:layer:AWSLambdaPowertoolsPythonV3-python311-x86_64:2",
              ],
            ],
          },
          {
            "Ref": "SharedCommonLayerFC89CBCE",
          },
        ],
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "MemorySize": 1024,
        "Role": {
          "Fn::GetAtt": [
            "IdeficsInterfaceMultiModalInterfaceRequestHandlerServiceRole73CECC06",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
        "Timeout": 900,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "IdeficsInterfaceMultiModalInterfaceRequestHandlerSecurityGroupDC9CD390",
                "GroupId",
              ],
            },
          ],
          "SubnetIds": [
            {
              "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
            },
            {
              "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
            },
            {
              "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
            },
          ],
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "IdeficsInterfaceMultiModalInterfaceRequestHandlerLogRetentionD3507337": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "IdeficsInterfaceMultiModalInterfaceRequestHandler73848B25",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "IdeficsInterfaceMultiModalInterfaceRequestHandlerSecurityGroupDC9CD390": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "GroupDescription": "Automatic security group for Lambda Function prefixGenAIChatBotStackIdeficsInterfaceMultiModalInterfaceRequestHandlerA4DEA07C",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "IdeficsInterfaceMultiModalInterfaceRequestHandlerServiceRole73CECC06": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "IdeficsInterfaceMultiModalInterfaceRequestHandlerServiceRoleDefaultPolicy4BC11D12": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ChatBotApiChatBucketsFilesBucket1D4E273A",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ChatBotApiChatBucketsFilesBucket1D4E273A",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ChatBotApiChatDynamoDBTablesSessionsTable92B891E3",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ChatBotApiChatDynamoDBTablesSessionsTable92B891E3",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "sns:Publish",
              "Effect": "Allow",
              "Resource": {
                "Ref": "ChatBotApiRealtimeMessagesTopicCC5C5EA4",
              },
            },
            {
              "Action": [
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:us-east-1:111111111:parameter/",
                    {
                      "Ref": "SharedConfig358B4A20",
                    },
                  ],
                ],
              },
            },
            {
              "Action": "bedrock:InvokeModel",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "sqs:ReceiveMessage",
                "sqs:ChangeMessageVisibility",
                "sqs:GetQueueUrl",
                "sqs:DeleteMessage",
                "sqs:GetQueueAttributes",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "IdeficsInterfaceIdeficsIngestionQueue53735B5C",
                  "Arn",
                ],
              },
            },
            {
              "Action": "kms:Decrypt",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedQueueKMSKey26598E83",
                  "Arn",
                ],
              },
            },
            {
              "Action": "sagemaker:InvokeEndpoint",
              "Effect": "Allow",
              "Resource": {
                "Ref": "ModelsHuggingFaceM4idefics80binstructendpointIDEFICS80BBC34A48F",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "IdeficsInterfaceMultiModalInterfaceRequestHandlerServiceRoleDefaultPolicy4BC11D12",
        "Roles": [
          {
            "Ref": "IdeficsInterfaceMultiModalInterfaceRequestHandlerServiceRole73CECC06",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "IdeficsInterfaceMultiModalInterfaceRequestHandlerSqsEventSourceprefixGenAIChatBotStackIdeficsInterfaceIdeficsIngestionQueue1E1C820B63A51D8E": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "EventSourceArn": {
          "Fn::GetAtt": [
            "IdeficsInterfaceIdeficsIngestionQueue53735B5C",
            "Arn",
          ],
        },
        "FunctionName": {
          "Ref": "IdeficsInterfaceMultiModalInterfaceRequestHandler73848B25",
        },
      },
      "Type": "AWS::Lambda::EventSourceMapping",
    },
    "IdeficsInterfaceS3IntegrationRole419A2409": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "Access to all log groups required for CloudWatch log group creation.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "Access limited to KMS resources.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "apigateway.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonAPIGatewayPushToCloudWatchLogs",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "IdeficsInterfaceS3IntegrationRoleDefaultPolicyF5F45841": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:GetObject*",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": [
                        "ChatBotApiChatBucketsFilesBucket1D4E273A",
                        "Arn",
                      ],
                    },
                    "/private/*",
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "IdeficsInterfaceS3IntegrationRoleDefaultPolicyF5F45841",
        "Roles": [
          {
            "Ref": "IdeficsInterfaceS3IntegrationRole419A2409",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "IdeficsInterfaceVPCDefaultSecurityGroupfromIndirectPeer443106FD7A5": {
      "Properties": {
        "CidrIp": {
          "Fn::GetAtt": [
            "SharedVPC6716DA5E",
            "CidrBlock",
          ],
        },
        "Description": {
          "Fn::Join": [
            "",
            [
              "from ",
              {
                "Fn::GetAtt": [
                  "SharedVPC6716DA5E",
                  "CidrBlock",
                ],
              },
              ":443",
            ],
          ],
        },
        "FromPort": 443,
        "GroupId": {
          "Fn::GetAtt": [
            "SharedVPC6716DA5E",
            "DefaultSecurityGroup",
          ],
        },
        "IpProtocol": "tcp",
        "ToPort": 443,
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "LangchainInterfaceDLQFABC9CF7": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "KmsMasterKeyId": {
          "Fn::GetAtt": [
            "SharedKMSKey7BCBB616",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SQS::Queue",
      "UpdateReplacePolicy": "Delete",
    },
    "LangchainInterfaceDLQPolicy9EE0415E": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sqs:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "LangchainInterfaceDLQFABC9CF7",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Queues": [
          {
            "Ref": "LangchainInterfaceDLQFABC9CF7",
          },
        ],
      },
      "Type": "AWS::SQS::QueuePolicy",
    },
    "LangchainInterfaceLangChainIngestionQueueE5D48FA1": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "KmsMasterKeyId": {
          "Fn::GetAtt": [
            "SharedQueueKMSKey26598E83",
            "Arn",
          ],
        },
        "RedrivePolicy": {
          "deadLetterTargetArn": {
            "Fn::GetAtt": [
              "LangchainInterfaceDLQFABC9CF7",
              "Arn",
            ],
          },
          "maxReceiveCount": 3,
        },
        "VisibilityTimeout": 5400,
      },
      "Type": "AWS::SQS::Queue",
      "UpdateReplacePolicy": "Delete",
    },
    "LangchainInterfaceLangChainIngestionQueuePolicy53CA25BD": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sqs:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "LangchainInterfaceLangChainIngestionQueueE5D48FA1",
                  "Arn",
                ],
              },
            },
            {
              "Action": "sqs:SendMessage",
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "events.amazonaws.com",
                  "sqs.amazonaws.com",
                ],
              },
              "Resource": {
                "Fn::GetAtt": [
                  "LangchainInterfaceLangChainIngestionQueueE5D48FA1",
                  "Arn",
                ],
              },
            },
            {
              "Action": "sqs:SendMessage",
              "Condition": {
                "ArnEquals": {
                  "aws:SourceArn": {
                    "Ref": "ChatBotApiRealtimeMessagesTopicCC5C5EA4",
                  },
                },
              },
              "Effect": "Allow",
              "Principal": {
                "Service": "sns.amazonaws.com",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "LangchainInterfaceLangChainIngestionQueueE5D48FA1",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Queues": [
          {
            "Ref": "LangchainInterfaceLangChainIngestionQueueE5D48FA1",
          },
        ],
      },
      "Type": "AWS::SQS::QueuePolicy",
    },
    "LangchainInterfaceLangChainIngestionQueueprefixGenAIChatBotStackChatBotApiRealtimeMessagesTopic54DE4F29BBD4A77A": {
      "DependsOn": [
        "LangchainInterfaceLangChainIngestionQueuePolicy53CA25BD",
      ],
      "Properties": {
        "Endpoint": {
          "Fn::GetAtt": [
            "LangchainInterfaceLangChainIngestionQueueE5D48FA1",
            "Arn",
          ],
        },
        "FilterPolicy": {
          "direction": [
            "IN",
          ],
          "modelInterface": [
            "langchain",
          ],
        },
        "FilterPolicyScope": "MessageBody",
        "Protocol": "sqs",
        "TopicArn": {
          "Ref": "ChatBotApiRealtimeMessagesTopicCC5C5EA4",
        },
      },
      "Type": "AWS::SNS::Subscription",
    },
    "LangchainInterfaceRequestHandler472B9584": {
      "DependsOn": [
        "LangchainInterfaceRequestHandlerServiceRoleDefaultPolicy0D4DC356",
        "LangchainInterfaceRequestHandlerServiceRole2FA1A914",
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "Architectures": [
          "x86_64",
        ],
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "Langchain request handler",
        "Environment": {
          "Variables": {
            "API_KEYS_SECRETS_ARN": {
              "Ref": "SharedApiKeysSecret9EA666ED",
            },
            "AURORA_DB_HOST": {
              "Fn::GetAtt": [
                "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                "Endpoint.Address",
              ],
            },
            "AURORA_DB_PORT": {
              "Fn::GetAtt": [
                "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                "Endpoint.Port",
              ],
            },
            "AURORA_DB_USER": "aurora_db_iam_read",
            "AWS_XRAY_SDK_ENABLED": "false",
            "CONFIG_PARAMETER_NAME": {
              "Ref": "SharedConfig358B4A20",
            },
            "DEFAULT_KENDRA_INDEX_ID": {
              "Fn::GetAtt": [
                "RagEnginesKendraRetrievalIndex922B65FC",
                "Id",
              ],
            },
            "DEFAULT_KENDRA_INDEX_NAME": "prefix-cmk-genaichatbot-work",
            "DEFAULT_KENDRA_S3_DATA_SOURCE_BUCKET_NAME": {
              "Ref": "RagEnginesKendraRetrievalKendraDataBucket1627A447",
            },
            "DEFAULT_KENDRA_S3_DATA_SOURCE_ID": {
              "Fn::GetAtt": [
                "RagEnginesKendraRetrievalKendraS3DataSourceCMKB964C6CC",
                "Id",
              ],
            },
            "LOG_LEVEL": "INFO",
            "MESSAGES_TOPIC_ARN": {
              "Ref": "ChatBotApiRealtimeMessagesTopicCC5C5EA4",
            },
            "OPEN_SEARCH_COLLECTION_ENDPOINT": {
              "Fn::GetAtt": [
                "RagEnginesOpenSearchVectorOpenSearchCollectionCMK872E47D8",
                "CollectionEndpoint",
              ],
            },
            "POWERTOOLS_DEV": "false",
            "POWERTOOLS_LOGGER_LOG_EVENT": "false",
            "POWERTOOLS_SERVICE_NAME": "chatbot",
            "POWERTOOLS_TRACE_DISABLED": "true",
            "SAGEMAKER_ENDPOINT_AMAZONFALCONLITE": {
              "Fn::GetAtt": [
                "ModelsamazonFalconLiteendpointFalconLite71C23411",
                "EndpointName",
              ],
            },
            "SAGEMAKER_RAG_MODELS_ENDPOINT": {
              "Fn::GetAtt": [
                "RagEnginesSageMakerModelMultiAB24AEndpoint6DA7D681",
                "EndpointName",
              ],
            },
            "SESSIONS_BY_USER_ID_INDEX_NAME": "byUserId",
            "SESSIONS_TABLE_NAME": {
              "Ref": "ChatBotApiChatDynamoDBTablesSessionsTable92B891E3",
            },
            "WORKSPACES_BY_OBJECT_TYPE_INDEX_NAME": "by_object_type_idx",
            "WORKSPACES_TABLE_NAME": {
              "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
            },
          },
        },
        "Handler": "index.handler",
        "Layers": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":lambda:",
                {
                  "Ref": "AWS::Region",
                },
                ":017000801446:layer:AWSLambdaPowertoolsPythonV3-python311-x86_64:2",
              ],
            ],
          },
          {
            "Ref": "SharedCommonLayerFC89CBCE",
          },
        ],
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "MemorySize": 1024,
        "Role": {
          "Fn::GetAtt": [
            "LangchainInterfaceRequestHandlerServiceRole2FA1A914",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
        "Timeout": 900,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "LangchainInterfaceRequestHandlerSecurityGroup5FED03E5",
                "GroupId",
              ],
            },
          ],
          "SubnetIds": [
            {
              "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
            },
            {
              "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
            },
            {
              "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
            },
          ],
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "LangchainInterfaceRequestHandlerLogRetention6CEA9760": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "LangchainInterfaceRequestHandler472B9584",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "LangchainInterfaceRequestHandlerSecurityGroup5FED03E5": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "GroupDescription": "Automatic security group for Lambda Function prefixGenAIChatBotStackLangchainInterfaceRequestHandler1104E0FC",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "LangchainInterfaceRequestHandlerServiceRole2FA1A914": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "LangchainInterfaceRequestHandlerServiceRoleDefaultPolicy0D4DC356": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "bedrock:InvokeModel",
                "bedrock:InvokeModelWithResponseStream",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "rds-db:connect",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":rds-db:us-east-1:111111111:dbuser:",
                    {
                      "Fn::GetAtt": [
                        "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                        "DBClusterResourceId",
                      ],
                    },
                    "/aurora_db_iam_read",
                  ],
                ],
              },
            },
            {
              "Action": "aoss:APIAccessAll",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RagEnginesOpenSearchVectorOpenSearchCollectionCMK872E47D8",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "sagemaker:InvokeEndpoint",
              "Effect": "Allow",
              "Resource": {
                "Ref": "RagEnginesSageMakerModelMultiAB24AEndpoint6DA7D681",
              },
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesKendraRetrievalKendraDataBucket1627A447",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesKendraRetrievalKendraDataBucket1627A447",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "kendra:Retrieve",
                "kendra:Query",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RagEnginesKendraRetrievalIndex922B65FC",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ChatBotApiChatDynamoDBTablesSessionsTable92B891E3",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ChatBotApiChatDynamoDBTablesSessionsTable92B891E3",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "sns:Publish",
              "Effect": "Allow",
              "Resource": {
                "Ref": "ChatBotApiRealtimeMessagesTopicCC5C5EA4",
              },
            },
            {
              "Action": [
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SharedApiKeysSecret9EA666ED",
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:us-east-1:111111111:parameter/",
                    {
                      "Ref": "SharedConfig358B4A20",
                    },
                  ],
                ],
              },
            },
            {
              "Action": [
                "bedrock:*",
                "bedrock:InvokeModelWithResponseStream",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "comprehend:DetectDominantLanguage",
                "comprehend:DetectSentiment",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "sqs:ReceiveMessage",
                "sqs:ChangeMessageVisibility",
                "sqs:GetQueueUrl",
                "sqs:DeleteMessage",
                "sqs:GetQueueAttributes",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "LangchainInterfaceLangChainIngestionQueueE5D48FA1",
                  "Arn",
                ],
              },
            },
            {
              "Action": "kms:Decrypt",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedQueueKMSKey26598E83",
                  "Arn",
                ],
              },
            },
            {
              "Action": "sagemaker:InvokeEndpoint",
              "Effect": "Allow",
              "Resource": {
                "Ref": "ModelsamazonFalconLiteendpointFalconLite71C23411",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "LangchainInterfaceRequestHandlerServiceRoleDefaultPolicy0D4DC356",
        "Roles": [
          {
            "Ref": "LangchainInterfaceRequestHandlerServiceRole2FA1A914",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "LangchainInterfaceRequestHandlerSqsEventSourceprefixGenAIChatBotStackLangchainInterfaceLangChainIngestionQueueD009169FE168C1C5": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "EventSourceArn": {
          "Fn::GetAtt": [
            "LangchainInterfaceLangChainIngestionQueueE5D48FA1",
            "Arn",
          ],
        },
        "FunctionName": {
          "Ref": "LangchainInterfaceRequestHandler472B9584",
        },
      },
      "Type": "AWS::Lambda::EventSourceMapping",
    },
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A": {
      "DependsOn": [
        "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
        "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "logs:PutRetentionPolicy",
                "logs:DeleteRetentionPolicy",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
        "Roles": [
          {
            "Ref": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ModelsEndpointConfigFalconLite56D2BEF1": {
      "DependsOn": [
        "ModelsamazonFalconLitemodelFalconLiteA0714F90",
      ],
      "Properties": {
        "ProductionVariants": [
          {
            "ContainerStartupHealthCheckTimeoutInSeconds": 600,
            "InitialInstanceCount": 1,
            "InitialVariantWeight": 1,
            "InstanceType": "ml.g5.12xlarge",
            "ModelName": {
              "Fn::GetAtt": [
                "ModelsamazonFalconLitemodelFalconLiteA0714F90",
                "ModelName",
              ],
            },
            "VariantName": "AllTraffic",
          },
        ],
      },
      "Type": "AWS::SageMaker::EndpointConfig",
    },
    "ModelsEndpointConfigIDEFICS80B8A31DDC6": {
      "DependsOn": [
        "ModelsHuggingFaceM4idefics80binstructmodelIDEFICS80B1F09D07D",
      ],
      "Properties": {
        "ProductionVariants": [
          {
            "ContainerStartupHealthCheckTimeoutInSeconds": 600,
            "InitialInstanceCount": 1,
            "InitialVariantWeight": 1,
            "InstanceType": "ml.g5.48xlarge",
            "ModelName": {
              "Fn::GetAtt": [
                "ModelsHuggingFaceM4idefics80binstructmodelIDEFICS80B1F09D07D",
                "ModelName",
              ],
            },
            "VariantName": "AllTraffic",
          },
        ],
      },
      "Type": "AWS::SageMaker::EndpointConfig",
    },
    "ModelsFalconLiteRole90259899": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "Gives user ability to deploy and delete endpoints from the UI.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "Gives user ability to deploy and delete endpoints from the UI.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "sagemaker.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/AmazonSageMakerFullAccess",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "ModelsFalconLiteRoleDefaultPolicy064BAFF1": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "Gives user ability to deploy and delete endpoints from the UI.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "Gives user ability to deploy and delete endpoints from the UI.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:us-east-1:763104351884:repository/huggingface-pytorch-tgi-inference",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ModelsFalconLiteRoleDefaultPolicy064BAFF1",
        "Roles": [
          {
            "Ref": "ModelsFalconLiteRole90259899",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ModelsHuggingFaceM4idefics80binstructendpointIDEFICS80BBC34A48F": {
      "DependsOn": [
        "ModelsEndpointConfigIDEFICS80B8A31DDC6",
      ],
      "Properties": {
        "EndpointConfigName": {
          "Fn::GetAtt": [
            "ModelsEndpointConfigIDEFICS80B8A31DDC6",
            "EndpointConfigName",
          ],
        },
        "EndpointName": "HuggingFaceM4-idefics-80b-instruct",
        "Tags": [
          {
            "Key": "modelId",
            "Value": "HuggingFaceM4/idefics-80b-instruct",
          },
        ],
      },
      "Type": "AWS::SageMaker::Endpoint",
    },
    "ModelsHuggingFaceM4idefics80binstructmodelIDEFICS80B1F09D07D": {
      "Properties": {
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "ModelsIDEFICS80BRole5BE23C49",
            "Arn",
          ],
        },
        "PrimaryContainer": {
          "Environment": {
            "HF_MODEL_ID": "HuggingFaceM4/idefics-80b-instruct",
            "HF_MODEL_QUANTIZE": "bitsandbytes",
            "MAX_BATCH_TOTAL_TOKENS": "8192",
            "MAX_INPUT_LENGTH": "1024",
            "MAX_TOTAL_TOKENS": "2048",
            "SAGEMAKER_CONTAINER_LOG_LEVEL": "20",
            "SAGEMAKER_REGION": {
              "Ref": "AWS::Region",
            },
            "SM_NUM_GPUS": "8",
          },
          "Image": {
            "Fn::Join": [
              "",
              [
                "763104351884.dkr.ecr.us-east-1.",
                {
                  "Ref": "AWS::URLSuffix",
                },
                "/huggingface-pytorch-tgi-inference:2.0.1-tgi1.1.0-gpu-py39-cu118-ubuntu20.04",
              ],
            ],
          },
          "Mode": "SingleModel",
        },
        "Tags": [
          {
            "Key": "modelId",
            "Value": "HuggingFaceM4/idefics-80b-instruct",
          },
        ],
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "DefaultSecurityGroup",
              ],
            },
          ],
          "Subnets": [
            {
              "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
            },
            {
              "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
            },
            {
              "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
            },
          ],
        },
      },
      "Type": "AWS::SageMaker::Model",
    },
    "ModelsIDEFICS80BRole5BE23C49": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "Gives user ability to deploy and delete endpoints from the UI.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "Gives user ability to deploy and delete endpoints from the UI.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "sagemaker.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/AmazonSageMakerFullAccess",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "ModelsIDEFICS80BRoleDefaultPolicy33F8A86E": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "Gives user ability to deploy and delete endpoints from the UI.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "Gives user ability to deploy and delete endpoints from the UI.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:us-east-1:763104351884:repository/huggingface-pytorch-tgi-inference",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "ModelsIDEFICS80BRoleDefaultPolicy33F8A86E",
        "Roles": [
          {
            "Ref": "ModelsIDEFICS80BRole5BE23C49",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "ModelsModelsParameter4A14799B": {
      "Properties": {
        "Type": "String",
        "Value": "[{"name":"amazon-FalconLite","endpoint":"amazon-FalconLite","responseStreamingSupported":false,"inputModalities":["TEXT"],"outputModalities":["TEXT"],"interface":"langchain","ragSupported":true},{"name":"HuggingFaceM4-idefics-80b-instruct","endpoint":"HuggingFaceM4-idefics-80b-instruct","responseStreamingSupported":false,"inputModalities":["TEXT","IMAGE"],"outputModalities":["TEXT"],"interface":"multimodal","ragSupported":false}]",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "ModelsamazonFalconLiteendpointFalconLite71C23411": {
      "DependsOn": [
        "ModelsEndpointConfigFalconLite56D2BEF1",
      ],
      "Properties": {
        "EndpointConfigName": {
          "Fn::GetAtt": [
            "ModelsEndpointConfigFalconLite56D2BEF1",
            "EndpointConfigName",
          ],
        },
        "EndpointName": "amazon-FalconLite",
        "Tags": [
          {
            "Key": "modelId",
            "Value": "amazon/FalconLite",
          },
        ],
      },
      "Type": "AWS::SageMaker::Endpoint",
    },
    "ModelsamazonFalconLitemodelFalconLiteA0714F90": {
      "Properties": {
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "ModelsFalconLiteRole90259899",
            "Arn",
          ],
        },
        "PrimaryContainer": {
          "Environment": {
            "DNTK_ALPHA_SCALER": "0.25",
            "GPTQ_BITS": "4",
            "GPTQ_GROUPSIZE": "128",
            "HF_MODEL_ID": "amazon/FalconLite",
            "HF_MODEL_QUANTIZE": "gptq",
            "MAX_BATCH_PREFILL_TOKENS": "12001",
            "MAX_BATCH_TOTAL_TOKENS": "12001",
            "MAX_INPUT_LENGTH": "12000",
            "MAX_TOTAL_TOKENS": "12001",
            "SAGEMAKER_CONTAINER_LOG_LEVEL": "20",
            "SAGEMAKER_REGION": {
              "Ref": "AWS::Region",
            },
            "SM_NUM_GPUS": "4",
            "TRUST_REMOTE_CODE": "true",
          },
          "Image": {
            "Fn::Join": [
              "",
              [
                "763104351884.dkr.ecr.us-east-1.",
                {
                  "Ref": "AWS::URLSuffix",
                },
                "/huggingface-pytorch-tgi-inference:2.0.1-tgi0.9.3-gpu-py39-cu118-ubuntu20.04",
              ],
            ],
          },
          "Mode": "SingleModel",
        },
        "Tags": [
          {
            "Key": "modelId",
            "Value": "amazon/FalconLite",
          },
        ],
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "DefaultSecurityGroup",
              ],
            },
          ],
          "Subnets": [
            {
              "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
            },
            {
              "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
            },
            {
              "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
            },
          ],
        },
      },
      "Type": "AWS::SageMaker::Model",
    },
    "MonitoringStackNestedStackMonitoringStackNestedStackResourceC34BBBCF": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "Parameters": {
          "referencetoprefixGenAIChatBotStackAuthenticationUserPool28D00D89Ref": {
            "Ref": "AuthenticationUserPool28698864",
          },
          "referencetoprefixGenAIChatBotStackAuthenticationUserPoolUserPoolClientE65D4656Ref": {
            "Ref": "AuthenticationUserPoolUserPoolClient8AE1704E",
          },
          "referencetoprefixGenAIChatBotStackChatBotApiChatBucketsFilesBucket7B7E6DAARef": {
            "Ref": "ChatBotApiChatBucketsFilesBucket1D4E273A",
          },
          "referencetoprefixGenAIChatBotStackChatBotApiChatDynamoDBTablesSessionsTable599B2069Ref": {
            "Ref": "ChatBotApiChatDynamoDBTablesSessionsTable92B891E3",
          },
          "referencetoprefixGenAIChatBotStackChatBotApiChatbotApi4C7BE22AApiId": {
            "Fn::GetAtt": [
              "ChatBotApiChatbotApiBABF9B87",
              "ApiId",
            ],
          },
          "referencetoprefixGenAIChatBotStackChatBotApiRealtimeOutgoingMessagesDLQ2E7C9117QueueName": {
            "Fn::GetAtt": [
              "ChatBotApiRealtimeOutgoingMessagesDLQ07751960",
              "QueueName",
            ],
          },
          "referencetoprefixGenAIChatBotStackChatBotApiRealtimeOutgoingMessagesDLQ2E7C9117Ref": {
            "Ref": "ChatBotApiRealtimeOutgoingMessagesDLQ07751960",
          },
          "referencetoprefixGenAIChatBotStackChatBotApiRealtimeOutgoingMessagesQueueDB417674QueueName": {
            "Fn::GetAtt": [
              "ChatBotApiRealtimeOutgoingMessagesQueue92DD6F2A",
              "QueueName",
            ],
          },
          "referencetoprefixGenAIChatBotStackChatBotApiRealtimeOutgoingMessagesQueueDB417674Ref": {
            "Ref": "ChatBotApiRealtimeOutgoingMessagesQueue92DD6F2A",
          },
          "referencetoprefixGenAIChatBotStackChatBotApiRealtimeResolverslambdaresolver8BF201BERef": {
            "Ref": "ChatBotApiRealtimeResolverslambdaresolver5D979DE8",
          },
          "referencetoprefixGenAIChatBotStackChatBotApiRealtimeResolversoutgoingmessagehandler46D9234FRef": {
            "Ref": "ChatBotApiRealtimeResolversoutgoingmessagehandler5003C783",
          },
          "referencetoprefixGenAIChatBotStackChatBotApiRestApiGraphQLApiHandler16D33600Ref": {
            "Ref": "ChatBotApiRestApiGraphQLApiHandler140797C1",
          },
          "referencetoprefixGenAIChatBotStackIdeficsInterfaceDLQA61B0857QueueName": {
            "Fn::GetAtt": [
              "IdeficsInterfaceDLQ42807B03",
              "QueueName",
            ],
          },
          "referencetoprefixGenAIChatBotStackIdeficsInterfaceDLQA61B0857Ref": {
            "Ref": "IdeficsInterfaceDLQ42807B03",
          },
          "referencetoprefixGenAIChatBotStackIdeficsInterfaceIdeficsIngestionQueueE8FBF43BQueueName": {
            "Fn::GetAtt": [
              "IdeficsInterfaceIdeficsIngestionQueue53735B5C",
              "QueueName",
            ],
          },
          "referencetoprefixGenAIChatBotStackIdeficsInterfaceIdeficsIngestionQueueE8FBF43BRef": {
            "Ref": "IdeficsInterfaceIdeficsIngestionQueue53735B5C",
          },
          "referencetoprefixGenAIChatBotStackIdeficsInterfaceMultiModalInterfaceRequestHandler0405788FRef": {
            "Ref": "IdeficsInterfaceMultiModalInterfaceRequestHandler73848B25",
          },
          "referencetoprefixGenAIChatBotStackLangchainInterfaceDLQ65EC71FFQueueName": {
            "Fn::GetAtt": [
              "LangchainInterfaceDLQFABC9CF7",
              "QueueName",
            ],
          },
          "referencetoprefixGenAIChatBotStackLangchainInterfaceDLQ65EC71FFRef": {
            "Ref": "LangchainInterfaceDLQFABC9CF7",
          },
          "referencetoprefixGenAIChatBotStackLangchainInterfaceLangChainIngestionQueue88B3658BQueueName": {
            "Fn::GetAtt": [
              "LangchainInterfaceLangChainIngestionQueueE5D48FA1",
              "QueueName",
            ],
          },
          "referencetoprefixGenAIChatBotStackLangchainInterfaceLangChainIngestionQueue88B3658BRef": {
            "Ref": "LangchainInterfaceLangChainIngestionQueueE5D48FA1",
          },
          "referencetoprefixGenAIChatBotStackLangchainInterfaceRequestHandler1642CB57Ref": {
            "Ref": "LangchainInterfaceRequestHandler472B9584",
          },
          "referencetoprefixGenAIChatBotStackRagEnginesAuroraPgVectorAuroraDatabase56E235C4Ref": {
            "Ref": "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
          },
          "referencetoprefixGenAIChatBotStackRagEnginesAuroraPgVectorCreateAuroraWorkspaceA6C8AA55Ref": {
            "Ref": "RagEnginesAuroraPgVectorCreateAuroraWorkspace50EFF4E7",
          },
          "referencetoprefixGenAIChatBotStackRagEnginesDataImportFileImportWorkflowFileImportStateMachine321C1A41Ref": {
            "Ref": "RagEnginesDataImportFileImportWorkflowFileImportStateMachine398F0217",
          },
          "referencetoprefixGenAIChatBotStackRagEnginesDataImportRssSubscriptionRssIngestor61F3BC37Ref": {
            "Ref": "RagEnginesDataImportRssSubscriptionRssIngestorC19E7D9E",
          },
          "referencetoprefixGenAIChatBotStackRagEnginesDataImportWebsiteCrawlingWorkflowWebsiteCrawlingE4F3E075Ref": {
            "Ref": "RagEnginesDataImportWebsiteCrawlingWorkflowWebsiteCrawling9B1CEC96",
          },
          "referencetoprefixGenAIChatBotStackRagEnginesKendraRetrievalCreateKendraWorkspaceF2D8D838Ref": {
            "Ref": "RagEnginesKendraRetrievalCreateKendraWorkspace5D8DE7EF",
          },
          "referencetoprefixGenAIChatBotStackRagEnginesKendraRetrievalIndex6EE4B09CRef": {
            "Ref": "RagEnginesKendraRetrievalIndex922B65FC",
          },
          "referencetoprefixGenAIChatBotStackRagEnginesOpenSearchVectorCreateOpenSearchWorkspaceEF4B48CCRef": {
            "Ref": "RagEnginesOpenSearchVectorCreateOpenSearchWorkspace2B2FCA5B",
          },
          "referencetoprefixGenAIChatBotStackRagEnginesOpenSearchVectorOpenSearchCollectionCMKD12B055BRef": {
            "Ref": "RagEnginesOpenSearchVectorOpenSearchCollectionCMK872E47D8",
          },
          "referencetoprefixGenAIChatBotStackRagEnginesRagDynamoDBTablesDocumentsA193574BRef": {
            "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
          },
          "referencetoprefixGenAIChatBotStackRagEnginesRagDynamoDBTablesWorkspaces314BB92CRef": {
            "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
          },
          "referencetoprefixGenAIChatBotStackRagEnginesWorkspacesDeleteDocumentA52D8641Ref": {
            "Ref": "RagEnginesWorkspacesDeleteDocumentA1FD6471",
          },
          "referencetoprefixGenAIChatBotStackRagEnginesWorkspacesDeleteWorkspace0EDB5232Ref": {
            "Ref": "RagEnginesWorkspacesDeleteWorkspace6908C6DA",
          },
        },
        "TemplateURL": {
          "Fn::Join": [
            "",
            [
              "https://s3.us-east-1.",
              {
                "Ref": "AWS::URLSuffix",
              },
              "/cdk-hnb659fds-assets-111111111-us-east-1/8380396019047276611e0aced77ad645470ae8c58c38ce4733a50d6771c59e86.json",
            ],
          ],
        },
      },
      "Type": "AWS::CloudFormation::Stack",
      "UpdateReplacePolicy": "Delete",
    },
    "RagEnginesAuroraPgVectorAuroraDatabase2A003265": {
      "DeletionPolicy": "Snapshot",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-RDS10",
              "reason": "Deletion protection disabled to allow deletion as part of the CloudFormation stack.",
            },
            {
              "id": "AwsSolutions-RDS2",
              "reason": "Encryption cannot be enabled on an unencrypted DB Cluster, therefore enabling will destroy existing data. Docs provide instructions for users requiring it.",
            },
          ],
        },
      },
      "Properties": {
        "BackupRetentionPeriod": 35,
        "CopyTagsToSnapshot": true,
        "DBClusterParameterGroupName": "default.aurora-postgresql15",
        "DBSubnetGroupName": {
          "Ref": "RagEnginesAuroraPgVectorAuroraDatabaseSubnets038B8C27",
        },
        "EnableIAMDatabaseAuthentication": true,
        "Engine": "aurora-postgresql",
        "EngineVersion": "15.7",
        "KmsKeyId": {
          "Fn::GetAtt": [
            "SharedKMSKey7BCBB616",
            "Arn",
          ],
        },
        "MasterUserPassword": {
          "Fn::Join": [
            "",
            [
              "{{resolve:secretsmanager:",
              {
                "Ref": "RagEnginesAuroraPgVectorAuroraDatabaseSecretBF0EF63E",
              },
              ":SecretString:password::}}",
            ],
          ],
        },
        "MasterUsername": {
          "Fn::Join": [
            "",
            [
              "{{resolve:secretsmanager:",
              {
                "Ref": "RagEnginesAuroraPgVectorAuroraDatabaseSecretBF0EF63E",
              },
              ":SecretString:username::}}",
            ],
          ],
        },
        "Port": 5432,
        "ServerlessV2ScalingConfiguration": {
          "MaxCapacity": 2,
          "MinCapacity": 0.5,
        },
        "StorageEncrypted": true,
        "VpcSecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroup333F94D8",
              "GroupId",
            ],
          },
        ],
      },
      "Type": "AWS::RDS::DBCluster",
      "UpdateReplacePolicy": "Snapshot",
    },
    "RagEnginesAuroraPgVectorAuroraDatabaseSecretAttachmentA167E2A9": {
      "Properties": {
        "SecretId": {
          "Ref": "RagEnginesAuroraPgVectorAuroraDatabaseSecretBF0EF63E",
        },
        "TargetId": {
          "Ref": "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
        },
        "TargetType": "AWS::RDS::DBCluster",
      },
      "Type": "AWS::SecretsManager::SecretTargetAttachment",
    },
    "RagEnginesAuroraPgVectorAuroraDatabaseSecretBF0EF63E": {
      "DeletionPolicy": "Delete",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SMG4",
              "reason": "Secret created implicitly by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "Description": {
          "Fn::Join": [
            "",
            [
              "Generated by the CDK for stack: ",
              {
                "Ref": "AWS::StackName",
              },
            ],
          ],
        },
        "GenerateSecretString": {
          "ExcludeCharacters": " %+~\`#$&*()|[]{}:;<>?!'/@"\\",
          "GenerateStringKey": "password",
          "PasswordLength": 30,
          "SecretStringTemplate": "{"username":"postgres"}",
        },
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroup333F94D8": {
      "Properties": {
        "GroupDescription": "RDS security group",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroupfromprefixGenAIChatBotStackChatBotApiRestApiApiSecurityGroup777E7B0FIndirectPortFB3425A8": {
      "Properties": {
        "Description": "from prefixGenAIChatBotStackChatBotApiRestApiApiSecurityGroup777E7B0F:{IndirectPort}",
        "FromPort": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
            "Endpoint.Port",
          ],
        },
        "GroupId": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroup333F94D8",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "ChatBotApiRestApiApiSecurityGroupC0E40B67",
            "GroupId",
          ],
        },
        "ToPort": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
            "Endpoint.Port",
          ],
        },
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroupfromprefixGenAIChatBotStackLangchainInterfaceRequestHandlerSecurityGroupB2D839AFIndirectPort986F7CFB": {
      "Properties": {
        "Description": "from prefixGenAIChatBotStackLangchainInterfaceRequestHandlerSecurityGroupB2D839AF:{IndirectPort}",
        "FromPort": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
            "Endpoint.Port",
          ],
        },
        "GroupId": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroup333F94D8",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "LangchainInterfaceRequestHandlerSecurityGroup5FED03E5",
            "GroupId",
          ],
        },
        "ToPort": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
            "Endpoint.Port",
          ],
        },
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroupfromprefixGenAIChatBotStackRagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionSecurityGroupCA3FBD41IndirectPort2E9A07FB": {
      "Properties": {
        "Description": "from prefixGenAIChatBotStackRagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionSecurityGroupCA3FBD41:{IndirectPort}",
        "FromPort": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
            "Endpoint.Port",
          ],
        },
        "GroupId": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroup333F94D8",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionSecurityGroup1A0FE458",
            "GroupId",
          ],
        },
        "ToPort": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
            "Endpoint.Port",
          ],
        },
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroupfromprefixGenAIChatBotStackRagEnginesAuroraPgVectorDatabaseSetupFunctionSecurityGroup5F090D4DIndirectPort4DDBF43D": {
      "Properties": {
        "Description": "from prefixGenAIChatBotStackRagEnginesAuroraPgVectorDatabaseSetupFunctionSecurityGroup5F090D4D:{IndirectPort}",
        "FromPort": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
            "Endpoint.Port",
          ],
        },
        "GroupId": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroup333F94D8",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorDatabaseSetupFunctionSecurityGroupDFD5001A",
            "GroupId",
          ],
        },
        "ToPort": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
            "Endpoint.Port",
          ],
        },
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroupfromprefixGenAIChatBotStackRagEnginesDataImportFileImportBatchJobFargateComputeEnvironmentSecurityGroupD501189BIndirectPortA2FD26DA": {
      "Properties": {
        "Description": "from prefixGenAIChatBotStackRagEnginesDataImportFileImportBatchJobFargateComputeEnvironmentSecurityGroupD501189B:{IndirectPort}",
        "FromPort": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
            "Endpoint.Port",
          ],
        },
        "GroupId": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroup333F94D8",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "RagEnginesDataImportFileImportBatchJobFargateComputeEnvironmentSecurityGroupDBC1F0DD",
            "GroupId",
          ],
        },
        "ToPort": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
            "Endpoint.Port",
          ],
        },
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroupfromprefixGenAIChatBotStackRagEnginesDataImportWebCrawlerBatchJobWebCrawlerFargateComputeEnvironmentSecurityGroup692C5DACIndirectPortDC5EAC53": {
      "Properties": {
        "Description": "from prefixGenAIChatBotStackRagEnginesDataImportWebCrawlerBatchJobWebCrawlerFargateComputeEnvironmentSecurityGroup692C5DAC:{IndirectPort}",
        "FromPort": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
            "Endpoint.Port",
          ],
        },
        "GroupId": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroup333F94D8",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerFargateComputeEnvironmentSecurityGroup1141A545",
            "GroupId",
          ],
        },
        "ToPort": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
            "Endpoint.Port",
          ],
        },
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroupfromprefixGenAIChatBotStackRagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionSecurityGroupBCA1570BIndirectPortC0A48B57": {
      "Properties": {
        "Description": "from prefixGenAIChatBotStackRagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionSecurityGroupBCA1570B:{IndirectPort}",
        "FromPort": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
            "Endpoint.Port",
          ],
        },
        "GroupId": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroup333F94D8",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "RagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionSecurityGroupD7C57FB7",
            "GroupId",
          ],
        },
        "ToPort": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
            "Endpoint.Port",
          ],
        },
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroupfromprefixGenAIChatBotStackRagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunctionSecurityGroupCBB81808IndirectPort368BBCEB": {
      "Properties": {
        "Description": "from prefixGenAIChatBotStackRagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunctionSecurityGroupCBB81808:{IndirectPort}",
        "FromPort": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
            "Endpoint.Port",
          ],
        },
        "GroupId": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroup333F94D8",
            "GroupId",
          ],
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": [
            "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunctionSecurityGroup9E919F5A",
            "GroupId",
          ],
        },
        "ToPort": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
            "Endpoint.Port",
          ],
        },
      },
      "Type": "AWS::EC2::SecurityGroupIngress",
    },
    "RagEnginesAuroraPgVectorAuroraDatabaseServerlessInstance42B5CDC1": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "SharedVPCisolatedSubnet1RouteTableAssociation9FA2357F",
        "SharedVPCisolatedSubnet2RouteTableAssociation61642BDD",
        "SharedVPCisolatedSubnet3RouteTableAssociation985AF926",
      ],
      "Properties": {
        "DBClusterIdentifier": {
          "Ref": "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
        },
        "DBInstanceClass": "db.serverless",
        "Engine": "aurora-postgresql",
        "PromotionTier": 0,
        "PubliclyAccessible": false,
      },
      "Type": "AWS::RDS::DBInstance",
      "UpdateReplacePolicy": "Delete",
    },
    "RagEnginesAuroraPgVectorAuroraDatabaseSubnets038B8C27": {
      "Properties": {
        "DBSubnetGroupDescription": "Subnets for AuroraDatabase database",
        "SubnetIds": [
          {
            "Ref": "SharedVPCisolatedSubnet1SubnetAE743C40",
          },
          {
            "Ref": "SharedVPCisolatedSubnet2SubnetBC723A26",
          },
          {
            "Ref": "SharedVPCisolatedSubnet3Subnet93F04F54",
          },
        ],
      },
      "Type": "AWS::RDS::DBSubnetGroup",
    },
    "RagEnginesAuroraPgVectorCreateAuroraWorkspace50EFF4E7": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "RagEnginesAuroraPgVectorCreateAuroraWorkspaceRoleDefaultPolicy6BBDADB0",
        "RagEnginesAuroraPgVectorCreateAuroraWorkspaceRoleB7D93D09",
      ],
      "Properties": {
        "DefinitionString": {
          "Fn::Join": [
            "",
            [
              "{"StartAt":"SetCreating","States":{"SetCreating":{"Next":"Create","Type":"Task","ResultPath":null,"Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::dynamodb:updateItem","Parameters":{"Key":{"workspace_id":{"S.$":"$.workspace_id"},"object_type":{"S":"workspace"}},"TableName":"",
              {
                "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
              },
              "","ExpressionAttributeNames":{"#status":"status"},"ExpressionAttributeValues":{":statusValue":{"S":"creating"}},"UpdateExpression":"set #status=:statusValue"}},"Create":{"Next":"SetReady","Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Catch":[{"ErrorEquals":["States.ALL"],"ResultPath":"$.createResult","Next":"HandleError"}],"Type":"Task","ResultPath":"$.createResult","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::lambda:invoke","Parameters":{"FunctionName":"",
              {
                "Fn::GetAtt": [
                  "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionEC174778",
                  "Arn",
                ],
              },
              "","Payload.$":"$"}},"SetReady":{"Next":"Success","Type":"Task","ResultPath":null,"Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::dynamodb:updateItem","Parameters":{"Key":{"workspace_id":{"S.$":"$.workspace_id"},"object_type":{"S":"workspace"}},"TableName":"",
              {
                "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
              },
              "","ExpressionAttributeNames":{"#status":"status"},"ExpressionAttributeValues":{":statusValue":{"S":"ready"}},"UpdateExpression":"set #status=:statusValue"}},"Success":{"Type":"Succeed"},"HandleError":{"Next":"Fail","Type":"Task","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::dynamodb:updateItem","Parameters":{"Key":{"workspace_id":{"S.$":"$.workspace_id"},"object_type":{"S":"workspace"}},"TableName":"",
              {
                "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
              },
              "","ExpressionAttributeNames":{"#status":"status"},"ExpressionAttributeValues":{":error":{"S":"error"}},"UpdateExpression":"set #status = :error"}},"Fail":{"Type":"Fail","Cause":"Workspace creation failed"}},"TimeoutSeconds":300,"Comment":"Create Aurora Workspace Workflow"}",
            ],
          ],
        },
        "LoggingConfiguration": {
          "Destinations": [
            {
              "CloudWatchLogsLogGroup": {
                "LogGroupArn": {
                  "Fn::GetAtt": [
                    "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceSMLogGroup3134E68A",
                    "Arn",
                  ],
                },
              },
            },
          ],
          "Level": "ALL",
        },
        "RoleArn": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorCreateAuroraWorkspaceRoleB7D93D09",
            "Arn",
          ],
        },
        "TracingConfiguration": {
          "Enabled": true,
        },
      },
      "Type": "AWS::StepFunctions::StateMachine",
      "UpdateReplacePolicy": "Delete",
    },
    "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionEC174778": {
      "DependsOn": [
        "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionServiceRoleDefaultPolicy2EE26FD3",
        "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionServiceRole11C35928",
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "Architectures": [
          "x86_64",
        ],
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "Creates Aurora workspace",
        "Environment": {
          "Variables": {
            "AURORA_DB_HOST": {
              "Fn::GetAtt": [
                "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                "Endpoint.Address",
              ],
            },
            "AURORA_DB_PORT": {
              "Fn::GetAtt": [
                "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                "Endpoint.Port",
              ],
            },
            "AURORA_DB_USER": "aurora_db_iam_admin",
            "AWS_XRAY_SDK_ENABLED": "false",
            "LOG_LEVEL": "INFO",
            "POWERTOOLS_DEV": "false",
            "POWERTOOLS_LOGGER_LOG_EVENT": "false",
            "POWERTOOLS_SERVICE_NAME": "chatbot",
            "POWERTOOLS_TRACE_DISABLED": "true",
            "WORKSPACES_BY_OBJECT_TYPE_INDEX_NAME": "by_object_type_idx",
            "WORKSPACES_TABLE_NAME": {
              "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
            },
          },
        },
        "Handler": "index.lambda_handler",
        "Layers": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":lambda:",
                {
                  "Ref": "AWS::Region",
                },
                ":017000801446:layer:AWSLambdaPowertoolsPythonV3-python311-x86_64:2",
              ],
            ],
          },
          {
            "Ref": "SharedCommonLayerFC89CBCE",
          },
        ],
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "Role": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionServiceRole11C35928",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
        "Timeout": 300,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionSecurityGroup1A0FE458",
                "GroupId",
              ],
            },
          ],
          "SubnetIds": [
            {
              "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
            },
            {
              "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
            },
            {
              "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
            },
          ],
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionLogRetentionD92D6B68": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionEC174778",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionSecurityGroup1A0FE458": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "GroupDescription": "Automatic security group for Lambda Function prefixGenAIChatBotStackRagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunction2DCA9A2D",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionServiceRole11C35928": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionServiceRoleDefaultPolicy2EE26FD3": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "rds-db:connect",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":rds-db:us-east-1:111111111:dbuser:",
                    {
                      "Fn::GetAtt": [
                        "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                        "DBClusterResourceId",
                      ],
                    },
                    "/aurora_db_iam_admin",
                  ],
                ],
              },
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionServiceRoleDefaultPolicy2EE26FD3",
        "Roles": [
          {
            "Ref": "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionServiceRole11C35928",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceSMLogGroup3134E68A": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "LogGroupName": "/aws/vendedlogs/states/CreateAuroraWorkspace-c85defe1059e7fe274e5d32dfa5fbf22bf25029784",
        "RetentionInDays": 731,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesAuroraPgVectorCreateAuroraWorkspaceRoleB7D93D09": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "states.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesAuroraPgVectorCreateAuroraWorkspaceRoleDefaultPolicy6BBDADB0": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "dynamodb:UpdateItem",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":dynamodb:us-east-1:111111111:table/",
                    {
                      "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                    },
                  ],
                ],
              },
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionEC174778",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionEC174778",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "logs:CreateLogDelivery",
                "logs:GetLogDelivery",
                "logs:UpdateLogDelivery",
                "logs:DeleteLogDelivery",
                "logs:ListLogDeliveries",
                "logs:PutResourcePolicy",
                "logs:DescribeResourcePolicies",
                "logs:DescribeLogGroups",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
                "xray:GetSamplingRules",
                "xray:GetSamplingTargets",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesAuroraPgVectorCreateAuroraWorkspaceRoleDefaultPolicy6BBDADB0",
        "Roles": [
          {
            "Ref": "RagEnginesAuroraPgVectorCreateAuroraWorkspaceRoleB7D93D09",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesAuroraPgVectorDatabaseSetupExtensionsAndUserscmk099B67F6": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
        "RagEnginesAuroraPgVectorAuroraDatabaseSecretAttachmentA167E2A9",
        "RagEnginesAuroraPgVectorAuroraDatabaseSecretBF0EF63E",
        "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroupfromprefixGenAIChatBotStackChatBotApiRestApiApiSecurityGroup777E7B0FIndirectPortFB3425A8",
        "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroupfromprefixGenAIChatBotStackLangchainInterfaceRequestHandlerSecurityGroupB2D839AFIndirectPort986F7CFB",
        "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroupfromprefixGenAIChatBotStackRagEnginesAuroraPgVectorCreateAuroraWorkspaceCreateAuroraWorkspaceFunctionSecurityGroupCA3FBD41IndirectPort2E9A07FB",
        "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroupfromprefixGenAIChatBotStackRagEnginesAuroraPgVectorDatabaseSetupFunctionSecurityGroup5F090D4DIndirectPort4DDBF43D",
        "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroupfromprefixGenAIChatBotStackRagEnginesDataImportFileImportBatchJobFargateComputeEnvironmentSecurityGroupD501189BIndirectPortA2FD26DA",
        "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroupfromprefixGenAIChatBotStackRagEnginesDataImportWebCrawlerBatchJobWebCrawlerFargateComputeEnvironmentSecurityGroup692C5DACIndirectPortDC5EAC53",
        "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroupfromprefixGenAIChatBotStackRagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionSecurityGroupBCA1570BIndirectPortC0A48B57",
        "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroupfromprefixGenAIChatBotStackRagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunctionSecurityGroupCBB81808IndirectPort368BBCEB",
        "RagEnginesAuroraPgVectorAuroraDatabaseSecurityGroup333F94D8",
        "RagEnginesAuroraPgVectorAuroraDatabaseServerlessInstance42B5CDC1",
        "RagEnginesAuroraPgVectorAuroraDatabaseSubnets038B8C27",
      ],
      "Properties": {
        "AURORA_DB_SECRET_ID": {
          "Ref": "RagEnginesAuroraPgVectorAuroraDatabaseSecretAttachmentA167E2A9",
        },
        "ServiceToken": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorDatabaseSetupProviderframeworkonEvent66CC77D0",
            "Arn",
          ],
        },
      },
      "Type": "AWS::CloudFormation::CustomResource",
      "UpdateReplacePolicy": "Delete",
    },
    "RagEnginesAuroraPgVectorDatabaseSetupFunction3EAE1D9D": {
      "DependsOn": [
        "RagEnginesAuroraPgVectorDatabaseSetupFunctionServiceRoleDefaultPolicy526D1214",
        "RagEnginesAuroraPgVectorDatabaseSetupFunctionServiceRole09B67CA3",
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "Architectures": [
          "x86_64",
        ],
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "Users and PGVector setup",
        "Environment": {
          "Variables": {
            "AWS_XRAY_SDK_ENABLED": "false",
            "LOG_LEVEL": "INFO",
            "POWERTOOLS_DEV": "false",
            "POWERTOOLS_LOGGER_LOG_EVENT": "false",
            "POWERTOOLS_SERVICE_NAME": "chatbot",
            "POWERTOOLS_TRACE_DISABLED": "true",
          },
        },
        "Handler": "index.lambda_handler",
        "Layers": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":lambda:",
                {
                  "Ref": "AWS::Region",
                },
                ":017000801446:layer:AWSLambdaPowertoolsPythonV3-python311-x86_64:2",
              ],
            ],
          },
          {
            "Ref": "SharedCommonLayerFC89CBCE",
          },
        ],
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "Role": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorDatabaseSetupFunctionServiceRole09B67CA3",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
        "Timeout": 300,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "RagEnginesAuroraPgVectorDatabaseSetupFunctionSecurityGroupDFD5001A",
                "GroupId",
              ],
            },
          ],
          "SubnetIds": [
            {
              "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
            },
            {
              "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
            },
            {
              "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
            },
          ],
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "RagEnginesAuroraPgVectorDatabaseSetupFunctionLogRetention64E74D31": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "RagEnginesAuroraPgVectorDatabaseSetupFunction3EAE1D9D",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "RagEnginesAuroraPgVectorDatabaseSetupFunctionSecurityGroupDFD5001A": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "GroupDescription": "Automatic security group for Lambda Function prefixGenAIChatBotStackRagEnginesAuroraPgVectorDatabaseSetupFunction3DD26B1C",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "RagEnginesAuroraPgVectorDatabaseSetupFunctionServiceRole09B67CA3": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesAuroraPgVectorDatabaseSetupFunctionServiceRoleDefaultPolicy526D1214": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "RagEnginesAuroraPgVectorAuroraDatabaseSecretAttachmentA167E2A9",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesAuroraPgVectorDatabaseSetupFunctionServiceRoleDefaultPolicy526D1214",
        "Roles": [
          {
            "Ref": "RagEnginesAuroraPgVectorDatabaseSetupFunctionServiceRole09B67CA3",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesAuroraPgVectorDatabaseSetupProviderframeworkonEvent66CC77D0": {
      "DependsOn": [
        "RagEnginesAuroraPgVectorDatabaseSetupProviderframeworkonEventServiceRoleDefaultPolicy5EC166EF",
        "RagEnginesAuroraPgVectorDatabaseSetupProviderframeworkonEventServiceRoleD8C445F8",
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "AWS CDK resource provider framework - onEvent (prefixGenAIChatBotStack/RagEngines/AuroraPgVector/DatabaseSetupProvider)",
        "Environment": {
          "Variables": {
            "USER_ON_EVENT_FUNCTION_ARN": {
              "Fn::GetAtt": [
                "RagEnginesAuroraPgVectorDatabaseSetupFunction3EAE1D9D",
                "Arn",
              ],
            },
          },
        },
        "Handler": "framework.onEvent",
        "Role": {
          "Fn::GetAtt": [
            "RagEnginesAuroraPgVectorDatabaseSetupProviderframeworkonEventServiceRoleD8C445F8",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Timeout": 900,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "RagEnginesAuroraPgVectorDatabaseSetupProviderframeworkonEventSecurityGroupF05C7F01",
                "GroupId",
              ],
            },
          ],
          "SubnetIds": [
            {
              "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
            },
            {
              "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
            },
            {
              "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
            },
          ],
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "RagEnginesAuroraPgVectorDatabaseSetupProviderframeworkonEventSecurityGroupF05C7F01": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "GroupDescription": "Automatic security group for Lambda Function prefixGenAIChatBotStackRagEnginesAuroraPgVectorDatabaseSetupProviderframeworkonEventDC6DE399",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "RagEnginesAuroraPgVectorDatabaseSetupProviderframeworkonEventServiceRoleD8C445F8": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesAuroraPgVectorDatabaseSetupProviderframeworkonEventServiceRoleDefaultPolicy5EC166EF": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesAuroraPgVectorDatabaseSetupFunction3EAE1D9D",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesAuroraPgVectorDatabaseSetupFunction3EAE1D9D",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesAuroraPgVectorDatabaseSetupProviderframeworkonEventServiceRoleDefaultPolicy5EC166EF",
        "Roles": [
          {
            "Ref": "RagEnginesAuroraPgVectorDatabaseSetupProviderframeworkonEventServiceRoleD8C445F8",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesDataImportFileImportBatchJobFargateComputeEnvironmentA4E537F2": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "RagEnginesDataImportFileImportBatchJobFargateComputeEnvironmentSecurityGroupDBC1F0DD",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            {
              "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
            },
            {
              "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
            },
            {
              "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
            },
          ],
          "Type": "FARGATE",
          "UpdateToLatestImageVersion": true,
        },
        "ReplaceComputeEnvironment": true,
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {
          "JobExecutionTimeoutMinutes": 30,
        },
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "RagEnginesDataImportFileImportBatchJobFargateComputeEnvironmentSecurityGroupDBC1F0DD": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/RagEngines/DataImport/FileImportBatchJob/FargateComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "RagEnginesDataImportFileImportBatchJobFileImportContainerExecutionRoleDEA643AB": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesDataImportFileImportBatchJobFileImportContainerExecutionRoleDefaultPolicy074B9209": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":logs:us-east-1:111111111:log-group:/aws/batch/job:*",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:us-east-1:111111111:repository/cdk-hnb659fds-container-assets-111111111-us-east-1",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesDataImportFileImportBatchJobFileImportContainerExecutionRoleDefaultPolicy074B9209",
        "Roles": [
          {
            "Ref": "RagEnginesDataImportFileImportBatchJobFileImportContainerExecutionRoleDEA643AB",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesDataImportFileImportBatchJobFileImportJob25E94A14": {
      "Properties": {
        "ContainerProperties": {
          "Environment": [
            {
              "Name": "AWS_DEFAULT_REGION",
              "Value": "us-east-1",
            },
            {
              "Name": "CONFIG_PARAMETER_NAME",
              "Value": {
                "Ref": "SharedConfig358B4A20",
              },
            },
            {
              "Name": "API_KEYS_SECRETS_ARN",
              "Value": {
                "Ref": "SharedApiKeysSecret9EA666ED",
              },
            },
            {
              "Name": "AURORA_DB_USER",
              "Value": "aurora_db_iam_write",
            },
            {
              "Name": "AURORA_DB_HOST",
              "Value": {
                "Fn::GetAtt": [
                  "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                  "Endpoint.Address",
                ],
              },
            },
            {
              "Name": "AURORA_DB_PORT",
              "Value": {
                "Fn::GetAtt": [
                  "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                  "Endpoint.Port",
                ],
              },
            },
            {
              "Name": "PROCESSING_BUCKET_NAME",
              "Value": {
                "Ref": "RagEnginesDataImportProcessingBucketA7BE9701",
              },
            },
            {
              "Name": "WORKSPACES_TABLE_NAME",
              "Value": {
                "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
              },
            },
            {
              "Name": "WORKSPACES_BY_OBJECT_TYPE_INDEX_NAME",
              "Value": "by_object_type_idx",
            },
            {
              "Name": "DOCUMENTS_TABLE_NAME",
              "Value": {
                "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
              },
            },
            {
              "Name": "DOCUMENTS_BY_COMPOUND_KEY_INDEX_NAME",
              "Value": "by_compound_key_idx",
            },
            {
              "Name": "SAGEMAKER_RAG_MODELS_ENDPOINT",
              "Value": {
                "Fn::GetAtt": [
                  "RagEnginesSageMakerModelMultiAB24AEndpoint6DA7D681",
                  "EndpointName",
                ],
              },
            },
            {
              "Name": "OPEN_SEARCH_COLLECTION_ENDPOINT",
              "Value": {
                "Fn::GetAtt": [
                  "RagEnginesOpenSearchVectorOpenSearchCollectionCMK872E47D8",
                  "CollectionEndpoint",
                ],
              },
            },
          ],
          "EphemeralStorage": {
            "SizeInGiB": 40,
          },
          "ExecutionRoleArn": {
            "Fn::GetAtt": [
              "RagEnginesDataImportFileImportBatchJobFileImportContainerExecutionRoleDEA643AB",
              "Arn",
            ],
          },
          "FargatePlatformConfiguration": {},
          "Image": [
            "Dummy",
          ],
          "JobRoleArn": {
            "Fn::GetAtt": [
              "RagEnginesDataImportFileImportBatchJobFileImportJobRoleCA3E6A38",
              "Arn",
            ],
          },
          "NetworkConfiguration": {
            "AssignPublicIp": "DISABLED",
          },
          "ReadonlyRootFilesystem": false,
          "ResourceRequirements": [
            {
              "Type": "MEMORY",
              "Value": "4096",
            },
            {
              "Type": "VCPU",
              "Value": "2",
            },
          ],
          "RuntimePlatform": {},
        },
        "PlatformCapabilities": [
          "FARGATE",
        ],
        "RetryStrategy": {
          "Attempts": 3,
          "EvaluateOnExit": [
            {
              "Action": "EXIT",
              "OnReason": "CannotPullContainerError:*",
            },
            {
              "Action": "EXIT",
              "OnExitCode": "137",
            },
          ],
        },
        "Timeout": {
          "AttemptDurationSeconds": 1800,
        },
        "Type": "container",
      },
      "Type": "AWS::Batch::JobDefinition",
    },
    "RagEnginesDataImportFileImportBatchJobFileImportJobRoleCA3E6A38": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "Allow user freedom of model usage in Bedrock.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "Access to all log groups required for CloudWatch log group creation.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "S3 write access required for upload and processing buckets.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesDataImportFileImportBatchJobFileImportJobRoleDefaultPolicy4484553B": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportUploadBucket061D697E",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportUploadBucket061D697E",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportProcessingBucketA7BE9701",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportProcessingBucketA7BE9701",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:us-east-1:111111111:parameter/",
                    {
                      "Ref": "SharedConfig358B4A20",
                    },
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SharedApiKeysSecret9EA666ED",
              },
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "rds-db:connect",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":rds-db:us-east-1:111111111:dbuser:",
                    {
                      "Fn::GetAtt": [
                        "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                        "DBClusterResourceId",
                      ],
                    },
                    "/aurora_db_iam_write",
                  ],
                ],
              },
            },
            {
              "Action": "aoss:APIAccessAll",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RagEnginesOpenSearchVectorOpenSearchCollectionCMK872E47D8",
                  "Arn",
                ],
              },
            },
            {
              "Action": "states:StartExecution",
              "Effect": "Allow",
              "Resource": {
                "Ref": "RagEnginesOpenSearchVectorCreateOpenSearchWorkspace2B2FCA5B",
              },
            },
            {
              "Action": "sagemaker:InvokeEndpoint",
              "Effect": "Allow",
              "Resource": {
                "Ref": "RagEnginesSageMakerModelMultiAB24AEndpoint6DA7D681",
              },
            },
            {
              "Action": [
                "bedrock:InvokeModel",
                "bedrock:InvokeModelWithResponseStream",
              ],
              "Effect": "Allow",
              "Resource": "arn:aws:bedrock:*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesDataImportFileImportBatchJobFileImportJobRoleDefaultPolicy4484553B",
        "Roles": [
          {
            "Ref": "RagEnginesDataImportFileImportBatchJobFileImportJobRoleCA3E6A38",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesDataImportFileImportBatchJobJobQueueE1C15E4F": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "RagEnginesDataImportFileImportBatchJobFargateComputeEnvironmentA4E537F2",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "RagEnginesDataImportFileImportWorkflowFileImportSMLogGroupACEA6D66": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "LogGroupName": "/aws/vendedlogs/states/FileImportStateMachine-c8cf719aab95cd313558c24b954a4d64738cc90e28",
        "RetentionInDays": 731,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesDataImportFileImportWorkflowFileImportStateMachine398F0217": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "RagEnginesDataImportFileImportWorkflowFileImportStateMachineRoleDefaultPolicy7FF08756",
        "RagEnginesDataImportFileImportWorkflowFileImportStateMachineRoleA0F445C3",
      ],
      "Properties": {
        "DefinitionString": {
          "Fn::Join": [
            "",
            [
              "{"StartAt":"SetProcessing","States":{"SetProcessing":{"Next":"FileImportJob","Type":"Task","ResultPath":null,"Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::dynamodb:updateItem","Parameters":{"Key":{"workspace_id":{"S.$":"$.workspace_id"},"document_id":{"S.$":"$.document_id"}},"TableName":"",
              {
                "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
              },
              "","ExpressionAttributeNames":{"#status":"status"},"ExpressionAttributeValues":{":statusValue":{"S":"processing"}},"UpdateExpression":"set #status=:statusValue"}},"FileImportJob":{"Next":"SetProcessed","Type":"Task","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::batch:submitJob.sync","Parameters":{"JobDefinition":"",
              {
                "Ref": "RagEnginesDataImportFileImportBatchJobFileImportJob25E94A14",
              },
              "","JobName.$":"States.Format('FileImport-{}-{}', $.workspace_id, $.document_id)","JobQueue":"",
              {
                "Fn::GetAtt": [
                  "RagEnginesDataImportFileImportBatchJobJobQueueE1C15E4F",
                  "JobQueueArn",
                ],
              },
              "","ContainerOverrides":{"Environment":[{"Name":"WORKSPACE_ID","Value.$":"$.workspace_id"},{"Name":"DOCUMENT_ID","Value.$":"$.document_id"},{"Name":"INPUT_BUCKET_NAME","Value.$":"$.input_bucket_name"},{"Name":"INPUT_OBJECT_KEY","Value.$":"$.input_object_key"},{"Name":"PROCESSING_BUCKET_NAME","Value.$":"$.processing_bucket_name"},{"Name":"PROCESSING_OBJECT_KEY","Value.$":"$.processing_object_key"}]}},"ResultPath":"$.job"},"SetProcessed":{"Next":"Success","Type":"Task","ResultPath":null,"Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::dynamodb:updateItem","Parameters":{"Key":{"workspace_id":{"S.$":"$.workspace_id"},"document_id":{"S.$":"$.document_id"}},"TableName":"",
              {
                "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
              },
              "","ExpressionAttributeNames":{"#status":"status"},"ExpressionAttributeValues":{":statusValue":{"S":"processed"}},"UpdateExpression":"set #status=:statusValue"}},"Success":{"Type":"Succeed"}},"TimeoutSeconds":43200,"Comment":"File import workflow"}",
            ],
          ],
        },
        "LoggingConfiguration": {
          "Destinations": [
            {
              "CloudWatchLogsLogGroup": {
                "LogGroupArn": {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportFileImportWorkflowFileImportSMLogGroupACEA6D66",
                    "Arn",
                  ],
                },
              },
            },
          ],
          "Level": "ALL",
        },
        "RoleArn": {
          "Fn::GetAtt": [
            "RagEnginesDataImportFileImportWorkflowFileImportStateMachineRoleA0F445C3",
            "Arn",
          ],
        },
        "TracingConfiguration": {
          "Enabled": true,
        },
      },
      "Type": "AWS::StepFunctions::StateMachine",
      "UpdateReplacePolicy": "Delete",
    },
    "RagEnginesDataImportFileImportWorkflowFileImportStateMachineRoleA0F445C3": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "states.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesDataImportFileImportWorkflowFileImportStateMachineRoleDefaultPolicy7FF08756": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "dynamodb:UpdateItem",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":dynamodb:us-east-1:111111111:table/",
                    {
                      "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                    },
                  ],
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogDelivery",
                "logs:GetLogDelivery",
                "logs:UpdateLogDelivery",
                "logs:DeleteLogDelivery",
                "logs:ListLogDeliveries",
                "logs:PutResourcePolicy",
                "logs:DescribeResourcePolicies",
                "logs:DescribeLogGroups",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
                "xray:GetSamplingRules",
                "xray:GetSamplingTargets",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "events:CreateRule",
                "events:PutRule",
                "events:PutTargets",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "batch:SubmitJob",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportFileImportBatchJobJobQueueE1C15E4F",
                    "JobQueueArn",
                  ],
                },
                {
                  "Ref": "RagEnginesDataImportFileImportBatchJobFileImportJob25E94A14",
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesDataImportFileImportWorkflowFileImportStateMachineRoleDefaultPolicy7FF08756",
        "Roles": [
          {
            "Ref": "RagEnginesDataImportFileImportWorkflowFileImportStateMachineRoleA0F445C3",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesDataImportIngestionDeadLetterQueue4A2F3D18": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "KmsMasterKeyId": {
          "Fn::GetAtt": [
            "SharedQueueKMSKey26598E83",
            "Arn",
          ],
        },
        "VisibilityTimeout": 900,
      },
      "Type": "AWS::SQS::Queue",
      "UpdateReplacePolicy": "Delete",
    },
    "RagEnginesDataImportIngestionDeadLetterQueuePolicy8AACED11": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sqs:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "RagEnginesDataImportIngestionDeadLetterQueue4A2F3D18",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Queues": [
          {
            "Ref": "RagEnginesDataImportIngestionDeadLetterQueue4A2F3D18",
          },
        ],
      },
      "Type": "AWS::SQS::QueuePolicy",
    },
    "RagEnginesDataImportIngestionQueue045D880F": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "KmsMasterKeyId": {
          "Fn::GetAtt": [
            "SharedQueueKMSKey26598E83",
            "Arn",
          ],
        },
        "RedrivePolicy": {
          "deadLetterTargetArn": {
            "Fn::GetAtt": [
              "RagEnginesDataImportIngestionDeadLetterQueue4A2F3D18",
              "Arn",
            ],
          },
          "maxReceiveCount": 3,
        },
        "VisibilityTimeout": 900,
      },
      "Type": "AWS::SQS::Queue",
      "UpdateReplacePolicy": "Delete",
    },
    "RagEnginesDataImportIngestionQueuePolicy0355D08F": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sqs:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "RagEnginesDataImportIngestionQueue045D880F",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "sqs:SendMessage",
                "sqs:GetQueueAttributes",
                "sqs:GetQueueUrl",
              ],
              "Condition": {
                "ArnLike": {
                  "aws:SourceArn": {
                    "Fn::GetAtt": [
                      "RagEnginesDataImportUploadBucket061D697E",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Principal": {
                "Service": "s3.amazonaws.com",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "RagEnginesDataImportIngestionQueue045D880F",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Queues": [
          {
            "Ref": "RagEnginesDataImportIngestionQueue045D880F",
          },
        ],
      },
      "Type": "AWS::SQS::QueuePolicy",
    },
    "RagEnginesDataImportProcessingBucketA7BE9701": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "KMSMasterKeyID": {
                  "Fn::GetAtt": [
                    "SharedKMSKey7BCBB616",
                    "Arn",
                  ],
                },
                "SSEAlgorithm": "aws:kms",
              },
            },
          ],
        },
        "LoggingConfiguration": {
          "DestinationBucketName": {
            "Ref": "RagEnginesDataImportProcessingLogsBucketB9FC694F",
          },
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "VersioningConfiguration": {
          "Status": "Enabled",
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesDataImportProcessingBucketPolicy87702EA3": {
      "Properties": {
        "Bucket": {
          "Ref": "RagEnginesDataImportProcessingBucketA7BE9701",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportProcessingBucketA7BE9701",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportProcessingBucketA7BE9701",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "RagEnginesDataImportProcessingLogsBucketB9FC694F": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-S1",
              "reason": "Logging bucket does not require it's own access logs.",
            },
          ],
        },
      },
      "Properties": {
        "AccessControl": "LogDeliveryWrite",
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256",
              },
            },
          ],
        },
        "OwnershipControls": {
          "Rules": [
            {
              "ObjectOwnership": "ObjectWriter",
            },
          ],
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "VersioningConfiguration": {
          "Status": "Enabled",
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesDataImportProcessingLogsBucketPolicy1FE4B16D": {
      "Properties": {
        "Bucket": {
          "Ref": "RagEnginesDataImportProcessingLogsBucketB9FC694F",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportProcessingLogsBucketB9FC694F",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportProcessingLogsBucketB9FC694F",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "RagEnginesDataImportRssSubscriptionCrawlQueuedRssPostsScheduleRuleAllowEventRuleprefixGenAIChatBotStackRagEnginesDataImportRssSubscriptioncrawlQueuedRssPostsFunction7214194D67C4B855": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RagEnginesDataImportRssSubscriptioncrawlQueuedRssPostsFunction7348FF25",
            "Arn",
          ],
        },
        "Principal": "events.amazonaws.com",
        "SourceArn": {
          "Fn::GetAtt": [
            "RagEnginesDataImportRssSubscriptionCrawlQueuedRssPostsScheduleRuleD709D79A",
            "Arn",
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "RagEnginesDataImportRssSubscriptionCrawlQueuedRssPostsScheduleRuleD709D79A": {
      "Properties": {
        "ScheduleExpression": "rate(5 minutes)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "RagEnginesDataImportRssSubscriptioncrawlQueuedRssPostsFunction7348FF25",
                "Arn",
              ],
            },
            "Id": "Target0",
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "RagEnginesDataImportRssSubscriptionRssIngestorC19E7D9E": {
      "DependsOn": [
        "RagEnginesDataImportRssSubscriptionRssIngestorServiceRoleDefaultPolicy2141DA1C",
        "RagEnginesDataImportRssSubscriptionRssIngestorServiceRole8A064A12",
      ],
      "Properties": {
        "Architectures": [
          "x86_64",
        ],
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "Retrieves the latest data from the RSS Feed and adds any newly found posts to be queued for Website Crawling",
        "Environment": {
          "Variables": {
            "AWS_XRAY_SDK_ENABLED": "false",
            "CONFIG_PARAMETER_NAME": {
              "Ref": "SharedConfig358B4A20",
            },
            "DOCUMENTS_BY_COMPOUND_KEY_INDEX_NAME": "by_compound_key_idx",
            "DOCUMENTS_BY_STATUS_INDEX": "by_status_idx",
            "DOCUMENTS_TABLE_NAME": {
              "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
            },
            "LOG_LEVEL": "INFO",
            "POWERTOOLS_DEV": "false",
            "POWERTOOLS_LOGGER_LOG_EVENT": "false",
            "POWERTOOLS_SERVICE_NAME": "chatbot",
            "POWERTOOLS_TRACE_DISABLED": "true",
            "WORKSPACES_BY_OBJECT_TYPE_INDEX_NAME": "by_object_type_idx",
            "WORKSPACES_TABLE_NAME": {
              "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
            },
          },
        },
        "Handler": "index.lambda_handler",
        "Layers": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":lambda:",
                {
                  "Ref": "AWS::Region",
                },
                ":017000801446:layer:AWSLambdaPowertoolsPythonV3-python311-x86_64:2",
              ],
            ],
          },
          {
            "Ref": "SharedCommonLayerFC89CBCE",
          },
        ],
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "MemorySize": 1024,
        "Role": {
          "Fn::GetAtt": [
            "RagEnginesDataImportRssSubscriptionRssIngestorServiceRole8A064A12",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "RagEnginesDataImportRssSubscriptionRssIngestorLogRetention69A2EE38": {
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "RagEnginesDataImportRssSubscriptionRssIngestorC19E7D9E",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "RagEnginesDataImportRssSubscriptionRssIngestorServiceRole8A064A12": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesDataImportRssSubscriptionRssIngestorServiceRoleDefaultPolicy2141DA1C": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:us-east-1:111111111:parameter/",
                    {
                      "Ref": "SharedConfig358B4A20",
                    },
                  ],
                ],
              },
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesDataImportRssSubscriptionRssIngestorServiceRoleDefaultPolicy2141DA1C",
        "Roles": [
          {
            "Ref": "RagEnginesDataImportRssSubscriptionRssIngestorServiceRole8A064A12",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesDataImportRssSubscriptioncrawlQueuedRssPostsFunction7348FF25": {
      "DependsOn": [
        "RagEnginesDataImportRssSubscriptioncrawlQueuedRssPostsFunctionServiceRoleDefaultPolicyBBFDEFE1",
        "RagEnginesDataImportRssSubscriptioncrawlQueuedRssPostsFunctionServiceRole7782929B",
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "Architectures": [
          "x86_64",
        ],
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "Functions polls the RSS items for pending urls and invokes Website crawler inference. Max of 10 URLs per invoke.",
        "Environment": {
          "Variables": {
            "AWS_XRAY_SDK_ENABLED": "false",
            "CONFIG_PARAMETER_NAME": {
              "Ref": "SharedConfig358B4A20",
            },
            "DOCUMENTS_BY_COMPOUND_KEY_INDEX_NAME": "by_compound_key_idx",
            "DOCUMENTS_BY_STATUS_INDEX": "by_status_idx",
            "DOCUMENTS_TABLE_NAME": {
              "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
            },
            "LOG_LEVEL": "INFO",
            "POWERTOOLS_DEV": "false",
            "POWERTOOLS_LOGGER_LOG_EVENT": "false",
            "POWERTOOLS_SERVICE_NAME": "chatbot",
            "POWERTOOLS_TRACE_DISABLED": "true",
            "PROCESSING_BUCKET_NAME": {
              "Ref": "RagEnginesDataImportProcessingBucketA7BE9701",
            },
            "WEBSITE_CRAWLING_WORKFLOW_ARN": {
              "Ref": "RagEnginesDataImportWebsiteCrawlingWorkflowWebsiteCrawling9B1CEC96",
            },
            "WORKSPACES_BY_OBJECT_TYPE_INDEX_NAME": "by_object_type_idx",
            "WORKSPACES_TABLE_NAME": {
              "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
            },
          },
        },
        "Handler": "index.lambda_handler",
        "Layers": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":lambda:",
                {
                  "Ref": "AWS::Region",
                },
                ":017000801446:layer:AWSLambdaPowertoolsPythonV3-python311-x86_64:2",
              ],
            ],
          },
          {
            "Ref": "SharedCommonLayerFC89CBCE",
          },
        ],
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "MemorySize": 1024,
        "Role": {
          "Fn::GetAtt": [
            "RagEnginesDataImportRssSubscriptioncrawlQueuedRssPostsFunctionServiceRole7782929B",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
        "Timeout": 300,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "RagEnginesDataImportRssSubscriptioncrawlQueuedRssPostsFunctionSecurityGroupF06E23E0",
                "GroupId",
              ],
            },
          ],
          "SubnetIds": [
            {
              "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
            },
            {
              "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
            },
            {
              "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
            },
          ],
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "RagEnginesDataImportRssSubscriptioncrawlQueuedRssPostsFunctionLogRetention98BE58FB": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "RagEnginesDataImportRssSubscriptioncrawlQueuedRssPostsFunction7348FF25",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "RagEnginesDataImportRssSubscriptioncrawlQueuedRssPostsFunctionSecurityGroupF06E23E0": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "GroupDescription": "Automatic security group for Lambda Function prefixGenAIChatBotStackRagEnginesDataImportRssSubscriptioncrawlQueuedRssPostsFunction7214194D",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "RagEnginesDataImportRssSubscriptioncrawlQueuedRssPostsFunctionServiceRole7782929B": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesDataImportRssSubscriptioncrawlQueuedRssPostsFunctionServiceRoleDefaultPolicyBBFDEFE1": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportProcessingBucketA7BE9701",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportProcessingBucketA7BE9701",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": "states:StartExecution",
              "Effect": "Allow",
              "Resource": {
                "Ref": "RagEnginesDataImportWebsiteCrawlingWorkflowWebsiteCrawling9B1CEC96",
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:us-east-1:111111111:parameter/",
                    {
                      "Ref": "SharedConfig358B4A20",
                    },
                  ],
                ],
              },
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesDataImportRssSubscriptioncrawlQueuedRssPostsFunctionServiceRoleDefaultPolicyBBFDEFE1",
        "Roles": [
          {
            "Ref": "RagEnginesDataImportRssSubscriptioncrawlQueuedRssPostsFunctionServiceRole7782929B",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesDataImportRssSubscriptiontriggerRssIngestorsFunctionE7A345BB": {
      "DependsOn": [
        "RagEnginesDataImportRssSubscriptiontriggerRssIngestorsFunctionServiceRoleDefaultPolicy1C632A18",
        "RagEnginesDataImportRssSubscriptiontriggerRssIngestorsFunctionServiceRoleC2E17ECB",
      ],
      "Properties": {
        "Architectures": [
          "x86_64",
        ],
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "Invokes RSS Feed Ingestors for each Subscribed RSS Feed",
        "Environment": {
          "Variables": {
            "AWS_XRAY_SDK_ENABLED": "false",
            "CONFIG_PARAMETER_NAME": {
              "Ref": "SharedConfig358B4A20",
            },
            "DOCUMENTS_BY_COMPOUND_KEY_INDEX_NAME": "by_compound_key_idx",
            "DOCUMENTS_BY_STATUS_INDEX": "by_status_idx",
            "DOCUMENTS_TABLE_NAME": {
              "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
            },
            "LOG_LEVEL": "INFO",
            "POWERTOOLS_DEV": "false",
            "POWERTOOLS_LOGGER_LOG_EVENT": "false",
            "POWERTOOLS_SERVICE_NAME": "chatbot",
            "POWERTOOLS_TRACE_DISABLED": "true",
            "PROCESSING_BUCKET_NAME": {
              "Ref": "RagEnginesDataImportProcessingBucketA7BE9701",
            },
            "RSS_FEED_INGESTOR_FUNCTION": {
              "Ref": "RagEnginesDataImportRssSubscriptionRssIngestorC19E7D9E",
            },
            "WORKSPACES_BY_OBJECT_TYPE_INDEX_NAME": "by_object_type_idx",
            "WORKSPACES_TABLE_NAME": {
              "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
            },
          },
        },
        "Handler": "index.lambda_handler",
        "Layers": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":lambda:",
                {
                  "Ref": "AWS::Region",
                },
                ":017000801446:layer:AWSLambdaPowertoolsPythonV3-python311-x86_64:2",
              ],
            ],
          },
          {
            "Ref": "SharedCommonLayerFC89CBCE",
          },
        ],
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "MemorySize": 1024,
        "Role": {
          "Fn::GetAtt": [
            "RagEnginesDataImportRssSubscriptiontriggerRssIngestorsFunctionServiceRoleC2E17ECB",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
        "Timeout": 15,
      },
      "Type": "AWS::Lambda::Function",
    },
    "RagEnginesDataImportRssSubscriptiontriggerRssIngestorsFunctionLogRetention44AB99B1": {
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "RagEnginesDataImportRssSubscriptiontriggerRssIngestorsFunctionE7A345BB",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "RagEnginesDataImportRssSubscriptiontriggerRssIngestorsFunctionScheduleAllowEventRuleprefixGenAIChatBotStackRagEnginesDataImportRssSubscriptiontriggerRssIngestorsFunction10F55EF85C97B1F3": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RagEnginesDataImportRssSubscriptiontriggerRssIngestorsFunctionE7A345BB",
            "Arn",
          ],
        },
        "Principal": "events.amazonaws.com",
        "SourceArn": {
          "Fn::GetAtt": [
            "RagEnginesDataImportRssSubscriptiontriggerRssIngestorsFunctionScheduleD95D884A",
            "Arn",
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "RagEnginesDataImportRssSubscriptiontriggerRssIngestorsFunctionScheduleD95D884A": {
      "Properties": {
        "ScheduleExpression": "rate(15 minutes)",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "RagEnginesDataImportRssSubscriptiontriggerRssIngestorsFunctionE7A345BB",
                "Arn",
              ],
            },
            "Id": "Target0",
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "RagEnginesDataImportRssSubscriptiontriggerRssIngestorsFunctionServiceRoleC2E17ECB": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesDataImportRssSubscriptiontriggerRssIngestorsFunctionServiceRoleDefaultPolicy1C632A18": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportRssSubscriptionRssIngestorC19E7D9E",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportRssSubscriptionRssIngestorC19E7D9E",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:us-east-1:111111111:parameter/",
                    {
                      "Ref": "SharedConfig358B4A20",
                    },
                  ],
                ],
              },
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesDataImportRssSubscriptiontriggerRssIngestorsFunctionServiceRoleDefaultPolicy1C632A18",
        "Roles": [
          {
            "Ref": "RagEnginesDataImportRssSubscriptiontriggerRssIngestorsFunctionServiceRoleC2E17ECB",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesDataImportUploadBucket061D697E": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "AccelerateConfiguration": {
          "AccelerationStatus": "Enabled",
        },
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "KMSMasterKeyID": {
                  "Fn::GetAtt": [
                    "SharedKMSKey7BCBB616",
                    "Arn",
                  ],
                },
                "SSEAlgorithm": "aws:kms",
              },
            },
          ],
        },
        "CorsConfiguration": {
          "CorsRules": [
            {
              "AllowedHeaders": [
                "*",
              ],
              "AllowedMethods": [
                "PUT",
                "POST",
                "GET",
                "HEAD",
              ],
              "AllowedOrigins": [
                "*",
              ],
              "ExposedHeaders": [
                "ETag",
              ],
              "MaxAge": 3000,
            },
          ],
        },
        "LoggingConfiguration": {
          "DestinationBucketName": {
            "Ref": "RagEnginesDataImportUploadLogsBucket7D4429F7",
          },
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "VersioningConfiguration": {
          "Status": "Enabled",
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesDataImportUploadBucketNotificationsBC145677": {
      "DependsOn": [
        "RagEnginesDataImportIngestionQueuePolicy0355D08F",
        "RagEnginesDataImportIngestionQueue045D880F",
        "RagEnginesDataImportUploadBucketPolicy05639444",
      ],
      "Properties": {
        "BucketName": {
          "Ref": "RagEnginesDataImportUploadBucket061D697E",
        },
        "Managed": true,
        "NotificationConfiguration": {
          "QueueConfigurations": [
            {
              "Events": [
                "s3:ObjectCreated:*",
              ],
              "QueueArn": {
                "Fn::GetAtt": [
                  "RagEnginesDataImportIngestionQueue045D880F",
                  "Arn",
                ],
              },
            },
            {
              "Events": [
                "s3:ObjectRemoved:*",
              ],
              "QueueArn": {
                "Fn::GetAtt": [
                  "RagEnginesDataImportIngestionQueue045D880F",
                  "Arn",
                ],
              },
            },
          ],
        },
        "ServiceToken": {
          "Fn::GetAtt": [
            "BucketNotificationsHandler050a0587b7544547bf325f094a3db8347ECC3691",
            "Arn",
          ],
        },
        "SkipDestinationValidation": false,
      },
      "Type": "Custom::S3BucketNotifications",
    },
    "RagEnginesDataImportUploadBucketPolicy05639444": {
      "Properties": {
        "Bucket": {
          "Ref": "RagEnginesDataImportUploadBucket061D697E",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportUploadBucket061D697E",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportUploadBucket061D697E",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "RagEnginesDataImportUploadHandlerDB43C77C": {
      "DependsOn": [
        "RagEnginesDataImportUploadHandlerServiceRoleDefaultPolicyEA26DE3E",
        "RagEnginesDataImportUploadHandlerServiceRole46EB8689",
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "Architectures": [
          "x86_64",
        ],
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "Data Import upload handler",
        "Environment": {
          "Variables": {
            "API_KEYS_SECRETS_ARN": {
              "Ref": "SharedApiKeysSecret9EA666ED",
            },
            "AWS_XRAY_SDK_ENABLED": "false",
            "CONFIG_PARAMETER_NAME": {
              "Ref": "SharedConfig358B4A20",
            },
            "DEFAULT_KENDRA_S3_DATA_SOURCE_BUCKET_NAME": {
              "Ref": "RagEnginesKendraRetrievalKendraDataBucket1627A447",
            },
            "DOCUMENTS_BY_COMPOUND_KEY_INDEX_NAME": "by_compound_key_idx",
            "DOCUMENTS_TABLE_NAME": {
              "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
            },
            "FILE_IMPORT_WORKFLOW_ARN": {
              "Ref": "RagEnginesDataImportFileImportWorkflowFileImportStateMachine398F0217",
            },
            "LOG_LEVEL": "INFO",
            "POWERTOOLS_DEV": "false",
            "POWERTOOLS_LOGGER_LOG_EVENT": "false",
            "POWERTOOLS_SERVICE_NAME": "chatbot",
            "POWERTOOLS_TRACE_DISABLED": "true",
            "PROCESSING_BUCKET_NAME": {
              "Ref": "RagEnginesDataImportProcessingBucketA7BE9701",
            },
            "SAGEMAKER_RAG_MODELS_ENDPOINT": {
              "Fn::GetAtt": [
                "RagEnginesSageMakerModelMultiAB24AEndpoint6DA7D681",
                "EndpointName",
              ],
            },
            "UPLOAD_BUCKET_NAME": {
              "Ref": "RagEnginesDataImportUploadBucket061D697E",
            },
            "WORKSPACES_BY_OBJECT_TYPE_INDEX_NAME": "by_object_type_idx",
            "WORKSPACES_TABLE_NAME": {
              "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
            },
          },
        },
        "Handler": "index.lambda_handler",
        "Layers": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":lambda:",
                {
                  "Ref": "AWS::Region",
                },
                ":017000801446:layer:AWSLambdaPowertoolsPythonV3-python311-x86_64:2",
              ],
            ],
          },
          {
            "Ref": "SharedCommonLayerFC89CBCE",
          },
        ],
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "MemorySize": 512,
        "Role": {
          "Fn::GetAtt": [
            "RagEnginesDataImportUploadHandlerServiceRole46EB8689",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
        "Timeout": 900,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "RagEnginesDataImportUploadHandlerSecurityGroupE50D6894",
                "GroupId",
              ],
            },
          ],
          "SubnetIds": [
            {
              "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
            },
            {
              "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
            },
            {
              "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
            },
          ],
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "RagEnginesDataImportUploadHandlerLogRetention21BCC790": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "RagEnginesDataImportUploadHandlerDB43C77C",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "RagEnginesDataImportUploadHandlerSecurityGroupE50D6894": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "GroupDescription": "Automatic security group for Lambda Function prefixGenAIChatBotStackRagEnginesDataImportUploadHandler94703DBD",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "RagEnginesDataImportUploadHandlerServiceRole46EB8689": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesDataImportUploadHandlerServiceRoleDefaultPolicyEA26DE3E": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportUploadBucket061D697E",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportUploadBucket061D697E",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportProcessingBucketA7BE9701",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportProcessingBucketA7BE9701",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SharedApiKeysSecret9EA666ED",
              },
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:us-east-1:111111111:parameter/",
                    {
                      "Ref": "SharedConfig358B4A20",
                    },
                  ],
                ],
              },
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesKendraRetrievalKendraDataBucket1627A447",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesKendraRetrievalKendraDataBucket1627A447",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "sqs:ReceiveMessage",
                "sqs:ChangeMessageVisibility",
                "sqs:GetQueueUrl",
                "sqs:DeleteMessage",
                "sqs:GetQueueAttributes",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RagEnginesDataImportIngestionQueue045D880F",
                  "Arn",
                ],
              },
            },
            {
              "Action": "kms:Decrypt",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedQueueKMSKey26598E83",
                  "Arn",
                ],
              },
            },
            {
              "Action": "states:StartExecution",
              "Effect": "Allow",
              "Resource": {
                "Ref": "RagEnginesDataImportFileImportWorkflowFileImportStateMachine398F0217",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesDataImportUploadHandlerServiceRoleDefaultPolicyEA26DE3E",
        "Roles": [
          {
            "Ref": "RagEnginesDataImportUploadHandlerServiceRole46EB8689",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesDataImportUploadHandlerSqsEventSourceprefixGenAIChatBotStackRagEnginesDataImportIngestionQueue19A34117731FCA53": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "EventSourceArn": {
          "Fn::GetAtt": [
            "RagEnginesDataImportIngestionQueue045D880F",
            "Arn",
          ],
        },
        "FunctionName": {
          "Ref": "RagEnginesDataImportUploadHandlerDB43C77C",
        },
      },
      "Type": "AWS::Lambda::EventSourceMapping",
    },
    "RagEnginesDataImportUploadLogsBucket7D4429F7": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-S1",
              "reason": "Logging bucket does not require it's own access logs.",
            },
          ],
        },
      },
      "Properties": {
        "AccessControl": "LogDeliveryWrite",
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256",
              },
            },
          ],
        },
        "OwnershipControls": {
          "Rules": [
            {
              "ObjectOwnership": "ObjectWriter",
            },
          ],
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "VersioningConfiguration": {
          "Status": "Enabled",
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesDataImportUploadLogsBucketPolicy11C555A1": {
      "Properties": {
        "Bucket": {
          "Ref": "RagEnginesDataImportUploadLogsBucket7D4429F7",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportUploadLogsBucket7D4429F7",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportUploadLogsBucket7D4429F7",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerContainerExecutionRole0B78E7F9": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerContainerExecutionRoleDefaultPolicy0236B6D1": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":logs:us-east-1:111111111:log-group:/aws/batch/job:*",
                  ],
                ],
              },
            },
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ecr:us-east-1:111111111:repository/cdk-hnb659fds-container-assets-111111111-us-east-1",
                  ],
                ],
              },
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerContainerExecutionRoleDefaultPolicy0236B6D1",
        "Roles": [
          {
            "Ref": "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerContainerExecutionRole0B78E7F9",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerFargateComputeEnvironmentC972B00C": {
      "Properties": {
        "ComputeResources": {
          "MaxvCpus": 256,
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerFargateComputeEnvironmentSecurityGroup1141A545",
                "GroupId",
              ],
            },
          ],
          "Subnets": [
            {
              "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
            },
            {
              "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
            },
            {
              "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
            },
          ],
          "Type": "FARGATE",
          "UpdateToLatestImageVersion": true,
        },
        "ReplaceComputeEnvironment": true,
        "State": "ENABLED",
        "Type": "managed",
        "UpdatePolicy": {
          "JobExecutionTimeoutMinutes": 30,
        },
      },
      "Type": "AWS::Batch::ComputeEnvironment",
    },
    "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerFargateComputeEnvironmentSecurityGroup1141A545": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/RagEngines/DataImport/WebCrawlerBatchJob/WebCrawlerFargateComputeEnvironment/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerJobDC22C303": {
      "Properties": {
        "ContainerProperties": {
          "Environment": [
            {
              "Name": "AWS_DEFAULT_REGION",
              "Value": "us-east-1",
            },
            {
              "Name": "CONFIG_PARAMETER_NAME",
              "Value": {
                "Ref": "SharedConfig358B4A20",
              },
            },
            {
              "Name": "API_KEYS_SECRETS_ARN",
              "Value": {
                "Ref": "SharedApiKeysSecret9EA666ED",
              },
            },
            {
              "Name": "AURORA_DB_USER",
              "Value": "aurora_db_iam_write",
            },
            {
              "Name": "AURORA_DB_HOST",
              "Value": {
                "Fn::GetAtt": [
                  "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                  "Endpoint.Address",
                ],
              },
            },
            {
              "Name": "AURORA_DB_PORT",
              "Value": {
                "Fn::GetAtt": [
                  "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                  "Endpoint.Port",
                ],
              },
            },
            {
              "Name": "PROCESSING_BUCKET_NAME",
              "Value": {
                "Ref": "RagEnginesDataImportProcessingBucketA7BE9701",
              },
            },
            {
              "Name": "WORKSPACES_TABLE_NAME",
              "Value": {
                "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
              },
            },
            {
              "Name": "WORKSPACES_BY_OBJECT_TYPE_INDEX_NAME",
              "Value": "by_object_type_idx",
            },
            {
              "Name": "DOCUMENTS_TABLE_NAME",
              "Value": {
                "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
              },
            },
            {
              "Name": "DOCUMENTS_BY_COMPOUND_KEY_INDEX_NAME",
              "Value": "by_compound_key_idx",
            },
            {
              "Name": "SAGEMAKER_RAG_MODELS_ENDPOINT",
              "Value": {
                "Fn::GetAtt": [
                  "RagEnginesSageMakerModelMultiAB24AEndpoint6DA7D681",
                  "EndpointName",
                ],
              },
            },
            {
              "Name": "OPEN_SEARCH_COLLECTION_ENDPOINT",
              "Value": {
                "Fn::GetAtt": [
                  "RagEnginesOpenSearchVectorOpenSearchCollectionCMK872E47D8",
                  "CollectionEndpoint",
                ],
              },
            },
          ],
          "ExecutionRoleArn": {
            "Fn::GetAtt": [
              "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerContainerExecutionRole0B78E7F9",
              "Arn",
            ],
          },
          "FargatePlatformConfiguration": {},
          "Image": [
            "Dummy",
          ],
          "JobRoleArn": {
            "Fn::GetAtt": [
              "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerJobRoleE84A3DDA",
              "Arn",
            ],
          },
          "NetworkConfiguration": {
            "AssignPublicIp": "DISABLED",
          },
          "ReadonlyRootFilesystem": false,
          "ResourceRequirements": [
            {
              "Type": "MEMORY",
              "Value": "4096",
            },
            {
              "Type": "VCPU",
              "Value": "2",
            },
          ],
          "RuntimePlatform": {},
        },
        "PlatformCapabilities": [
          "FARGATE",
        ],
        "RetryStrategy": {
          "Attempts": 3,
          "EvaluateOnExit": [
            {
              "Action": "EXIT",
              "OnReason": "CannotPullContainerError:*",
            },
            {
              "Action": "EXIT",
              "OnExitCode": "137",
            },
          ],
        },
        "Timeout": {},
        "Type": "container",
      },
      "Type": "AWS::Batch::JobDefinition",
    },
    "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerJobQueue9A451612": {
      "Properties": {
        "ComputeEnvironmentOrder": [
          {
            "ComputeEnvironment": {
              "Fn::GetAtt": [
                "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerFargateComputeEnvironmentC972B00C",
                "ComputeEnvironmentArn",
              ],
            },
            "Order": 1,
          },
        ],
        "Priority": 1,
        "State": "ENABLED",
      },
      "Type": "AWS::Batch::JobQueue",
    },
    "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerJobRoleDefaultPolicy12DFD49F": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportUploadBucket061D697E",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportUploadBucket061D697E",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportProcessingBucketA7BE9701",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportProcessingBucketA7BE9701",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "ssm:DescribeParameters",
                "ssm:GetParameters",
                "ssm:GetParameter",
                "ssm:GetParameterHistory",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":ssm:us-east-1:111111111:parameter/",
                    {
                      "Ref": "SharedConfig358B4A20",
                    },
                  ],
                ],
              },
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "SharedApiKeysSecret9EA666ED",
              },
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "rds-db:connect",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":rds-db:us-east-1:111111111:dbuser:",
                    {
                      "Fn::GetAtt": [
                        "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                        "DBClusterResourceId",
                      ],
                    },
                    "/aurora_db_iam_write",
                  ],
                ],
              },
            },
            {
              "Action": "aoss:APIAccessAll",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RagEnginesOpenSearchVectorOpenSearchCollectionCMK872E47D8",
                  "Arn",
                ],
              },
            },
            {
              "Action": "states:StartExecution",
              "Effect": "Allow",
              "Resource": {
                "Ref": "RagEnginesOpenSearchVectorCreateOpenSearchWorkspace2B2FCA5B",
              },
            },
            {
              "Action": "sagemaker:InvokeEndpoint",
              "Effect": "Allow",
              "Resource": {
                "Ref": "RagEnginesSageMakerModelMultiAB24AEndpoint6DA7D681",
              },
            },
            {
              "Action": [
                "bedrock:InvokeModel",
                "bedrock:InvokeModelWithResponseStream",
              ],
              "Effect": "Allow",
              "Resource": "arn:aws:bedrock:*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerJobRoleDefaultPolicy12DFD49F",
        "Roles": [
          {
            "Ref": "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerJobRoleE84A3DDA",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerJobRoleE84A3DDA": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "Allow user freedom of model usage in Bedrock.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "Access to all log groups required for CloudWatch log group creation.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "S3 write access required for upload and processing buckets.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesDataImportWebsiteCrawlingWorkflowWebsiteCrawling9B1CEC96": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "RagEnginesDataImportWebsiteCrawlingWorkflowWebsiteCrawlingRoleDefaultPolicyA5C332A2",
        "RagEnginesDataImportWebsiteCrawlingWorkflowWebsiteCrawlingRole749B2009",
      ],
      "Properties": {
        "DefinitionString": {
          "Fn::Join": [
            "",
            [
              "{"StartAt":"SetProcessing","States":{"SetProcessing":{"Next":"WebCrawlerJob","Type":"Task","ResultPath":null,"Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::dynamodb:updateItem","Parameters":{"Key":{"workspace_id":{"S.$":"$.workspace_id"},"document_id":{"S.$":"$.document_id"}},"TableName":"",
              {
                "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
              },
              "","ExpressionAttributeNames":{"#status":"status"},"ExpressionAttributeValues":{":statusValue":{"S":"processing"}},"UpdateExpression":"set #status=:statusValue"}},"WebCrawlerJob":{"Next":"SetProcessed","Type":"Task","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::batch:submitJob.sync","Parameters":{"JobDefinition":"",
              {
                "Ref": "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerJobDC22C303",
              },
              "","JobName.$":"States.Format('WebCrawler-{}-{}', $.workspace_id, $.document_id)","JobQueue":"",
              {
                "Fn::GetAtt": [
                  "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerJobQueue9A451612",
                  "JobQueueArn",
                ],
              },
              "","ContainerOverrides":{"Environment":[{"Name":"WORKSPACE_ID","Value.$":"$.workspace_id"},{"Name":"DOCUMENT_ID","Value.$":"$.document_id"},{"Name":"INPUT_BUCKET_NAME","Value.$":"$.bucket_name"},{"Name":"INPUT_OBJECT_KEY","Value.$":"$.object_key"}]}},"ResultPath":"$.job","Catch":[{"ErrorEquals":["States.ALL"],"ResultPath":"$.job","Next":"HandleError"}]},"SetProcessed":{"Next":"Success","Type":"Task","ResultPath":null,"Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::dynamodb:updateItem","Parameters":{"Key":{"workspace_id":{"S.$":"$.workspace_id"},"document_id":{"S.$":"$.document_id"}},"TableName":"",
              {
                "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
              },
              "","ExpressionAttributeNames":{"#status":"status"},"ExpressionAttributeValues":{":statusValue":{"S":"processed"}},"UpdateExpression":"set #status=:statusValue"}},"Success":{"Type":"Succeed"},"HandleError":{"Next":"Fail","Type":"Task","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::dynamodb:updateItem","Parameters":{"Key":{"workspace_id":{"S.$":"$.workspace_id"},"document_id":{"S.$":"$.document_id"}},"TableName":"",
              {
                "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
              },
              "","ExpressionAttributeNames":{"#status":"status"},"ExpressionAttributeValues":{":error":{"S":"error"}},"UpdateExpression":"set #status = :error"}},"Fail":{"Type":"Fail","Cause":"Crawler failed"}},"Comment":"Website Crawling Workflow"}",
            ],
          ],
        },
        "LoggingConfiguration": {
          "Destinations": [
            {
              "CloudWatchLogsLogGroup": {
                "LogGroupArn": {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportWebsiteCrawlingWorkflowWebsiteCrawlingSMLogGroup0C0F0231",
                    "Arn",
                  ],
                },
              },
            },
          ],
          "Level": "ALL",
        },
        "RoleArn": {
          "Fn::GetAtt": [
            "RagEnginesDataImportWebsiteCrawlingWorkflowWebsiteCrawlingRole749B2009",
            "Arn",
          ],
        },
        "TracingConfiguration": {
          "Enabled": true,
        },
      },
      "Type": "AWS::StepFunctions::StateMachine",
      "UpdateReplacePolicy": "Delete",
    },
    "RagEnginesDataImportWebsiteCrawlingWorkflowWebsiteCrawlingRole749B2009": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "states.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesDataImportWebsiteCrawlingWorkflowWebsiteCrawlingRoleDefaultPolicyA5C332A2": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "dynamodb:UpdateItem",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":dynamodb:us-east-1:111111111:table/",
                    {
                      "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                    },
                  ],
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogDelivery",
                "logs:GetLogDelivery",
                "logs:UpdateLogDelivery",
                "logs:DeleteLogDelivery",
                "logs:ListLogDeliveries",
                "logs:PutResourcePolicy",
                "logs:DescribeResourcePolicies",
                "logs:DescribeLogGroups",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
                "xray:GetSamplingRules",
                "xray:GetSamplingTargets",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "events:CreateRule",
                "events:PutRule",
                "events:PutTargets",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": "batch:SubmitJob",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerJobQueue9A451612",
                    "JobQueueArn",
                  ],
                },
                {
                  "Ref": "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerJobDC22C303",
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesDataImportWebsiteCrawlingWorkflowWebsiteCrawlingRoleDefaultPolicyA5C332A2",
        "Roles": [
          {
            "Ref": "RagEnginesDataImportWebsiteCrawlingWorkflowWebsiteCrawlingRole749B2009",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesDataImportWebsiteCrawlingWorkflowWebsiteCrawlingSMLogGroup0C0F0231": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "LogGroupName": "/aws/vendedlogs/states/WebsiteCrawling-c84284c45e3cc190f86fcddfefa098795bf6057ea6",
        "RetentionInDays": 731,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesKendraRetrievalCreateKendraWorkspace5D8DE7EF": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "RagEnginesKendraRetrievalCreateKendraWorkspaceRoleDefaultPolicy9D33E30B",
        "RagEnginesKendraRetrievalCreateKendraWorkspaceRole3E074B64",
      ],
      "Properties": {
        "DefinitionString": {
          "Fn::Join": [
            "",
            [
              "{"StartAt":"SetCreating","States":{"SetCreating":{"Next":"SetReady","Type":"Task","ResultPath":null,"Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::dynamodb:updateItem","Parameters":{"Key":{"workspace_id":{"S.$":"$.workspace_id"},"object_type":{"S":"workspace"}},"TableName":"",
              {
                "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
              },
              "","ExpressionAttributeNames":{"#status":"status"},"ExpressionAttributeValues":{":statusValue":{"S":"creating"}},"UpdateExpression":"set #status=:statusValue"}},"SetReady":{"Next":"Success","Type":"Task","ResultPath":null,"Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::dynamodb:updateItem","Parameters":{"Key":{"workspace_id":{"S.$":"$.workspace_id"},"object_type":{"S":"workspace"}},"TableName":"",
              {
                "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
              },
              "","ExpressionAttributeNames":{"#status":"status"},"ExpressionAttributeValues":{":statusValue":{"S":"ready"}},"UpdateExpression":"set #status=:statusValue"}},"Success":{"Type":"Succeed"}},"TimeoutSeconds":300,"Comment":"Create Kendra Workspace Workflow"}",
            ],
          ],
        },
        "LoggingConfiguration": {
          "Destinations": [
            {
              "CloudWatchLogsLogGroup": {
                "LogGroupArn": {
                  "Fn::GetAtt": [
                    "RagEnginesKendraRetrievalCreateKendraWorkspaceCreateKendraWorkspaceSMLogGroupC9D4A635",
                    "Arn",
                  ],
                },
              },
            },
          ],
          "Level": "ALL",
        },
        "RoleArn": {
          "Fn::GetAtt": [
            "RagEnginesKendraRetrievalCreateKendraWorkspaceRole3E074B64",
            "Arn",
          ],
        },
        "TracingConfiguration": {
          "Enabled": true,
        },
      },
      "Type": "AWS::StepFunctions::StateMachine",
      "UpdateReplacePolicy": "Delete",
    },
    "RagEnginesKendraRetrievalCreateKendraWorkspaceCreateKendraWorkspaceSMLogGroupC9D4A635": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "LogGroupName": "/aws/vendedlogs/states/CreateKendraWorkspace-c82d1f0bddb3f281b5b0d41fbdc8dd5ce18a954f60",
        "RetentionInDays": 731,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesKendraRetrievalCreateKendraWorkspaceRole3E074B64": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "states.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesKendraRetrievalCreateKendraWorkspaceRoleDefaultPolicy9D33E30B": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "dynamodb:UpdateItem",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":dynamodb:us-east-1:111111111:table/",
                    {
                      "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                    },
                  ],
                ],
              },
            },
            {
              "Action": [
                "logs:CreateLogDelivery",
                "logs:GetLogDelivery",
                "logs:UpdateLogDelivery",
                "logs:DeleteLogDelivery",
                "logs:ListLogDeliveries",
                "logs:PutResourcePolicy",
                "logs:DescribeResourcePolicies",
                "logs:DescribeLogGroups",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
                "xray:GetSamplingRules",
                "xray:GetSamplingTargets",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesKendraRetrievalCreateKendraWorkspaceRoleDefaultPolicy9D33E30B",
        "Roles": [
          {
            "Ref": "RagEnginesKendraRetrievalCreateKendraWorkspaceRole3E074B64",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesKendraRetrievalIndex922B65FC": {
      "Properties": {
        "DocumentMetadataConfigurations": [
          {
            "Name": "workspace_id",
            "Search": {
              "Displayable": true,
              "Facetable": true,
              "Searchable": true,
            },
            "Type": "STRING_VALUE",
          },
          {
            "Name": "document_type",
            "Search": {
              "Displayable": true,
              "Facetable": true,
              "Searchable": true,
            },
            "Type": "STRING_VALUE",
          },
        ],
        "Edition": "ENTERPRISE_EDITION",
        "Name": "prefix-cmk-genaichatbot-work",
        "RoleArn": {
          "Fn::GetAtt": [
            "RagEnginesKendraRetrievalKendraRole162540DA",
            "Arn",
          ],
        },
        "ServerSideEncryptionConfiguration": {
          "KmsKeyId": {
            "Ref": "SharedKMSKey7BCBB616",
          },
        },
      },
      "Type": "AWS::Kendra::Index",
    },
    "RagEnginesKendraRetrievalKendraDataBucket1627A447": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "KMSMasterKeyID": {
                  "Fn::GetAtt": [
                    "SharedKMSKey7BCBB616",
                    "Arn",
                  ],
                },
                "SSEAlgorithm": "aws:kms",
              },
            },
          ],
        },
        "LoggingConfiguration": {
          "DestinationBucketName": {
            "Ref": "RagEnginesKendraRetrievalLogsBucket7EEBA031",
          },
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "VersioningConfiguration": {
          "Status": "Enabled",
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesKendraRetrievalKendraDataBucketPolicy712A21F8": {
      "Properties": {
        "Bucket": {
          "Ref": "RagEnginesKendraRetrievalKendraDataBucket1627A447",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesKendraRetrievalKendraDataBucket1627A447",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesKendraRetrievalKendraDataBucket1627A447",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "RagEnginesKendraRetrievalKendraRole162540DA": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "kendra.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesKendraRetrievalKendraRoleDefaultPolicy7F00A915": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "Access to all log groups required for CloudWatch log group creation.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "logs:*",
                "cloudwatch:*",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesKendraRetrievalKendraDataBucket1627A447",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesKendraRetrievalKendraDataBucket1627A447",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": "kendra:BatchDeleteDocument",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesKendraRetrievalIndex922B65FC",
                    "Arn",
                  ],
                },
                {
                  "Fn::GetAtt": [
                    "RagEnginesKendraRetrievalKendraS3DataSourceCMKB964C6CC",
                    "Arn",
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesKendraRetrievalKendraRoleDefaultPolicy7F00A915",
        "Roles": [
          {
            "Ref": "RagEnginesKendraRetrievalKendraRole162540DA",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesKendraRetrievalKendraS3DataSourceCMKB964C6CC": {
      "Properties": {
        "DataSourceConfiguration": {
          "S3Configuration": {
            "BucketName": {
              "Ref": "RagEnginesKendraRetrievalKendraDataBucket1627A447",
            },
            "DocumentsMetadataConfiguration": {
              "S3Prefix": "metadata",
            },
            "InclusionPrefixes": [
              "documents",
            ],
          },
        },
        "Description": "S3 Data Source for Kendra Index",
        "IndexId": {
          "Ref": "RagEnginesKendraRetrievalIndex922B65FC",
        },
        "Name": "KendraS3DataSource",
        "RoleArn": {
          "Fn::GetAtt": [
            "RagEnginesKendraRetrievalKendraRole162540DA",
            "Arn",
          ],
        },
        "Type": "S3",
      },
      "Type": "AWS::Kendra::DataSource",
    },
    "RagEnginesKendraRetrievalLogsBucket7EEBA031": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "AccessControl": "LogDeliveryWrite",
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256",
              },
            },
          ],
        },
        "OwnershipControls": {
          "Rules": [
            {
              "ObjectOwnership": "ObjectWriter",
            },
          ],
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "VersioningConfiguration": {
          "Status": "Enabled",
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesKendraRetrievalLogsBucketPolicy0F92CE93": {
      "Properties": {
        "Bucket": {
          "Ref": "RagEnginesKendraRetrievalLogsBucket7EEBA031",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesKendraRetrievalLogsBucket7EEBA031",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesKendraRetrievalLogsBucket7EEBA031",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "RagEnginesOpenSearchVectorAccessPolicycreateworkflowCF675858": {
      "Properties": {
        "Name": "prefix-create-workflow-access-po",
        "Policy": {
          "Fn::Join": [
            "",
            [
              "[{"Rules":[{"ResourceType":"index","Resource":["index/prefix-cmk-genaichatbot-work/*"],"Permission":["aoss:CreateIndex","aoss:DeleteIndex","aoss:UpdateIndex","aoss:DescribeIndex"]}],"Principal":["",
              {
                "Fn::GetAtt": [
                  "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceFunctionServiceRole61F3024C",
                  "Arn",
                ],
              },
              ""]}]",
            ],
          ],
        },
        "Type": "data",
      },
      "Type": "AWS::OpenSearchServerless::AccessPolicy",
    },
    "RagEnginesOpenSearchVectorAccessPolicydeletedocumentE38B92A9": {
      "Properties": {
        "Name": "prefix-delete-document-access-po",
        "Policy": {
          "Fn::Join": [
            "",
            [
              "[{"Rules":[{"ResourceType":"index","Resource":["index/prefix-cmk-genaichatbot-work/*"],"Permission":["aoss:DescribeIndex","aoss:UpdateIndex","aoss:ReadDocument","aoss:WriteDocument"]}],"Principal":["",
              {
                "Fn::GetAtt": [
                  "RagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionServiceRole3BBCBEE9",
                  "Arn",
                ],
              },
              ""]}]",
            ],
          ],
        },
        "Type": "data",
      },
      "Type": "AWS::OpenSearchServerless::AccessPolicy",
    },
    "RagEnginesOpenSearchVectorAccessPolicydeleteworkspaceB7671EBB": {
      "Properties": {
        "Name": "prefix-delete-workspace-access-p",
        "Policy": {
          "Fn::Join": [
            "",
            [
              "[{"Rules":[{"ResourceType":"index","Resource":["index/prefix-cmk-genaichatbot-work/*"],"Permission":["aoss:DeleteIndex","aoss:DescribeIndex","aoss:ReadDocument","aoss:WriteDocument"]}],"Principal":["",
              {
                "Fn::GetAtt": [
                  "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunctionServiceRoleD99F8BAF",
                  "Arn",
                ],
              },
              ""]}]",
            ],
          ],
        },
        "Type": "data",
      },
      "Type": "AWS::OpenSearchServerless::AccessPolicy",
    },
    "RagEnginesOpenSearchVectorAccessPolicyfileimportjob36E505CB": {
      "Properties": {
        "Name": "prefix-file-import-job-access-po",
        "Policy": {
          "Fn::Join": [
            "",
            [
              "[{"Rules":[{"ResourceType":"index","Resource":["index/prefix-cmk-genaichatbot-work/*"],"Permission":["aoss:DescribeIndex","aoss:ReadDocument","aoss:WriteDocument"]}],"Principal":["",
              {
                "Fn::GetAtt": [
                  "RagEnginesDataImportFileImportBatchJobFileImportJobRoleCA3E6A38",
                  "Arn",
                ],
              },
              ""]}]",
            ],
          ],
        },
        "Type": "data",
      },
      "Type": "AWS::OpenSearchServerless::AccessPolicy",
    },
    "RagEnginesOpenSearchVectorAccessPolicygraphqlapi1D6DC8C2": {
      "Properties": {
        "Name": "prefix-graphql-api-access-policy",
        "Policy": {
          "Fn::Join": [
            "",
            [
              "[{"Rules":[{"ResourceType":"index","Resource":["index/prefix-cmk-genaichatbot-work/*"],"Permission":["aoss:DescribeIndex","aoss:ReadDocument","aoss:WriteDocument"]}],"Principal":["",
              {
                "Fn::GetAtt": [
                  "ChatBotApiRestApiGraphQLApiHandlerServiceRole8BB05949",
                  "Arn",
                ],
              },
              ""]}]",
            ],
          ],
        },
        "Type": "data",
      },
      "Type": "AWS::OpenSearchServerless::AccessPolicy",
    },
    "RagEnginesOpenSearchVectorAccessPolicyrequesthandlerlangchain950B2DA2": {
      "Properties": {
        "Name": "prefix-request-handler-langchain",
        "Policy": {
          "Fn::Join": [
            "",
            [
              "[{"Rules":[{"ResourceType":"index","Resource":["index/prefix-cmk-genaichatbot-work/*"],"Permission":["aoss:ReadDocument","aoss:WriteDocument"]}],"Principal":["",
              {
                "Fn::GetAtt": [
                  "LangchainInterfaceRequestHandlerServiceRole2FA1A914",
                  "Arn",
                ],
              },
              ""]}]",
            ],
          ],
        },
        "Type": "data",
      },
      "Type": "AWS::OpenSearchServerless::AccessPolicy",
    },
    "RagEnginesOpenSearchVectorAccessPolicywebcrawlerjobBB1BFE70": {
      "Properties": {
        "Name": "prefix-web-crawler-job-access-po",
        "Policy": {
          "Fn::Join": [
            "",
            [
              "[{"Rules":[{"ResourceType":"index","Resource":["index/prefix-cmk-genaichatbot-work/*"],"Permission":["aoss:DescribeIndex","aoss:ReadDocument","aoss:WriteDocument"]}],"Principal":["",
              {
                "Fn::GetAtt": [
                  "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerJobRoleE84A3DDA",
                  "Arn",
                ],
              },
              ""]}]",
            ],
          ],
        },
        "Type": "data",
      },
      "Type": "AWS::OpenSearchServerless::AccessPolicy",
    },
    "RagEnginesOpenSearchVectorCreateOpenSearchWorkspace2B2FCA5B": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceRoleDefaultPolicyDF1E8530",
        "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceRole11F40159",
      ],
      "Properties": {
        "DefinitionString": {
          "Fn::Join": [
            "",
            [
              "{"StartAt":"SetCreating","States":{"SetCreating":{"Next":"Create","Type":"Task","ResultPath":null,"Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::dynamodb:updateItem","Parameters":{"Key":{"workspace_id":{"S.$":"$.workspace_id"},"object_type":{"S":"workspace"}},"TableName":"",
              {
                "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
              },
              "","ExpressionAttributeNames":{"#status":"status"},"ExpressionAttributeValues":{":statusValue":{"S":"creating"}},"UpdateExpression":"set #status=:statusValue"}},"Create":{"Next":"SetReady","Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Catch":[{"ErrorEquals":["States.ALL"],"ResultPath":"$.createResult","Next":"HandleError"}],"Type":"Task","ResultPath":"$.createResult","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::lambda:invoke","Parameters":{"FunctionName":"",
              {
                "Fn::GetAtt": [
                  "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceFunction8E852192",
                  "Arn",
                ],
              },
              "","Payload.$":"$"}},"SetReady":{"Next":"Success","Type":"Task","ResultPath":null,"Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::dynamodb:updateItem","Parameters":{"Key":{"workspace_id":{"S.$":"$.workspace_id"},"object_type":{"S":"workspace"}},"TableName":"",
              {
                "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
              },
              "","ExpressionAttributeNames":{"#status":"status"},"ExpressionAttributeValues":{":statusValue":{"S":"ready"}},"UpdateExpression":"set #status=:statusValue"}},"Success":{"Type":"Succeed"},"HandleError":{"Next":"Fail","Type":"Task","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::dynamodb:updateItem","Parameters":{"Key":{"workspace_id":{"S.$":"$.workspace_id"},"object_type":{"S":"workspace"}},"TableName":"",
              {
                "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
              },
              "","ExpressionAttributeNames":{"#status":"status"},"ExpressionAttributeValues":{":error":{"S":"error"}},"UpdateExpression":"set #status = :error"}},"Fail":{"Type":"Fail","Cause":"Workspace creation failed"}},"TimeoutSeconds":300,"Comment":"Create OpenSearch Workspace Workflow"}",
            ],
          ],
        },
        "LoggingConfiguration": {
          "Destinations": [
            {
              "CloudWatchLogsLogGroup": {
                "LogGroupArn": {
                  "Fn::GetAtt": [
                    "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceSMLogGroupB97A0992",
                    "Arn",
                  ],
                },
              },
            },
          ],
          "Level": "ALL",
        },
        "RoleArn": {
          "Fn::GetAtt": [
            "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceRole11F40159",
            "Arn",
          ],
        },
        "TracingConfiguration": {
          "Enabled": true,
        },
      },
      "Type": "AWS::StepFunctions::StateMachine",
      "UpdateReplacePolicy": "Delete",
    },
    "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceFunction8E852192": {
      "DependsOn": [
        "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceFunctionServiceRoleDefaultPolicy8B8E4375",
        "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceFunctionServiceRole61F3024C",
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "Architectures": [
          "x86_64",
        ],
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "Creates the Open Search workspace",
        "Environment": {
          "Variables": {
            "AWS_XRAY_SDK_ENABLED": "false",
            "LOG_LEVEL": "INFO",
            "OPEN_SEARCH_COLLECTION_ENDPOINT": {
              "Fn::GetAtt": [
                "RagEnginesOpenSearchVectorOpenSearchCollectionCMK872E47D8",
                "CollectionEndpoint",
              ],
            },
            "OPEN_SEARCH_COLLECTION_ENDPOINT_PORT": "443",
            "OPEN_SEARCH_COLLECTION_NAME": "prefix-cmk-genaichatbot-work",
            "POWERTOOLS_DEV": "false",
            "POWERTOOLS_LOGGER_LOG_EVENT": "false",
            "POWERTOOLS_SERVICE_NAME": "chatbot",
            "POWERTOOLS_TRACE_DISABLED": "true",
            "WORKSPACES_BY_OBJECT_TYPE_INDEX_NAME": "by_object_type_idx",
            "WORKSPACES_TABLE_NAME": {
              "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
            },
          },
        },
        "Handler": "index.lambda_handler",
        "Layers": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":lambda:",
                {
                  "Ref": "AWS::Region",
                },
                ":017000801446:layer:AWSLambdaPowertoolsPythonV3-python311-x86_64:2",
              ],
            ],
          },
          {
            "Ref": "SharedCommonLayerFC89CBCE",
          },
        ],
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "Role": {
          "Fn::GetAtt": [
            "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceFunctionServiceRole61F3024C",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
        "Timeout": 300,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceFunctionSecurityGroupB03EFEB8",
                "GroupId",
              ],
            },
          ],
          "SubnetIds": [
            {
              "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
            },
            {
              "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
            },
            {
              "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
            },
          ],
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceFunctionLogRetentionAF038FA1": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceFunction8E852192",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceFunctionSecurityGroupB03EFEB8": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "GroupDescription": "Automatic security group for Lambda Function prefixGenAIChatBotStackRagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceFunctionEB40CF20",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceFunctionServiceRole61F3024C": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceFunctionServiceRoleDefaultPolicy8B8E4375": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "aoss:APIAccessAll",
                "aoss:DescribeIndex",
                "aoss:CreateIndex",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RagEnginesOpenSearchVectorOpenSearchCollectionCMK872E47D8",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceFunctionServiceRoleDefaultPolicy8B8E4375",
        "Roles": [
          {
            "Ref": "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceFunctionServiceRole61F3024C",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceSMLogGroupB97A0992": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "LogGroupName": "/aws/vendedlogs/states/CreateOpenSearchWorkspace-c80c40855b0079b324a7fd75085c6a2e70b9e6eeae",
        "RetentionInDays": 731,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceRole11F40159": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "states.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceRoleDefaultPolicyDF1E8530": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "dynamodb:UpdateItem",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":dynamodb:us-east-1:111111111:table/",
                    {
                      "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                    },
                  ],
                ],
              },
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceFunction8E852192",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceCreateOpenSearchWorkspaceFunction8E852192",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "logs:CreateLogDelivery",
                "logs:GetLogDelivery",
                "logs:UpdateLogDelivery",
                "logs:DeleteLogDelivery",
                "logs:ListLogDeliveries",
                "logs:PutResourcePolicy",
                "logs:DescribeResourcePolicies",
                "logs:DescribeLogGroups",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
                "xray:GetSamplingRules",
                "xray:GetSamplingTargets",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceRoleDefaultPolicyDF1E8530",
        "Roles": [
          {
            "Ref": "RagEnginesOpenSearchVectorCreateOpenSearchWorkspaceRole11F40159",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesOpenSearchVectorEncryptionSecurityPolicy14A4564B": {
      "DependsOn": [
        "RagEnginesOpenSearchVectorNetworkSecurityPolicy0DA2DE7C",
      ],
      "Properties": {
        "Name": "prefix-genaichatbot-encryption-p",
        "Policy": {
          "Fn::Join": [
            "",
            [
              "{"Rules":[{"ResourceType":"collection","Resource":["collection/prefix-cmk-genaichatbot-work"]}],"AWSOwnedKey":false,"KmsARN":"",
              {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
              ""}",
            ],
          ],
        },
        "Type": "encryption",
      },
      "Type": "AWS::OpenSearchServerless::SecurityPolicy",
    },
    "RagEnginesOpenSearchVectorNetworkSecurityPolicy0DA2DE7C": {
      "DependsOn": [
        "RagEnginesOpenSearchVectorVpcEndpoint0433102C",
      ],
      "Properties": {
        "Name": "prefix-genaichatbot-network-",
        "Policy": {
          "Fn::Join": [
            "",
            [
              "[{"Rules":[{"ResourceType":"collection","Resource":["collection/prefix-cmk-genaichatbot-work"]}],"AllowFromPublic":false,"SourceVPCEs":["",
              {
                "Fn::GetAtt": [
                  "RagEnginesOpenSearchVectorVpcEndpoint0433102C",
                  "Id",
                ],
              },
              ""]}]",
            ],
          ],
        },
        "Type": "network",
      },
      "Type": "AWS::OpenSearchServerless::SecurityPolicy",
    },
    "RagEnginesOpenSearchVectorOpenSearchCollectionCMK872E47D8": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "DependsOn": [
        "RagEnginesOpenSearchVectorEncryptionSecurityPolicy14A4564B",
        "RagEnginesOpenSearchVectorNetworkSecurityPolicy0DA2DE7C",
      ],
      "Properties": {
        "Name": "prefix-cmk-genaichatbot-work",
        "Type": "VECTORSEARCH",
      },
      "Type": "AWS::OpenSearchServerless::Collection",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesOpenSearchVectorSecurityGroup0D835056": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/RagEngines/OpenSearchVector/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "RagEnginesOpenSearchVectorVpcEndpoint0433102C": {
      "Properties": {
        "Name": "prefix-genaichatbot-vpce",
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "RagEnginesOpenSearchVectorSecurityGroup0D835056",
              "GroupId",
            ],
          },
        ],
        "SubnetIds": [
          {
            "Ref": "SharedVPCisolatedSubnet1SubnetAE743C40",
          },
          {
            "Ref": "SharedVPCisolatedSubnet2SubnetBC723A26",
          },
          {
            "Ref": "SharedVPCisolatedSubnet3Subnet93F04F54",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::OpenSearchServerless::VpcEndpoint",
    },
    "RagEnginesRagDynamoDBTablesDocumentsF6F2B272": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "workspace_id",
            "AttributeType": "S",
          },
          {
            "AttributeName": "document_id",
            "AttributeType": "S",
          },
          {
            "AttributeName": "compound_sort_key",
            "AttributeType": "S",
          },
          {
            "AttributeName": "status",
            "AttributeType": "S",
          },
          {
            "AttributeName": "document_type",
            "AttributeType": "S",
          },
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "by_compound_key_idx",
            "KeySchema": [
              {
                "AttributeName": "workspace_id",
                "KeyType": "HASH",
              },
              {
                "AttributeName": "compound_sort_key",
                "KeyType": "RANGE",
              },
            ],
            "Projection": {
              "ProjectionType": "ALL",
            },
          },
          {
            "IndexName": "by_status_idx",
            "KeySchema": [
              {
                "AttributeName": "status",
                "KeyType": "HASH",
              },
              {
                "AttributeName": "document_type",
                "KeyType": "RANGE",
              },
            ],
            "Projection": {
              "ProjectionType": "ALL",
            },
          },
        ],
        "KeySchema": [
          {
            "AttributeName": "workspace_id",
            "KeyType": "HASH",
          },
          {
            "AttributeName": "document_id",
            "KeyType": "RANGE",
          },
        ],
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true,
        },
        "SSESpecification": {
          "KMSMasterKeyId": {
            "Fn::GetAtt": [
              "SharedKMSKey7BCBB616",
              "Arn",
            ],
          },
          "SSEEnabled": true,
          "SSEType": "KMS",
        },
      },
      "Type": "AWS::DynamoDB::Table",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "workspace_id",
            "AttributeType": "S",
          },
          {
            "AttributeName": "object_type",
            "AttributeType": "S",
          },
          {
            "AttributeName": "created_at",
            "AttributeType": "S",
          },
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "by_object_type_idx",
            "KeySchema": [
              {
                "AttributeName": "object_type",
                "KeyType": "HASH",
              },
              {
                "AttributeName": "created_at",
                "KeyType": "RANGE",
              },
            ],
            "Projection": {
              "ProjectionType": "ALL",
            },
          },
        ],
        "KeySchema": [
          {
            "AttributeName": "workspace_id",
            "KeyType": "HASH",
          },
          {
            "AttributeName": "object_type",
            "KeyType": "RANGE",
          },
        ],
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true,
        },
        "SSESpecification": {
          "KMSMasterKeyId": {
            "Fn::GetAtt": [
              "SharedKMSKey7BCBB616",
              "Arn",
            ],
          },
          "SSEEnabled": true,
          "SSEType": "KMS",
        },
      },
      "Type": "AWS::DynamoDB::Table",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesSageMakerModelMultiAB24ABucketF09A69F9": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "KMSMasterKeyID": {
                  "Fn::GetAtt": [
                    "SharedKMSKey7BCBB616",
                    "Arn",
                  ],
                },
                "SSEAlgorithm": "aws:kms",
              },
            },
          ],
        },
        "LoggingConfiguration": {
          "DestinationBucketName": {
            "Ref": "RagEnginesSageMakerModelMultiAB24ALogsBucket1624BE94",
          },
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "Tags": [
          {
            "Key": "aws-cdk:cr-owned:build-script:bb3552fb",
            "Value": "true",
          },
          {
            "Key": "aws-cdk:cr-owned:model-code:ab0d170c",
            "Value": "true",
          },
        ],
        "VersioningConfiguration": {
          "Status": "Enabled",
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesSageMakerModelMultiAB24ABucketPolicyC0BB6B78": {
      "Properties": {
        "Bucket": {
          "Ref": "RagEnginesSageMakerModelMultiAB24ABucketF09A69F9",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesSageMakerModelMultiAB24ABucketF09A69F9",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesSageMakerModelMultiAB24ABucketF09A69F9",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "RagEnginesSageMakerModelMultiAB24ABuildE30DA23B": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "ProjectName": {
          "Ref": "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
        },
        "ServiceToken": {
          "Fn::GetAtt": [
            "RagEnginesSageMakerModelMultiAB24AProviderframeworkonEventC75C76C6",
            "Arn",
          ],
        },
      },
      "Type": "AWS::CloudFormation::CustomResource",
      "UpdateReplacePolicy": "Delete",
    },
    "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24AModelCodeAwsCliLayer876643AD",
        "RagEnginesSageMakerModelMultiAB24AModelCodeCustomResourceA0D3E041",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-CB4",
              "reason": "Build is only ran as part of stack creation and does not contain external data.",
            },
            {
              "id": "AwsSolutions-CB3",
              "reason": "Privileged mode is required as build project is used to build Docker images.",
            },
          ],
        },
      },
      "Properties": {
        "Artifacts": {
          "Type": "NO_ARTIFACTS",
        },
        "Cache": {
          "Type": "NO_CACHE",
        },
        "EncryptionKey": "alias/aws/s3",
        "Environment": {
          "ComputeType": "BUILD_GENERAL1_LARGE",
          "EnvironmentVariables": [
            {
              "Name": "MODEL_ID",
              "Type": "PLAINTEXT",
              "Value": "intfloat/multilingual-e5-large,sentence-transformers/all-MiniLM-L6-v2,cross-encoder/ms-marco-MiniLM-L-12-v2",
            },
            {
              "Name": "BUILD_BUCKET",
              "Type": "PLAINTEXT",
              "Value": {
                "Ref": "RagEnginesSageMakerModelMultiAB24ABucketF09A69F9",
              },
            },
            {
              "Name": "HF_HUB_ENABLE_HF_TRANSFER",
              "Type": "PLAINTEXT",
              "Value": "1",
            },
            {
              "Name": "HF_HUB_DISABLE_PROGRESS_BARS",
              "Type": "PLAINTEXT",
              "Value": "1",
            },
            {
              "Name": "HF_HUB_DISABLE_TELEMETRY",
              "Type": "PLAINTEXT",
              "Value": "1",
            },
          ],
          "Image": "aws/codebuild/standard:7.0",
          "ImagePullCredentialsType": "CODEBUILD",
          "PrivilegedMode": true,
          "Type": "LINUX_CONTAINER",
        },
        "ServiceRole": {
          "Fn::GetAtt": [
            "RagEnginesSageMakerModelMultiAB24ACodeBuildRoleD1F3AB46",
            "Arn",
          ],
        },
        "Source": {
          "BuildSpec": "{
  "version": "0.2",
  "phases": {
    "install": {
      "commands": [
        "echo \\"Updating system packages...\\"",
        "apt-get update",
        "echo \\"Installing tar, pigz, awscli, virtualenv, python3-pip, and python3-dev...\\"",
        "apt-get install -y tar pigz awscli virtualenv python3-pip python3-dev",
        "echo \\"Updating pip...\\"",
        "pip3 install --upgrade pip"
      ]
    },
    "pre_build": {
      "commands": [
        "echo \\"Downloading build code from S3...\\"",
        "aws s3 cp s3://$BUILD_BUCKET/build-script ./build --recursive",
        "echo \\"Downloading model from S3...\\"",
        "aws s3 cp s3://$BUILD_BUCKET/model-code ./model --recursive",
        "ls -al",
        "ls -al ./build",
        "ls -al ./model",
        "COMMIT_HASH=$(echo $CODEBUILD_RESOLVED_SOURCE_VERSION | cut -c 1-7)",
        "IMAGE_TAG=\${COMMIT_HASH:=latest}"
      ]
    },
    "build": {
      "commands": [
        "echo \\"Installing Python requirements...\\"",
        "pip3 install -r build/requirements.txt --upgrade",
        "echo \\"Running script.py...\\"",
        "python3 build/script.py"
      ]
    }
  }
}",
          "Type": "NO_SOURCE",
        },
      },
      "Type": "AWS::CodeBuild::Project",
    },
    "RagEnginesSageMakerModelMultiAB24ACodeBuildRoleD1F3AB46": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "Access to all log groups required for CloudWatch log group creation.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "codebuild.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": "*",
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CodeBuildPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesSageMakerModelMultiAB24ACodeBuildRoleDefaultPolicy95BCC278": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SF1",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-SF2",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":logs:us-east-1:111111111:log-group:/aws/codebuild/",
                      {
                        "Ref": "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
                      },
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":logs:us-east-1:111111111:log-group:/aws/codebuild/",
                      {
                        "Ref": "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "codebuild:CreateReportGroup",
                "codebuild:CreateReport",
                "codebuild:UpdateReport",
                "codebuild:BatchPutTestCases",
                "codebuild:BatchPutCodeCoverages",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":codebuild:us-east-1:111111111:report-group/",
                    {
                      "Ref": "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
                    },
                    "-*",
                  ],
                ],
              },
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesSageMakerModelMultiAB24ABucketF09A69F9",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesSageMakerModelMultiAB24ABucketF09A69F9",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesSageMakerModelMultiAB24ACodeBuildRoleDefaultPolicy95BCC278",
        "Roles": [
          {
            "Ref": "RagEnginesSageMakerModelMultiAB24ACodeBuildRoleD1F3AB46",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesSageMakerModelMultiAB24AEndpoint6DA7D681": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24AEndpointConfigB7DA0C5A",
      ],
      "Properties": {
        "EndpointConfigName": {
          "Fn::GetAtt": [
            "RagEnginesSageMakerModelMultiAB24AEndpointConfigB7DA0C5A",
            "EndpointConfigName",
          ],
        },
      },
      "Type": "AWS::SageMaker::Endpoint",
    },
    "RagEnginesSageMakerModelMultiAB24AEndpointConfigB7DA0C5A": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24AModel16A4AAEF",
      ],
      "Properties": {
        "ProductionVariants": [
          {
            "ContainerStartupHealthCheckTimeoutInSeconds": 900,
            "InitialInstanceCount": 1,
            "InitialVariantWeight": 1,
            "InstanceType": "ml.g4dn.xlarge",
            "ModelName": {
              "Fn::GetAtt": [
                "RagEnginesSageMakerModelMultiAB24AModel16A4AAEF",
                "ModelName",
              ],
            },
            "VariantName": "AllTraffic",
          },
        ],
      },
      "Type": "AWS::SageMaker::EndpointConfig",
    },
    "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerDF048AE3": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerServiceRoleDefaultPolicyC38586FA",
        "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerServiceRole01E1EAD7",
      ],
      "Properties": {
        "Architectures": [
          "arm64",
        ],
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "Checks the completion of an HuggingFace build request",
        "Handler": "index.is_complete",
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "Role": {
          "Fn::GetAtt": [
            "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerServiceRole01E1EAD7",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
      },
      "Type": "AWS::Lambda::Function",
    },
    "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerLogRetention65A63A01": {
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerDF048AE3",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerServiceRole01E1EAD7": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SF1",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-SF2",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerServiceRoleDefaultPolicyC38586FA": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "codebuild:BatchGetBuilds",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerServiceRoleDefaultPolicyC38586FA",
        "Roles": [
          {
            "Ref": "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerServiceRole01E1EAD7",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesSageMakerModelMultiAB24ALogsBucket1624BE94": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-S1",
              "reason": "Logging bucket does not require it's own access logs.",
            },
          ],
        },
      },
      "Properties": {
        "AccessControl": "LogDeliveryWrite",
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256",
              },
            },
          ],
        },
        "OwnershipControls": {
          "Rules": [
            {
              "ObjectOwnership": "ObjectWriter",
            },
          ],
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "VersioningConfiguration": {
          "Status": "Enabled",
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesSageMakerModelMultiAB24ALogsBucketPolicy6F361623": {
      "Properties": {
        "Bucket": {
          "Ref": "RagEnginesSageMakerModelMultiAB24ALogsBucket1624BE94",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesSageMakerModelMultiAB24ALogsBucket1624BE94",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesSageMakerModelMultiAB24ALogsBucket1624BE94",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "RagEnginesSageMakerModelMultiAB24AModel16A4AAEF": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24ABuildE30DA23B",
      ],
      "Properties": {
        "ExecutionRoleArn": {
          "Fn::GetAtt": [
            "RagEnginesSageMakerModelMultiAB24ASageMakerExecutionRole6740DE48",
            "Arn",
          ],
        },
        "PrimaryContainer": {
          "Environment": {
            "SAGEMAKER_CONTAINER_LOG_LEVEL": "20",
            "SAGEMAKER_REGION": {
              "Ref": "AWS::Region",
            },
          },
          "Image": {
            "Fn::Join": [
              "",
              [
                {
                  "Fn::FindInMap": [
                    "RagEnginesSageMakerModelImageRepositoryCfnMappingF3891114",
                    {
                      "Ref": "AWS::Region",
                    },
                    "account",
                  ],
                },
                ".dkr.ecr.",
                {
                  "Ref": "AWS::Region",
                },
                ".amazonaws.com/huggingface-pytorch-inference:2.0.0-transformers4.28.1-gpu-py310-cu118-ubuntu20.04",
              ],
            ],
          },
          "Mode": "SingleModel",
          "ModelDataUrl": {
            "Fn::Join": [
              "",
              [
                "s3://",
                {
                  "Ref": "RagEnginesSageMakerModelMultiAB24ABucketF09A69F9",
                },
                "/out/model.tar.gz",
              ],
            ],
          },
        },
      },
      "Type": "AWS::SageMaker::Model",
    },
    "RagEnginesSageMakerModelMultiAB24AModelCodeAwsCliLayer876643AD": {
      "Properties": {
        "Content": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "/opt/awscli/aws",
      },
      "Type": "AWS::Lambda::LayerVersion",
    },
    "RagEnginesSageMakerModelMultiAB24AModelCodeCustomResourceA0D3E041": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "DestinationBucketKeyPrefix": "model-code",
        "DestinationBucketName": {
          "Ref": "RagEnginesSageMakerModelMultiAB24ABucketF09A69F9",
        },
        "Prune": true,
        "RetainOnDelete": false,
        "ServiceToken": {
          "Fn::GetAtt": [
            "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C81C01536",
            "Arn",
          ],
        },
        "SourceBucketNames": [
          "cdk-hnb659fds-assets-111111111-us-east-1",
        ],
        "SourceObjectKeys": [
          "Dummy",
        ],
      },
      "Type": "Custom::CDKBucketDeployment",
      "UpdateReplacePolicy": "Delete",
    },
    "RagEnginesSageMakerModelMultiAB24AOnEventHandler3AAD1104": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24AOnEventHandlerServiceRoleDefaultPolicyBE53C89A",
        "RagEnginesSageMakerModelMultiAB24AOnEventHandlerServiceRole0D576031",
      ],
      "Properties": {
        "Architectures": [
          "arm64",
        ],
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "Manages HuggingFace model build requests",
        "Handler": "index.on_event",
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "Role": {
          "Fn::GetAtt": [
            "RagEnginesSageMakerModelMultiAB24AOnEventHandlerServiceRole0D576031",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
      },
      "Type": "AWS::Lambda::Function",
    },
    "RagEnginesSageMakerModelMultiAB24AOnEventHandlerLogRetentionF204D605": {
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "RagEnginesSageMakerModelMultiAB24AOnEventHandler3AAD1104",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "RagEnginesSageMakerModelMultiAB24AOnEventHandlerServiceRole0D576031": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SF1",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-SF2",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesSageMakerModelMultiAB24AOnEventHandlerServiceRoleDefaultPolicyBE53C89A": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "codebuild:StartBuild",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesSageMakerModelMultiAB24AOnEventHandlerServiceRoleDefaultPolicyBE53C89A",
        "Roles": [
          {
            "Ref": "RagEnginesSageMakerModelMultiAB24AOnEventHandlerServiceRole0D576031",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesSageMakerModelMultiAB24AProviderframeworkisComplete0D14240D": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
        "RagEnginesSageMakerModelMultiAB24AProviderframeworkisCompleteServiceRoleDefaultPolicyCAE451CD",
        "RagEnginesSageMakerModelMultiAB24AProviderframeworkisCompleteServiceRole839AE1FE",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "AWS CDK resource provider framework - isComplete (prefixGenAIChatBotStack/RagEngines/SageMaker/Model/MultiAB24A/Provider)",
        "Environment": {
          "Variables": {
            "USER_IS_COMPLETE_FUNCTION_ARN": {
              "Fn::GetAtt": [
                "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerDF048AE3",
                "Arn",
              ],
            },
            "USER_ON_EVENT_FUNCTION_ARN": {
              "Fn::GetAtt": [
                "RagEnginesSageMakerModelMultiAB24AOnEventHandler3AAD1104",
                "Arn",
              ],
            },
          },
        },
        "Handler": "framework.isComplete",
        "Role": {
          "Fn::GetAtt": [
            "RagEnginesSageMakerModelMultiAB24AProviderframeworkisCompleteServiceRole839AE1FE",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "RagEnginesSageMakerModelMultiAB24AProviderframeworkisCompleteServiceRole839AE1FE": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SF1",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-SF2",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesSageMakerModelMultiAB24AProviderframeworkisCompleteServiceRoleDefaultPolicyCAE451CD": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SF1",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-SF2",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesSageMakerModelMultiAB24AOnEventHandler3AAD1104",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesSageMakerModelMultiAB24AOnEventHandler3AAD1104",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerDF048AE3",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerDF048AE3",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesSageMakerModelMultiAB24AProviderframeworkisCompleteServiceRoleDefaultPolicyCAE451CD",
        "Roles": [
          {
            "Ref": "RagEnginesSageMakerModelMultiAB24AProviderframeworkisCompleteServiceRole839AE1FE",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesSageMakerModelMultiAB24AProviderframeworkonEventC75C76C6": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
        "RagEnginesSageMakerModelMultiAB24AProviderframeworkonEventServiceRoleDefaultPolicy22EFF5D4",
        "RagEnginesSageMakerModelMultiAB24AProviderframeworkonEventServiceRoleF3392DDD",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "AWS CDK resource provider framework - onEvent (prefixGenAIChatBotStack/RagEngines/SageMaker/Model/MultiAB24A/Provider)",
        "Environment": {
          "Variables": {
            "USER_IS_COMPLETE_FUNCTION_ARN": {
              "Fn::GetAtt": [
                "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerDF048AE3",
                "Arn",
              ],
            },
            "USER_ON_EVENT_FUNCTION_ARN": {
              "Fn::GetAtt": [
                "RagEnginesSageMakerModelMultiAB24AOnEventHandler3AAD1104",
                "Arn",
              ],
            },
            "WAITER_STATE_MACHINE_ARN": {
              "Ref": "RagEnginesSageMakerModelMultiAB24AProviderwaiterstatemachineBE5457F2",
            },
          },
        },
        "Handler": "framework.onEvent",
        "Role": {
          "Fn::GetAtt": [
            "RagEnginesSageMakerModelMultiAB24AProviderframeworkonEventServiceRoleF3392DDD",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "RagEnginesSageMakerModelMultiAB24AProviderframeworkonEventServiceRoleDefaultPolicy22EFF5D4": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SF1",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-SF2",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesSageMakerModelMultiAB24AOnEventHandler3AAD1104",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesSageMakerModelMultiAB24AOnEventHandler3AAD1104",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerDF048AE3",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerDF048AE3",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "states:StartExecution",
              "Effect": "Allow",
              "Resource": {
                "Ref": "RagEnginesSageMakerModelMultiAB24AProviderwaiterstatemachineBE5457F2",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesSageMakerModelMultiAB24AProviderframeworkonEventServiceRoleDefaultPolicy22EFF5D4",
        "Roles": [
          {
            "Ref": "RagEnginesSageMakerModelMultiAB24AProviderframeworkonEventServiceRoleF3392DDD",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesSageMakerModelMultiAB24AProviderframeworkonEventServiceRoleF3392DDD": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SF1",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-SF2",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesSageMakerModelMultiAB24AProviderframeworkonTimeoutDBD8B04B": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
        "RagEnginesSageMakerModelMultiAB24AProviderframeworkonTimeoutServiceRoleDefaultPolicy0A4130BF",
        "RagEnginesSageMakerModelMultiAB24AProviderframeworkonTimeoutServiceRole080F6A31",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "AWS CDK resource provider framework - onTimeout (prefixGenAIChatBotStack/RagEngines/SageMaker/Model/MultiAB24A/Provider)",
        "Environment": {
          "Variables": {
            "USER_IS_COMPLETE_FUNCTION_ARN": {
              "Fn::GetAtt": [
                "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerDF048AE3",
                "Arn",
              ],
            },
            "USER_ON_EVENT_FUNCTION_ARN": {
              "Fn::GetAtt": [
                "RagEnginesSageMakerModelMultiAB24AOnEventHandler3AAD1104",
                "Arn",
              ],
            },
          },
        },
        "Handler": "framework.onTimeout",
        "Role": {
          "Fn::GetAtt": [
            "RagEnginesSageMakerModelMultiAB24AProviderframeworkonTimeoutServiceRole080F6A31",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "RagEnginesSageMakerModelMultiAB24AProviderframeworkonTimeoutServiceRole080F6A31": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SF1",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-SF2",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesSageMakerModelMultiAB24AProviderframeworkonTimeoutServiceRoleDefaultPolicy0A4130BF": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SF1",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-SF2",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesSageMakerModelMultiAB24AOnEventHandler3AAD1104",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesSageMakerModelMultiAB24AOnEventHandler3AAD1104",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerDF048AE3",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesSageMakerModelMultiAB24AIsCompleteHandlerDF048AE3",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesSageMakerModelMultiAB24AProviderframeworkonTimeoutServiceRoleDefaultPolicy0A4130BF",
        "Roles": [
          {
            "Ref": "RagEnginesSageMakerModelMultiAB24AProviderframeworkonTimeoutServiceRole080F6A31",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesSageMakerModelMultiAB24AProviderwaiterstatemachineBE5457F2": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
        "RagEnginesSageMakerModelMultiAB24AProviderwaiterstatemachineRoleDefaultPolicy8E60AA88",
        "RagEnginesSageMakerModelMultiAB24AProviderwaiterstatemachineRole7414E6C2",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SF1",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-SF2",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "DefinitionString": {
          "Fn::Join": [
            "",
            [
              "{"StartAt":"framework-isComplete-task","States":{"framework-isComplete-task":{"End":true,"Retry":[{"ErrorEquals":["States.ALL"],"IntervalSeconds":30,"MaxAttempts":240,"BackoffRate":1}],"Catch":[{"ErrorEquals":["States.ALL"],"Next":"framework-onTimeout-task"}],"Type":"Task","Resource":"",
              {
                "Fn::GetAtt": [
                  "RagEnginesSageMakerModelMultiAB24AProviderframeworkisComplete0D14240D",
                  "Arn",
                ],
              },
              ""},"framework-onTimeout-task":{"End":true,"Type":"Task","Resource":"",
              {
                "Fn::GetAtt": [
                  "RagEnginesSageMakerModelMultiAB24AProviderframeworkonTimeoutDBD8B04B",
                  "Arn",
                ],
              },
              ""}}}",
            ],
          ],
        },
        "LoggingConfiguration": {
          "Destinations": [
            {
              "CloudWatchLogsLogGroup": {
                "LogGroupArn": {
                  "Fn::GetAtt": [
                    "RagEnginesSageMakerModelMultiAB24AProviderwaiterstatemachineLogGroup98223E01",
                    "Arn",
                  ],
                },
              },
            },
          ],
          "IncludeExecutionData": false,
          "Level": "ERROR",
        },
        "RoleArn": {
          "Fn::GetAtt": [
            "RagEnginesSageMakerModelMultiAB24AProviderwaiterstatemachineRole7414E6C2",
            "Arn",
          ],
        },
      },
      "Type": "AWS::StepFunctions::StateMachine",
    },
    "RagEnginesSageMakerModelMultiAB24AProviderwaiterstatemachineLogGroup98223E01": {
      "DeletionPolicy": "Retain",
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
      ],
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/vendedlogs/states/waiter-state-machine-",
              {
                "Ref": "RagEnginesSageMakerModelMultiAB24AProviderframeworkisComplete0D14240D",
              },
              "-c8db3e9c81ac5aa76d78a859f97c714abb206fdb93",
            ],
          ],
        },
        "RetentionInDays": 731,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesSageMakerModelMultiAB24AProviderwaiterstatemachineRole7414E6C2": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
      ],
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "states.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesSageMakerModelMultiAB24AProviderwaiterstatemachineRoleDefaultPolicy8E60AA88": {
      "DependsOn": [
        "RagEnginesSageMakerModelMultiAB24ACodeBuildProjectE6650C61",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SF1",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-SF2",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesSageMakerModelMultiAB24AProviderframeworkisComplete0D14240D",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesSageMakerModelMultiAB24AProviderframeworkisComplete0D14240D",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesSageMakerModelMultiAB24AProviderframeworkonTimeoutDBD8B04B",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesSageMakerModelMultiAB24AProviderframeworkonTimeoutDBD8B04B",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "logs:CreateLogDelivery",
                "logs:CreateLogStream",
                "logs:GetLogDelivery",
                "logs:UpdateLogDelivery",
                "logs:DeleteLogDelivery",
                "logs:ListLogDeliveries",
                "logs:PutLogEvents",
                "logs:PutResourcePolicy",
                "logs:DescribeResourcePolicies",
                "logs:DescribeLogGroups",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesSageMakerModelMultiAB24AProviderwaiterstatemachineRoleDefaultPolicy8E60AA88",
        "Roles": [
          {
            "Ref": "RagEnginesSageMakerModelMultiAB24AProviderwaiterstatemachineRole7414E6C2",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesSageMakerModelMultiAB24ASageMakerExecutionRole6740DE48": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "Gives user ability to deploy and delete endpoints from the UI.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "Gives user ability to deploy and delete endpoints from the UI.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "sagemaker.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/AmazonSageMakerFullAccess",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesSageMakerModelMultiAB24ASageMakerExecutionRoleDefaultPolicy75A232F4": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SF1",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-SF2",
              "reason": "SFN implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesSageMakerModelMultiAB24ABucketF09A69F9",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesSageMakerModelMultiAB24ABucketF09A69F9",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesSageMakerModelMultiAB24ASageMakerExecutionRoleDefaultPolicy75A232F4",
        "Roles": [
          {
            "Ref": "RagEnginesSageMakerModelMultiAB24ASageMakerExecutionRole6740DE48",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesSageMakerModelMultiAB24AScriptAwsCliLayer3B70313A": {
      "Properties": {
        "Content": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "/opt/awscli/aws",
      },
      "Type": "AWS::Lambda::LayerVersion",
    },
    "RagEnginesSageMakerModelMultiAB24AScriptCustomResource976B9D13": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "DestinationBucketKeyPrefix": "build-script",
        "DestinationBucketName": {
          "Ref": "RagEnginesSageMakerModelMultiAB24ABucketF09A69F9",
        },
        "Prune": true,
        "RetainOnDelete": false,
        "ServiceToken": {
          "Fn::GetAtt": [
            "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C81C01536",
            "Arn",
          ],
        },
        "SourceBucketNames": [
          "cdk-hnb659fds-assets-111111111-us-east-1",
        ],
        "SourceObjectKeys": [
          "Dummy",
        ],
      },
      "Type": "Custom::CDKBucketDeployment",
      "UpdateReplacePolicy": "Delete",
    },
    "RagEnginesWorkspacesDeleteDocumentA1FD6471": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "RagEnginesWorkspacesDeleteDocumentRoleDefaultPolicy71FACDB8",
        "RagEnginesWorkspacesDeleteDocumentRoleF5BDB92F",
      ],
      "Properties": {
        "DefinitionString": {
          "Fn::Join": [
            "",
            [
              "{"StartAt":"SetDeleting","States":{"SetDeleting":{"Next":"Delete","Type":"Task","ResultPath":null,"Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::dynamodb:updateItem","Parameters":{"Key":{"workspace_id":{"S.$":"$.workspace_id"},"document_id":{"S.$":"$.document_id"}},"TableName":"",
              {
                "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
              },
              "","ExpressionAttributeNames":{"#status":"status"},"ExpressionAttributeValues":{":statusValue":{"S":"deleting"}},"UpdateExpression":"set #status=:statusValue"}},"Delete":{"Next":"Success","Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Catch":[{"ErrorEquals":["States.ALL"],"ResultPath":"$.deleteResult","Next":"HandleError"}],"Type":"Task","ResultPath":"$.deleteResult","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::lambda:invoke","Parameters":{"FunctionName":"",
              {
                "Fn::GetAtt": [
                  "RagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionF13C7D85",
                  "Arn",
                ],
              },
              "","Payload.$":"$"}},"Success":{"Type":"Succeed"},"HandleError":{"Next":"Fail","Type":"Task","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::dynamodb:updateItem","Parameters":{"Key":{"workspace_id":{"S.$":"$.workspace_id"},"document_id":{"S.$":"$.document_id"}},"TableName":"",
              {
                "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
              },
              "","ExpressionAttributeNames":{"#status":"status"},"ExpressionAttributeValues":{":error":{"S":"error"}},"UpdateExpression":"set #status = :error"}},"Fail":{"Type":"Fail","Cause":"Document deletion failed"}},"TimeoutSeconds":300,"Comment":"Delete Document Workflow"}",
            ],
          ],
        },
        "LoggingConfiguration": {
          "Destinations": [
            {
              "CloudWatchLogsLogGroup": {
                "LogGroupArn": {
                  "Fn::GetAtt": [
                    "RagEnginesWorkspacesDeleteDocumentDeleteDocumentSMLogGroupD3F7AE1A",
                    "Arn",
                  ],
                },
              },
            },
          ],
          "Level": "ALL",
        },
        "RoleArn": {
          "Fn::GetAtt": [
            "RagEnginesWorkspacesDeleteDocumentRoleF5BDB92F",
            "Arn",
          ],
        },
        "TracingConfiguration": {
          "Enabled": true,
        },
      },
      "Type": "AWS::StepFunctions::StateMachine",
      "UpdateReplacePolicy": "Delete",
    },
    "RagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionF13C7D85": {
      "DependsOn": [
        "RagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionServiceRoleDefaultPolicyF5706972",
        "RagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionServiceRole3BBCBEE9",
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "Architectures": [
          "x86_64",
        ],
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "Deletes document added to a workspace",
        "Environment": {
          "Variables": {
            "AURORA_DB_HOST": {
              "Fn::GetAtt": [
                "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                "Endpoint.Address",
              ],
            },
            "AURORA_DB_PORT": {
              "Fn::GetAtt": [
                "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                "Endpoint.Port",
              ],
            },
            "AURORA_DB_USER": "aurora_db_iam_write",
            "AWS_XRAY_SDK_ENABLED": "false",
            "DEFAULT_KENDRA_S3_DATA_SOURCE_BUCKET_NAME": {
              "Ref": "RagEnginesKendraRetrievalKendraDataBucket1627A447",
            },
            "DOCUMENTS_BY_COMPOUND_KEY_INDEX_NAME": "by_compound_key_idx",
            "DOCUMENTS_TABLE_NAME": {
              "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
            },
            "LOG_LEVEL": "INFO",
            "OPEN_SEARCH_COLLECTION_ENDPOINT": {
              "Fn::GetAtt": [
                "RagEnginesOpenSearchVectorOpenSearchCollectionCMK872E47D8",
                "CollectionEndpoint",
              ],
            },
            "POWERTOOLS_DEV": "false",
            "POWERTOOLS_LOGGER_LOG_EVENT": "false",
            "POWERTOOLS_SERVICE_NAME": "chatbot",
            "POWERTOOLS_TRACE_DISABLED": "true",
            "PROCESSING_BUCKET_NAME": {
              "Ref": "RagEnginesDataImportProcessingBucketA7BE9701",
            },
            "UPLOAD_BUCKET_NAME": {
              "Ref": "RagEnginesDataImportUploadBucket061D697E",
            },
            "WORKSPACES_BY_OBJECT_TYPE_INDEX_NAME": "by_object_type_idx",
            "WORKSPACES_TABLE_NAME": {
              "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
            },
          },
        },
        "Handler": "index.lambda_handler",
        "Layers": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":lambda:",
                {
                  "Ref": "AWS::Region",
                },
                ":017000801446:layer:AWSLambdaPowertoolsPythonV3-python311-x86_64:2",
              ],
            ],
          },
          {
            "Ref": "SharedCommonLayerFC89CBCE",
          },
        ],
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "Role": {
          "Fn::GetAtt": [
            "RagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionServiceRole3BBCBEE9",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
        "Timeout": 900,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "RagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionSecurityGroupD7C57FB7",
                "GroupId",
              ],
            },
          ],
          "SubnetIds": [
            {
              "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
            },
            {
              "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
            },
            {
              "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
            },
          ],
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "RagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionLogRetentionFB073E77": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "RagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionF13C7D85",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "RagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionSecurityGroupD7C57FB7": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "GroupDescription": "Automatic security group for Lambda Function prefixGenAIChatBotStackRagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionE4BF692D",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "RagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionServiceRole3BBCBEE9": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionServiceRoleDefaultPolicyF5706972": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "rds-db:connect",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":rds-db:us-east-1:111111111:dbuser:",
                    {
                      "Fn::GetAtt": [
                        "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                        "DBClusterResourceId",
                      ],
                    },
                    "/aurora_db_iam_write",
                  ],
                ],
              },
            },
            {
              "Action": [
                "aoss:APIAccessAll",
                "aoss:DescribeIndex",
                "aoss:UpdateIndex",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RagEnginesOpenSearchVectorOpenSearchCollectionCMK872E47D8",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportUploadBucket061D697E",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportUploadBucket061D697E",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportProcessingBucketA7BE9701",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportProcessingBucketA7BE9701",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesKendraRetrievalKendraDataBucket1627A447",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesKendraRetrievalKendraDataBucket1627A447",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionServiceRoleDefaultPolicyF5706972",
        "Roles": [
          {
            "Ref": "RagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionServiceRole3BBCBEE9",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesWorkspacesDeleteDocumentDeleteDocumentSMLogGroupD3F7AE1A": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "LogGroupName": "/aws/vendedlogs/states/DeleteWorkspace-c8f300d08639a84d1a06e986b62cd5544b8a7b47f9",
        "RetentionInDays": 731,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesWorkspacesDeleteDocumentRoleDefaultPolicy71FACDB8": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "dynamodb:UpdateItem",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":dynamodb:us-east-1:111111111:table/",
                    {
                      "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                    },
                  ],
                ],
              },
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionF13C7D85",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesWorkspacesDeleteDocumentDeleteDocumentFunctionF13C7D85",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "logs:CreateLogDelivery",
                "logs:GetLogDelivery",
                "logs:UpdateLogDelivery",
                "logs:DeleteLogDelivery",
                "logs:ListLogDeliveries",
                "logs:PutResourcePolicy",
                "logs:DescribeResourcePolicies",
                "logs:DescribeLogGroups",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
                "xray:GetSamplingRules",
                "xray:GetSamplingTargets",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesWorkspacesDeleteDocumentRoleDefaultPolicy71FACDB8",
        "Roles": [
          {
            "Ref": "RagEnginesWorkspacesDeleteDocumentRoleF5BDB92F",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesWorkspacesDeleteDocumentRoleF5BDB92F": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "states.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesWorkspacesDeleteWorkspace6908C6DA": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "RagEnginesWorkspacesDeleteWorkspaceRoleDefaultPolicyDB594186",
        "RagEnginesWorkspacesDeleteWorkspaceRole19E7851E",
      ],
      "Properties": {
        "DefinitionString": {
          "Fn::Join": [
            "",
            [
              "{"StartAt":"SetDeleting","States":{"SetDeleting":{"Next":"Delete","Type":"Task","ResultPath":null,"Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::dynamodb:updateItem","Parameters":{"Key":{"workspace_id":{"S.$":"$.workspace_id"},"object_type":{"S":"workspace"}},"TableName":"",
              {
                "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
              },
              "","ExpressionAttributeNames":{"#status":"status"},"ExpressionAttributeValues":{":statusValue":{"S":"deleting"}},"UpdateExpression":"set #status=:statusValue"}},"Delete":{"Next":"Success","Retry":[{"ErrorEquals":["Lambda.ClientExecutionTimeoutException","Lambda.ServiceException","Lambda.AWSLambdaException","Lambda.SdkClientException"],"IntervalSeconds":2,"MaxAttempts":6,"BackoffRate":2}],"Catch":[{"ErrorEquals":["States.ALL"],"ResultPath":"$.deleteResult","Next":"HandleError"}],"Type":"Task","ResultPath":"$.deleteResult","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::lambda:invoke","Parameters":{"FunctionName":"",
              {
                "Fn::GetAtt": [
                  "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunction8A41CF72",
                  "Arn",
                ],
              },
              "","Payload.$":"$"}},"Success":{"Type":"Succeed"},"HandleError":{"Next":"Fail","Type":"Task","Resource":"arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":states:::dynamodb:updateItem","Parameters":{"Key":{"workspace_id":{"S.$":"$.workspace_id"},"object_type":{"S":"workspace"}},"TableName":"",
              {
                "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
              },
              "","ExpressionAttributeNames":{"#status":"status"},"ExpressionAttributeValues":{":error":{"S":"error"}},"UpdateExpression":"set #status = :error"}},"Fail":{"Type":"Fail","Cause":"Workspace deletion failed"}},"TimeoutSeconds":300,"Comment":"Delete Workspace Workflow"}",
            ],
          ],
        },
        "LoggingConfiguration": {
          "Destinations": [
            {
              "CloudWatchLogsLogGroup": {
                "LogGroupArn": {
                  "Fn::GetAtt": [
                    "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceSMLogGroup6EA3524F",
                    "Arn",
                  ],
                },
              },
            },
          ],
          "Level": "ALL",
        },
        "RoleArn": {
          "Fn::GetAtt": [
            "RagEnginesWorkspacesDeleteWorkspaceRole19E7851E",
            "Arn",
          ],
        },
        "TracingConfiguration": {
          "Enabled": true,
        },
      },
      "Type": "AWS::StepFunctions::StateMachine",
      "UpdateReplacePolicy": "Delete",
    },
    "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunction8A41CF72": {
      "DependsOn": [
        "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunctionServiceRoleDefaultPolicy2A165D0F",
        "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunctionServiceRoleD99F8BAF",
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "Architectures": [
          "x86_64",
        ],
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "Deletes a workspace",
        "Environment": {
          "Variables": {
            "AURORA_DB_HOST": {
              "Fn::GetAtt": [
                "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                "Endpoint.Address",
              ],
            },
            "AURORA_DB_PORT": {
              "Fn::GetAtt": [
                "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                "Endpoint.Port",
              ],
            },
            "AURORA_DB_USER": "aurora_db_iam_admin",
            "AWS_XRAY_SDK_ENABLED": "false",
            "DEFAULT_KENDRA_S3_DATA_SOURCE_BUCKET_NAME": {
              "Ref": "RagEnginesKendraRetrievalKendraDataBucket1627A447",
            },
            "DOCUMENTS_BY_COMPOUND_KEY_INDEX_NAME": "by_compound_key_idx",
            "DOCUMENTS_BY_STATUS_INDEX": "by_status_idx",
            "DOCUMENTS_TABLE_NAME": {
              "Ref": "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
            },
            "LOG_LEVEL": "INFO",
            "OPEN_SEARCH_COLLECTION_ENDPOINT": {
              "Fn::GetAtt": [
                "RagEnginesOpenSearchVectorOpenSearchCollectionCMK872E47D8",
                "CollectionEndpoint",
              ],
            },
            "POWERTOOLS_DEV": "false",
            "POWERTOOLS_LOGGER_LOG_EVENT": "false",
            "POWERTOOLS_SERVICE_NAME": "chatbot",
            "POWERTOOLS_TRACE_DISABLED": "true",
            "PROCESSING_BUCKET_NAME": {
              "Ref": "RagEnginesDataImportProcessingBucketA7BE9701",
            },
            "UPLOAD_BUCKET_NAME": {
              "Ref": "RagEnginesDataImportUploadBucket061D697E",
            },
            "WORKSPACES_BY_OBJECT_TYPE_INDEX_NAME": "by_object_type_idx",
            "WORKSPACES_TABLE_NAME": {
              "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
            },
          },
        },
        "Handler": "index.lambda_handler",
        "Layers": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":lambda:",
                {
                  "Ref": "AWS::Region",
                },
                ":017000801446:layer:AWSLambdaPowertoolsPythonV3-python311-x86_64:2",
              ],
            ],
          },
          {
            "Ref": "SharedCommonLayerFC89CBCE",
          },
        ],
        "LoggingConfig": {
          "LogFormat": "JSON",
        },
        "Role": {
          "Fn::GetAtt": [
            "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunctionServiceRoleD99F8BAF",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
        "Timeout": 900,
        "VpcConfig": {
          "SecurityGroupIds": [
            {
              "Fn::GetAtt": [
                "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunctionSecurityGroup9E919F5A",
                "GroupId",
              ],
            },
          ],
          "SubnetIds": [
            {
              "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
            },
            {
              "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
            },
            {
              "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
            },
          ],
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunctionLogRetention968A7432": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "LogGroupName": {
          "Fn::Join": [
            "",
            [
              "/aws/lambda/",
              {
                "Ref": "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunction8A41CF72",
              },
            ],
          ],
        },
        "RetentionInDays": 7,
        "ServiceToken": {
          "Fn::GetAtt": [
            "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A",
            "Arn",
          ],
        },
      },
      "Type": "Custom::LogRetention",
    },
    "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunctionSecurityGroup9E919F5A": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Properties": {
        "GroupDescription": "Automatic security group for Lambda Function prefixGenAIChatBotStackRagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunctionC31C7989",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunctionServiceRoleD99F8BAF": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunctionServiceRoleDefaultPolicy2A165D0F": {
      "DependsOn": [
        "SharedVPCprivateSubnet1DefaultRoute608F3753",
        "SharedVPCprivateSubnet1RouteTableAssociation83D920FA",
        "SharedVPCprivateSubnet2DefaultRoute4387C202",
        "SharedVPCprivateSubnet2RouteTableAssociation6788E94C",
        "SharedVPCprivateSubnet3DefaultRoute3BBCF55F",
        "SharedVPCprivateSubnet3RouteTableAssociation4181A59C",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "rds-db:connect",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":rds-db:us-east-1:111111111:dbuser:",
                    {
                      "Fn::GetAtt": [
                        "RagEnginesAuroraPgVectorAuroraDatabase2A003265",
                        "DBClusterResourceId",
                      ],
                    },
                    "/aurora_db_iam_admin",
                  ],
                ],
              },
            },
            {
              "Action": [
                "aoss:APIAccessAll",
                "aoss:DescribeIndex",
                "aoss:DeleteIndex",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "RagEnginesOpenSearchVectorOpenSearchCollectionCMK872E47D8",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportUploadBucket061D697E",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportUploadBucket061D697E",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportProcessingBucketA7BE9701",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesDataImportProcessingBucketA7BE9701",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesKendraRetrievalKendraDataBucket1627A447",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesKendraRetrievalKendraDataBucket1627A447",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesRagDynamoDBTablesDocumentsF6F2B272",
                          "Arn",
                        ],
                      },
                      "/index/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunctionServiceRoleDefaultPolicy2A165D0F",
        "Roles": [
          {
            "Ref": "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunctionServiceRoleD99F8BAF",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceSMLogGroup6EA3524F": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "LogGroupName": "/aws/vendedlogs/states/DeleteWorkspace-c8d0f97b477041b4948603d16e0499afeaa5361c9c",
        "RetentionInDays": 731,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "RagEnginesWorkspacesDeleteWorkspaceRole19E7851E": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "states.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "RagEnginesWorkspacesDeleteWorkspaceRoleDefaultPolicyDB594186": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM4",
              "reason": "IAM role implicitly created by CDK.",
            },
            {
              "id": "AwsSolutions-IAM5",
              "reason": "IAM role implicitly created by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "dynamodb:UpdateItem",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition",
                    },
                    ":dynamodb:us-east-1:111111111:table/",
                    {
                      "Ref": "RagEnginesRagDynamoDBTablesWorkspacesD2D3C0C4",
                    },
                  ],
                ],
              },
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunction8A41CF72",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "RagEnginesWorkspacesDeleteWorkspaceDeleteWorkspaceFunction8A41CF72",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "logs:CreateLogDelivery",
                "logs:GetLogDelivery",
                "logs:UpdateLogDelivery",
                "logs:DeleteLogDelivery",
                "logs:ListLogDeliveries",
                "logs:PutResourcePolicy",
                "logs:DescribeResourcePolicies",
                "logs:DescribeLogGroups",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
                "xray:GetSamplingRules",
                "xray:GetSamplingTargets",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedKMSKey7BCBB616",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RagEnginesWorkspacesDeleteWorkspaceRoleDefaultPolicyDB594186",
        "Roles": [
          {
            "Ref": "RagEnginesWorkspacesDeleteWorkspaceRole19E7851E",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "SharedApiKeysSecret9EA666ED": {
      "DeletionPolicy": "Delete",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SMG4",
              "reason": "Secret value is blank.",
            },
          ],
        },
      },
      "Properties": {
        "KmsKeyId": {
          "Fn::GetAtt": [
            "SharedKMSKey7BCBB616",
            "Arn",
          ],
        },
        "SecretString": "{}",
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "SharedCommonLayerFC89CBCE": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "CompatibleArchitectures": [
          "x86_64",
        ],
        "CompatibleRuntimes": [
          "python3.11",
        ],
        "Content": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
      },
      "Type": "AWS::Lambda::LayerVersion",
      "UpdateReplacePolicy": "Delete",
    },
    "SharedConfig358B4A20": {
      "Properties": {
        "Type": "String",
        "Value": "{"prefix":"prefix","privateWebsite":true,"certificate":"","cfGeoRestrictEnable":true,"cfGeoRestrictList":[],"bedrock":{"enabled":true,"region":"us-east-1"},"llms":{"sagemaker":["FalconLite [ml.g5.12xlarge]","Idefics_80b (Multimodal) [ml.g5.48xlarge]"]},"rag":{"crossEncodingEnabled":true,"enabled":true,"engines":{"aurora":{"enabled":true},"opensearch":{"enabled":true},"kendra":{"enabled":true,"createIndex":true,"enterprise":true},"knowledgeBase":{"enabled":false}},"embeddingsModels":[{"provider":"sagemaker","name":"intfloat/multilingual-e5-large","dimensions":1024},{"provider":"sagemaker","name":"sentence-transformers/all-MiniLM-L6-v2","dimensions":384},{"provider":"bedrock","name":"amazon.titan-embed-text-v1","dimensions":1536},{"provider":"bedrock","name":"amazon.titan-embed-image-v1","dimensions":1024},{"provider":"bedrock","name":"cohere.embed-english-v3","dimensions":1024},{"provider":"bedrock","name":"cohere.embed-multilingual-v3","dimensions":1024,"default":true},{"provider":"openai","name":"text-embedding-ada-002","dimensions":1536}],"crossEncoderModels":[{"provider":"sagemaker","name":"cross-encoder/ms-marco-MiniLM-L-12-v2","default":true}]},"createCMKs":true,"retainOnDelete":true}",
      },
      "Type": "AWS::SSM::Parameter",
    },
    "SharedFLowLogsLogGroupE884FFC6": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "RetentionInDays": 731,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
    },
    "SharedFlowLog04219D2B": {
      "Properties": {
        "DeliverLogsPermissionArn": {
          "Fn::GetAtt": [
            "SharedFlowLogIAMRoleA0029984",
            "Arn",
          ],
        },
        "LogDestinationType": "cloud-watch-logs",
        "LogGroupName": {
          "Ref": "SharedFLowLogsLogGroupE884FFC6",
        },
        "ResourceId": {
          "Ref": "SharedVPC6716DA5E",
        },
        "ResourceType": "VPC",
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/FlowLog",
          },
        ],
        "TrafficType": "ALL",
      },
      "Type": "AWS::EC2::FlowLog",
    },
    "SharedFlowLogIAMRoleA0029984": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "vpc-flow-logs.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/FlowLog",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "SharedFlowLogIAMRoleDefaultPolicy5D283BCF": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
                "logs:DescribeLogStreams",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedFLowLogsLogGroupE884FFC6",
                  "Arn",
                ],
              },
            },
            {
              "Action": "iam:PassRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "SharedFlowLogIAMRoleA0029984",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "SharedFlowLogIAMRoleDefaultPolicy5D283BCF",
        "Roles": [
          {
            "Ref": "SharedFlowLogIAMRoleA0029984",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "SharedKMSKey7BCBB616": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Properties": {
        "EnableKeyRotation": true,
        "KeyPolicy": {
          "Statement": [
            {
              "Action": "kms:*",
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::111111111:root",
                    ],
                  ],
                },
              },
              "Resource": "*",
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Condition": {
                "StringEquals": {
                  "kms:ViaService": "secretsmanager.us-east-1.amazonaws.com",
                },
              },
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::111111111:root",
                    ],
                  ],
                },
              },
              "Resource": "*",
            },
            {
              "Action": [
                "kms:CreateGrant",
                "kms:DescribeKey",
              ],
              "Condition": {
                "StringEquals": {
                  "kms:ViaService": "secretsmanager.us-east-1.amazonaws.com",
                },
              },
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::111111111:root",
                    ],
                  ],
                },
              },
              "Resource": "*",
            },
            {
              "Action": "kms:Decrypt",
              "Condition": {
                "StringEquals": {
                  "kms:ViaService": "secretsmanager.us-east-1.amazonaws.com",
                },
              },
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportFileImportBatchJobFileImportJobRoleCA3E6A38",
                    "Arn",
                  ],
                },
              },
              "Resource": "*",
            },
            {
              "Action": "kms:Decrypt",
              "Condition": {
                "StringEquals": {
                  "kms:ViaService": "secretsmanager.us-east-1.amazonaws.com",
                },
              },
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportWebCrawlerBatchJobWebCrawlerJobRoleE84A3DDA",
                    "Arn",
                  ],
                },
              },
              "Resource": "*",
            },
            {
              "Action": "kms:Decrypt",
              "Condition": {
                "StringEquals": {
                  "kms:ViaService": "secretsmanager.us-east-1.amazonaws.com",
                },
              },
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::GetAtt": [
                    "RagEnginesDataImportUploadHandlerServiceRole46EB8689",
                    "Arn",
                  ],
                },
              },
              "Resource": "*",
            },
            {
              "Action": "kms:Decrypt",
              "Condition": {
                "StringEquals": {
                  "kms:ViaService": "secretsmanager.us-east-1.amazonaws.com",
                },
              },
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::GetAtt": [
                    "ChatBotApiRestApiGraphQLApiHandlerServiceRole8BB05949",
                    "Arn",
                  ],
                },
              },
              "Resource": "*",
            },
            {
              "Action": "kms:Decrypt",
              "Condition": {
                "StringEquals": {
                  "kms:ViaService": "secretsmanager.us-east-1.amazonaws.com",
                },
              },
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::GetAtt": [
                    "LangchainInterfaceRequestHandlerServiceRole2FA1A914",
                    "Arn",
                  ],
                },
              },
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::KMS::Key",
      "UpdateReplacePolicy": "Retain",
    },
    "SharedKMSKeyAliasBBBE90C7": {
      "Properties": {
        "AliasName": "alias/prefixgenaichatbot-shared-key",
        "TargetKeyId": {
          "Fn::GetAtt": [
            "SharedKMSKey7BCBB616",
            "Arn",
          ],
        },
      },
      "Type": "AWS::KMS::Alias",
    },
    "SharedQueueKMSKey26598E83": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "EnableKeyRotation": true,
        "KeyPolicy": {
          "Statement": [
            {
              "Action": "kms:*",
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::111111111:root",
                    ],
                  ],
                },
              },
              "Resource": "*",
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Condition": {
                "ArnLike": {
                  "aws:SourceArn": {
                    "Fn::GetAtt": [
                      "RagEnginesDataImportUploadBucket061D697E",
                      "Arn",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Principal": {
                "Service": "s3.amazonaws.com",
              },
              "Resource": "*",
            },
            {
              "Action": [
                "kms:GenerateDataKey*",
                "kms:Decrypt",
              ],
              "Effect": "Allow",
              "Principal": {
                "Service": "s3.amazonaws.com",
              },
              "Resource": "*",
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:GenerateDataKey",
              ],
              "Effect": "Allow",
              "Principal": {
                "Service": "sns.amazonaws.com",
              },
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::KMS::Key",
      "UpdateReplacePolicy": "Delete",
    },
    "SharedQueueKMSKeyAliasEB8C3E11": {
      "Properties": {
        "AliasName": "alias/prefixgenaichatbot-queue-shared-key",
        "TargetKeyId": {
          "Fn::GetAtt": [
            "SharedQueueKMSKey26598E83",
            "Arn",
          ],
        },
      },
      "Type": "AWS::KMS::Alias",
    },
    "SharedVPC6716DA5E": {
      "Properties": {
        "CidrBlock": "10.0.0.0/16",
        "EnableDnsHostnames": true,
        "EnableDnsSupport": true,
        "InstanceTenancy": "default",
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
      },
      "Type": "AWS::EC2::VPC",
    },
    "SharedVPCAppSyncEndpoint1FEC814C": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPCAppSyncEndpointSecurityGroupCECBB909",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.appsync-api",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCAppSyncEndpointSecurityGroupCECBB909": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/Shared/VPC/AppSyncEndpoint/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "SharedVPCBatchEndpoint8F2C93AC": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPCBatchEndpointSecurityGroupCA581A78",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.batch",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCBatchEndpointSecurityGroupCA581A78": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/Shared/VPC/BatchEndpoint/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "SharedVPCBedrockEndpoint6213E5ED": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPCBedrockEndpointSecurityGroup8855CC1F",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.bedrock",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCBedrockEndpointSecurityGroup8855CC1F": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/Shared/VPC/BedrockEndpoint/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "SharedVPCBedrockRuntimeEndpointF3ACFB78": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPCBedrockRuntimeEndpointSecurityGroupFC36BAF8",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.bedrock-runtime",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCBedrockRuntimeEndpointSecurityGroupFC36BAF8": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/Shared/VPC/BedrockRuntimeEndpoint/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "SharedVPCDynamoDBEndpoint7FDC246D": {
      "Properties": {
        "RouteTableIds": [
          {
            "Ref": "SharedVPCprivateSubnet1RouteTable58B60459",
          },
          {
            "Ref": "SharedVPCprivateSubnet2RouteTable36F07E09",
          },
          {
            "Ref": "SharedVPCprivateSubnet3RouteTable01E05852",
          },
          {
            "Ref": "SharedVPCpublicSubnet1RouteTableCE49215C",
          },
          {
            "Ref": "SharedVPCpublicSubnet2RouteTableCF47EAD7",
          },
          {
            "Ref": "SharedVPCpublicSubnet3RouteTableCE4F660A",
          },
          {
            "Ref": "SharedVPCisolatedSubnet1RouteTableFEE7065A",
          },
          {
            "Ref": "SharedVPCisolatedSubnet2RouteTable661FCE70",
          },
          {
            "Ref": "SharedVPCisolatedSubnet3RouteTable3900DD68",
          },
        ],
        "ServiceName": {
          "Fn::Join": [
            "",
            [
              "com.amazonaws.",
              {
                "Ref": "AWS::Region",
              },
              ".dynamodb",
            ],
          ],
        },
        "VpcEndpointType": "Gateway",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCEC2EndpointBE1191F4": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPCEC2EndpointSecurityGroup904C1E6C",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.ec2",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCEC2EndpointSecurityGroup904C1E6C": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/Shared/VPC/EC2Endpoint/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "SharedVPCECSEndpointC6482F7A": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPCECSEndpointSecurityGroup7B8618C6",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.ecs",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCECSEndpointSecurityGroup7B8618C6": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/Shared/VPC/ECSEndpoint/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "SharedVPCIGW91FEB7EF": {
      "Properties": {
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
      },
      "Type": "AWS::EC2::InternetGateway",
    },
    "SharedVPCKMSEndpointBF4D576E": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPCKMSEndpointSecurityGroup3C428680",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.kms",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCKMSEndpointSecurityGroup3C428680": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/Shared/VPC/KMSEndpoint/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "SharedVPCKendraEndpoint3F711235": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPCKendraEndpointSecurityGroup66109AF1",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.kendra",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCKendraEndpointSecurityGroup66109AF1": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/Shared/VPC/KendraEndpoint/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "SharedVPCLambdaEndpoint4D3CF6B3": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPCLambdaEndpointSecurityGroup78411AE4",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.lambda",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCLambdaEndpointSecurityGroup78411AE4": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/Shared/VPC/LambdaEndpoint/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "SharedVPCPrivateApiEndpoint099B15FE": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPC6716DA5E",
              "DefaultSecurityGroup",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.execute-api",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCRDSDataEndpointF151E58D": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPCRDSDataEndpointSecurityGroup6C9AF6CB",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.rds-data",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCRDSDataEndpointSecurityGroup6C9AF6CB": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/Shared/VPC/RDSDataEndpoint/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "SharedVPCRDSEndpointC8F27EF3": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPCRDSEndpointSecurityGroupA26D3CBA",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.rds",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCRDSEndpointSecurityGroupA26D3CBA": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/Shared/VPC/RDSEndpoint/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "SharedVPCS3GatewayEndpoint13AA3DEC": {
      "Properties": {
        "RouteTableIds": [
          {
            "Ref": "SharedVPCprivateSubnet1RouteTable58B60459",
          },
          {
            "Ref": "SharedVPCprivateSubnet2RouteTable36F07E09",
          },
          {
            "Ref": "SharedVPCprivateSubnet3RouteTable01E05852",
          },
          {
            "Ref": "SharedVPCpublicSubnet1RouteTableCE49215C",
          },
          {
            "Ref": "SharedVPCpublicSubnet2RouteTableCF47EAD7",
          },
          {
            "Ref": "SharedVPCpublicSubnet3RouteTableCE4F660A",
          },
          {
            "Ref": "SharedVPCisolatedSubnet1RouteTableFEE7065A",
          },
          {
            "Ref": "SharedVPCisolatedSubnet2RouteTable661FCE70",
          },
          {
            "Ref": "SharedVPCisolatedSubnet3RouteTable3900DD68",
          },
        ],
        "ServiceName": {
          "Fn::Join": [
            "",
            [
              "com.amazonaws.",
              {
                "Ref": "AWS::Region",
              },
              ".s3",
            ],
          ],
        },
        "VpcEndpointType": "Gateway",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCS3InterfaceEndpointD26A9383": {
      "DependsOn": [
        "SharedVPCS3GatewayEndpoint13AA3DEC",
      ],
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPCS3InterfaceEndpointSecurityGroup06522FDD",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.s3",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCS3InterfaceEndpointSecurityGroup06522FDD": {
      "DependsOn": [
        "SharedVPCS3GatewayEndpoint13AA3DEC",
      ],
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/Shared/VPC/S3InterfaceEndpoint/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "SharedVPCSNSEndpoint0B44ABE1": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPCSNSEndpointSecurityGroup8A7F26EB",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.sns",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCSNSEndpointSecurityGroup8A7F26EB": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/Shared/VPC/SNSEndpoint/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "SharedVPCSSMEndpointDD973873": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPCSSMEndpointSecurityGroupE3573FB8",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.ssm",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCSSMEndpointSecurityGroupE3573FB8": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/Shared/VPC/SSMEndpoint/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "SharedVPCSageMakerRuntimeEndpoint7727FF26": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPCSageMakerRuntimeEndpointSecurityGroupFC2965AE",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.sagemaker.runtime",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCSageMakerRuntimeEndpointSecurityGroupFC2965AE": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/Shared/VPC/SageMakerRuntimeEndpoint/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "SharedVPCSecretsManagerEndpoint55576342": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPCSecretsManagerEndpointSecurityGroup3699366E",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.secretsmanager",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCSecretsManagerEndpointSecurityGroup3699366E": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/Shared/VPC/SecretsManagerEndpoint/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "SharedVPCStepFunctionsEndpoint3D9A9344": {
      "Properties": {
        "PrivateDnsEnabled": true,
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "SharedVPCStepFunctionsEndpointSecurityGroup4C10DF10",
              "GroupId",
            ],
          },
        ],
        "ServiceName": "com.amazonaws.us-east-1.states",
        "SubnetIds": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "VpcEndpointType": "Interface",
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCEndpoint",
    },
    "SharedVPCStepFunctionsEndpointSecurityGroup4C10DF10": {
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/Shared/VPC/StepFunctionsEndpoint/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1",
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "SharedVPCVPCGWA47152A6": {
      "Properties": {
        "InternetGatewayId": {
          "Ref": "SharedVPCIGW91FEB7EF",
        },
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::VPCGatewayAttachment",
    },
    "SharedVPCisolatedSubnet1RouteTableAssociation9FA2357F": {
      "Properties": {
        "RouteTableId": {
          "Ref": "SharedVPCisolatedSubnet1RouteTableFEE7065A",
        },
        "SubnetId": {
          "Ref": "SharedVPCisolatedSubnet1SubnetAE743C40",
        },
      },
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
    },
    "SharedVPCisolatedSubnet1RouteTableFEE7065A": {
      "Properties": {
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/isolatedSubnet1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::RouteTable",
    },
    "SharedVPCisolatedSubnet1SubnetAE743C40": {
      "Properties": {
        "AvailabilityZone": "dummy1a",
        "CidrBlock": "10.0.96.0/20",
        "MapPublicIpOnLaunch": false,
        "Tags": [
          {
            "Key": "aws-cdk:subnet-name",
            "Value": "isolated",
          },
          {
            "Key": "aws-cdk:subnet-type",
            "Value": "Isolated",
          },
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/isolatedSubnet1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::Subnet",
    },
    "SharedVPCisolatedSubnet2RouteTable661FCE70": {
      "Properties": {
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/isolatedSubnet2",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::RouteTable",
    },
    "SharedVPCisolatedSubnet2RouteTableAssociation61642BDD": {
      "Properties": {
        "RouteTableId": {
          "Ref": "SharedVPCisolatedSubnet2RouteTable661FCE70",
        },
        "SubnetId": {
          "Ref": "SharedVPCisolatedSubnet2SubnetBC723A26",
        },
      },
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
    },
    "SharedVPCisolatedSubnet2SubnetBC723A26": {
      "Properties": {
        "AvailabilityZone": "dummy1b",
        "CidrBlock": "10.0.112.0/20",
        "MapPublicIpOnLaunch": false,
        "Tags": [
          {
            "Key": "aws-cdk:subnet-name",
            "Value": "isolated",
          },
          {
            "Key": "aws-cdk:subnet-type",
            "Value": "Isolated",
          },
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/isolatedSubnet2",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::Subnet",
    },
    "SharedVPCisolatedSubnet3RouteTable3900DD68": {
      "Properties": {
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/isolatedSubnet3",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::RouteTable",
    },
    "SharedVPCisolatedSubnet3RouteTableAssociation985AF926": {
      "Properties": {
        "RouteTableId": {
          "Ref": "SharedVPCisolatedSubnet3RouteTable3900DD68",
        },
        "SubnetId": {
          "Ref": "SharedVPCisolatedSubnet3Subnet93F04F54",
        },
      },
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
    },
    "SharedVPCisolatedSubnet3Subnet93F04F54": {
      "Properties": {
        "AvailabilityZone": "dummy1c",
        "CidrBlock": "10.0.128.0/20",
        "MapPublicIpOnLaunch": false,
        "Tags": [
          {
            "Key": "aws-cdk:subnet-name",
            "Value": "isolated",
          },
          {
            "Key": "aws-cdk:subnet-type",
            "Value": "Isolated",
          },
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/isolatedSubnet3",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::Subnet",
    },
    "SharedVPCprivateSubnet1DefaultRoute608F3753": {
      "Properties": {
        "DestinationCidrBlock": "0.0.0.0/0",
        "NatGatewayId": {
          "Ref": "SharedVPCpublicSubnet1NATGateway5CEA2F2A",
        },
        "RouteTableId": {
          "Ref": "SharedVPCprivateSubnet1RouteTable58B60459",
        },
      },
      "Type": "AWS::EC2::Route",
    },
    "SharedVPCprivateSubnet1RouteTable58B60459": {
      "Properties": {
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/privateSubnet1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::RouteTable",
    },
    "SharedVPCprivateSubnet1RouteTableAssociation83D920FA": {
      "Properties": {
        "RouteTableId": {
          "Ref": "SharedVPCprivateSubnet1RouteTable58B60459",
        },
        "SubnetId": {
          "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
        },
      },
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
    },
    "SharedVPCprivateSubnet1Subnet5A4C2616": {
      "Properties": {
        "AvailabilityZone": "dummy1a",
        "CidrBlock": "10.0.48.0/20",
        "MapPublicIpOnLaunch": false,
        "Tags": [
          {
            "Key": "aws-cdk:subnet-name",
            "Value": "private",
          },
          {
            "Key": "aws-cdk:subnet-type",
            "Value": "Private",
          },
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/privateSubnet1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::Subnet",
    },
    "SharedVPCprivateSubnet2DefaultRoute4387C202": {
      "Properties": {
        "DestinationCidrBlock": "0.0.0.0/0",
        "NatGatewayId": {
          "Ref": "SharedVPCpublicSubnet1NATGateway5CEA2F2A",
        },
        "RouteTableId": {
          "Ref": "SharedVPCprivateSubnet2RouteTable36F07E09",
        },
      },
      "Type": "AWS::EC2::Route",
    },
    "SharedVPCprivateSubnet2RouteTable36F07E09": {
      "Properties": {
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/privateSubnet2",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::RouteTable",
    },
    "SharedVPCprivateSubnet2RouteTableAssociation6788E94C": {
      "Properties": {
        "RouteTableId": {
          "Ref": "SharedVPCprivateSubnet2RouteTable36F07E09",
        },
        "SubnetId": {
          "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
        },
      },
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
    },
    "SharedVPCprivateSubnet2SubnetF203CD06": {
      "Properties": {
        "AvailabilityZone": "dummy1b",
        "CidrBlock": "10.0.64.0/20",
        "MapPublicIpOnLaunch": false,
        "Tags": [
          {
            "Key": "aws-cdk:subnet-name",
            "Value": "private",
          },
          {
            "Key": "aws-cdk:subnet-type",
            "Value": "Private",
          },
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/privateSubnet2",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::Subnet",
    },
    "SharedVPCprivateSubnet3DefaultRoute3BBCF55F": {
      "Properties": {
        "DestinationCidrBlock": "0.0.0.0/0",
        "NatGatewayId": {
          "Ref": "SharedVPCpublicSubnet1NATGateway5CEA2F2A",
        },
        "RouteTableId": {
          "Ref": "SharedVPCprivateSubnet3RouteTable01E05852",
        },
      },
      "Type": "AWS::EC2::Route",
    },
    "SharedVPCprivateSubnet3RouteTable01E05852": {
      "Properties": {
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/privateSubnet3",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::RouteTable",
    },
    "SharedVPCprivateSubnet3RouteTableAssociation4181A59C": {
      "Properties": {
        "RouteTableId": {
          "Ref": "SharedVPCprivateSubnet3RouteTable01E05852",
        },
        "SubnetId": {
          "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
        },
      },
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
    },
    "SharedVPCprivateSubnet3SubnetB484AE12": {
      "Properties": {
        "AvailabilityZone": "dummy1c",
        "CidrBlock": "10.0.80.0/20",
        "MapPublicIpOnLaunch": false,
        "Tags": [
          {
            "Key": "aws-cdk:subnet-name",
            "Value": "private",
          },
          {
            "Key": "aws-cdk:subnet-type",
            "Value": "Private",
          },
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/privateSubnet3",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::Subnet",
    },
    "SharedVPCpublicSubnet1DefaultRouteC6B32517": {
      "DependsOn": [
        "SharedVPCVPCGWA47152A6",
      ],
      "Properties": {
        "DestinationCidrBlock": "0.0.0.0/0",
        "GatewayId": {
          "Ref": "SharedVPCIGW91FEB7EF",
        },
        "RouteTableId": {
          "Ref": "SharedVPCpublicSubnet1RouteTableCE49215C",
        },
      },
      "Type": "AWS::EC2::Route",
    },
    "SharedVPCpublicSubnet1EIPA9E2FC1C": {
      "Properties": {
        "Domain": "vpc",
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/publicSubnet1",
          },
        ],
      },
      "Type": "AWS::EC2::EIP",
    },
    "SharedVPCpublicSubnet1NATGateway5CEA2F2A": {
      "DependsOn": [
        "SharedVPCpublicSubnet1DefaultRouteC6B32517",
        "SharedVPCpublicSubnet1RouteTableAssociationB17F0447",
      ],
      "Properties": {
        "AllocationId": {
          "Fn::GetAtt": [
            "SharedVPCpublicSubnet1EIPA9E2FC1C",
            "AllocationId",
          ],
        },
        "SubnetId": {
          "Ref": "SharedVPCpublicSubnet1SubnetDA8AC0A0",
        },
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/publicSubnet1",
          },
        ],
      },
      "Type": "AWS::EC2::NatGateway",
    },
    "SharedVPCpublicSubnet1RouteTableAssociationB17F0447": {
      "Properties": {
        "RouteTableId": {
          "Ref": "SharedVPCpublicSubnet1RouteTableCE49215C",
        },
        "SubnetId": {
          "Ref": "SharedVPCpublicSubnet1SubnetDA8AC0A0",
        },
      },
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
    },
    "SharedVPCpublicSubnet1RouteTableCE49215C": {
      "Properties": {
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/publicSubnet1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::RouteTable",
    },
    "SharedVPCpublicSubnet1SubnetDA8AC0A0": {
      "Properties": {
        "AvailabilityZone": "dummy1a",
        "CidrBlock": "10.0.0.0/20",
        "MapPublicIpOnLaunch": true,
        "Tags": [
          {
            "Key": "aws-cdk:subnet-name",
            "Value": "public",
          },
          {
            "Key": "aws-cdk:subnet-type",
            "Value": "Public",
          },
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/publicSubnet1",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::Subnet",
    },
    "SharedVPCpublicSubnet2DefaultRouteCA89B67C": {
      "DependsOn": [
        "SharedVPCVPCGWA47152A6",
      ],
      "Properties": {
        "DestinationCidrBlock": "0.0.0.0/0",
        "GatewayId": {
          "Ref": "SharedVPCIGW91FEB7EF",
        },
        "RouteTableId": {
          "Ref": "SharedVPCpublicSubnet2RouteTableCF47EAD7",
        },
      },
      "Type": "AWS::EC2::Route",
    },
    "SharedVPCpublicSubnet2RouteTableAssociation1D77511F": {
      "Properties": {
        "RouteTableId": {
          "Ref": "SharedVPCpublicSubnet2RouteTableCF47EAD7",
        },
        "SubnetId": {
          "Ref": "SharedVPCpublicSubnet2SubnetC1B203C4",
        },
      },
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
    },
    "SharedVPCpublicSubnet2RouteTableCF47EAD7": {
      "Properties": {
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/publicSubnet2",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::RouteTable",
    },
    "SharedVPCpublicSubnet2SubnetC1B203C4": {
      "Properties": {
        "AvailabilityZone": "dummy1b",
        "CidrBlock": "10.0.16.0/20",
        "MapPublicIpOnLaunch": true,
        "Tags": [
          {
            "Key": "aws-cdk:subnet-name",
            "Value": "public",
          },
          {
            "Key": "aws-cdk:subnet-type",
            "Value": "Public",
          },
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/publicSubnet2",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::Subnet",
    },
    "SharedVPCpublicSubnet3DefaultRouteEF10F2F8": {
      "DependsOn": [
        "SharedVPCVPCGWA47152A6",
      ],
      "Properties": {
        "DestinationCidrBlock": "0.0.0.0/0",
        "GatewayId": {
          "Ref": "SharedVPCIGW91FEB7EF",
        },
        "RouteTableId": {
          "Ref": "SharedVPCpublicSubnet3RouteTableCE4F660A",
        },
      },
      "Type": "AWS::EC2::Route",
    },
    "SharedVPCpublicSubnet3RouteTableAssociation2F310BA6": {
      "Properties": {
        "RouteTableId": {
          "Ref": "SharedVPCpublicSubnet3RouteTableCE4F660A",
        },
        "SubnetId": {
          "Ref": "SharedVPCpublicSubnet3Subnet02BF43D5",
        },
      },
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
    },
    "SharedVPCpublicSubnet3RouteTableCE4F660A": {
      "Properties": {
        "Tags": [
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/publicSubnet3",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::RouteTable",
    },
    "SharedVPCpublicSubnet3Subnet02BF43D5": {
      "Properties": {
        "AvailabilityZone": "dummy1c",
        "CidrBlock": "10.0.32.0/20",
        "MapPublicIpOnLaunch": true,
        "Tags": [
          {
            "Key": "aws-cdk:subnet-name",
            "Value": "public",
          },
          {
            "Key": "aws-cdk:subnet-type",
            "Value": "Public",
          },
          {
            "Key": "Name",
            "Value": "prefixGenAIChatBotStack/Shared/VPC/publicSubnet3",
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::Subnet",
    },
    "SharedXOriginVerifySecret258B0376": {
      "DeletionPolicy": "Delete",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SMG4",
              "reason": "Secret is generated by CDK.",
            },
          ],
        },
      },
      "Properties": {
        "GenerateSecretString": {
          "ExcludePunctuation": true,
          "GenerateStringKey": "headerValue",
          "SecretStringTemplate": "{}",
        },
        "KmsKeyId": {
          "Fn::GetAtt": [
            "SharedKMSKey7BCBB616",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "UserInterfacePrivateWebsiteALB67ED856F": {
      "DependsOn": [
        "UserInterfacePrivateWebsiteALBLoggingBucketPolicyAAB72A21",
      ],
      "Properties": {
        "LoadBalancerAttributes": [
          {
            "Key": "deletion_protection.enabled",
            "Value": "false",
          },
          {
            "Key": "access_logs.s3.enabled",
            "Value": "true",
          },
          {
            "Key": "access_logs.s3.bucket",
            "Value": {
              "Ref": "UserInterfacePrivateWebsiteALBLoggingBucketA65ED627",
            },
          },
          {
            "Key": "access_logs.s3.prefix",
            "Value": "",
          },
        ],
        "Scheme": "internal",
        "SecurityGroups": [
          {
            "Fn::GetAtt": [
              "UserInterfacePrivateWebsiteWebsiteApplicationLoadBalancerSGA30AFFC0",
              "GroupId",
            ],
          },
        ],
        "Subnets": [
          {
            "Ref": "SharedVPCprivateSubnet1Subnet5A4C2616",
          },
          {
            "Ref": "SharedVPCprivateSubnet2SubnetF203CD06",
          },
          {
            "Ref": "SharedVPCprivateSubnet3SubnetB484AE12",
          },
        ],
        "Type": "application",
      },
      "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
    },
    "UserInterfacePrivateWebsiteALBLoggingBucketA65ED627": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-S1",
              "reason": "Bucket is the server access logs bucket for ALB.",
            },
          ],
        },
      },
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256",
              },
            },
          ],
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "VersioningConfiguration": {
          "Status": "Enabled",
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "UserInterfacePrivateWebsiteALBLoggingBucketPolicyAAB72A21": {
      "Properties": {
        "Bucket": {
          "Ref": "UserInterfacePrivateWebsiteALBLoggingBucketA65ED627",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "UserInterfacePrivateWebsiteALBLoggingBucketA65ED627",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "UserInterfacePrivateWebsiteALBLoggingBucketA65ED627",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "s3:PutObject",
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::127311923021:root",
                    ],
                  ],
                },
              },
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": [
                        "UserInterfacePrivateWebsiteALBLoggingBucketA65ED627",
                        "Arn",
                      ],
                    },
                    "/AWSLogs/111111111/*",
                  ],
                ],
              },
            },
            {
              "Action": "s3:PutObject",
              "Condition": {
                "StringEquals": {
                  "s3:x-amz-acl": "bucket-owner-full-control",
                },
              },
              "Effect": "Allow",
              "Principal": {
                "Service": "delivery.logs.amazonaws.com",
              },
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": [
                        "UserInterfacePrivateWebsiteALBLoggingBucketA65ED627",
                        "Arn",
                      ],
                    },
                    "/AWSLogs/111111111/*",
                  ],
                ],
              },
            },
            {
              "Action": "s3:GetBucketAcl",
              "Effect": "Allow",
              "Principal": {
                "Service": "delivery.logs.amazonaws.com",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "UserInterfacePrivateWebsiteALBLoggingBucketA65ED627",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "UserInterfacePrivateWebsiteDescribeNetworkInterfaces089E5C589": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "UserInterfacePrivateWebsiteDescribeNetworkInterfaces0CustomResourcePolicyC52D3C77",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"EC2","action":"describeNetworkInterfaces","outputPaths":["NetworkInterfaces.0.PrivateIpAddress"],"parameters":{"NetworkInterfaceIds":["",
              {
                "Fn::GetAtt": [
                  "UserInterfacePrivateWebsitedescribeVpcEndpoints7709ECA3",
                  "VpcEndpoints.0.NetworkInterfaceIds.0",
                ],
              },
              ""],"Filters":[{"Name":"interface-type","Values":["vpc_endpoint"]}]},"physicalResourceId":{"id":"describeNetworkInterfaces"}}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
        "Update": {
          "Fn::Join": [
            "",
            [
              "{"service":"EC2","action":"describeNetworkInterfaces","outputPaths":["NetworkInterfaces.0.PrivateIpAddress"],"parameters":{"NetworkInterfaceIds":["",
              {
                "Fn::GetAtt": [
                  "UserInterfacePrivateWebsitedescribeVpcEndpoints7709ECA3",
                  "VpcEndpoints.0.NetworkInterfaceIds.0",
                ],
              },
              ""],"Filters":[{"Name":"interface-type","Values":["vpc_endpoint"]}]},"physicalResourceId":{"id":"describeNetworkInterfaces"}}",
            ],
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "UserInterfacePrivateWebsiteDescribeNetworkInterfaces0CustomResourcePolicyC52D3C77": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "Custom Resource requires permissions to Describe VPC Endpoint Network Interfaces",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ec2:DescribeNetworkInterfaces",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "UserInterfacePrivateWebsiteDescribeNetworkInterfaces0CustomResourcePolicyC52D3C77",
        "Roles": [
          {
            "Ref": "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "UserInterfacePrivateWebsiteDescribeNetworkInterfaces137D039F8": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "UserInterfacePrivateWebsiteDescribeNetworkInterfaces1CustomResourcePolicy95274BAF",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"EC2","action":"describeNetworkInterfaces","outputPaths":["NetworkInterfaces.0.PrivateIpAddress"],"parameters":{"NetworkInterfaceIds":["",
              {
                "Fn::GetAtt": [
                  "UserInterfacePrivateWebsitedescribeVpcEndpoints7709ECA3",
                  "VpcEndpoints.0.NetworkInterfaceIds.1",
                ],
              },
              ""],"Filters":[{"Name":"interface-type","Values":["vpc_endpoint"]}]},"physicalResourceId":{"id":"describeNetworkInterfaces"}}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
        "Update": {
          "Fn::Join": [
            "",
            [
              "{"service":"EC2","action":"describeNetworkInterfaces","outputPaths":["NetworkInterfaces.0.PrivateIpAddress"],"parameters":{"NetworkInterfaceIds":["",
              {
                "Fn::GetAtt": [
                  "UserInterfacePrivateWebsitedescribeVpcEndpoints7709ECA3",
                  "VpcEndpoints.0.NetworkInterfaceIds.1",
                ],
              },
              ""],"Filters":[{"Name":"interface-type","Values":["vpc_endpoint"]}]},"physicalResourceId":{"id":"describeNetworkInterfaces"}}",
            ],
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "UserInterfacePrivateWebsiteDescribeNetworkInterfaces1CustomResourcePolicy95274BAF": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "Custom Resource requires permissions to Describe VPC Endpoint Network Interfaces",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ec2:DescribeNetworkInterfaces",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "UserInterfacePrivateWebsiteDescribeNetworkInterfaces1CustomResourcePolicy95274BAF",
        "Roles": [
          {
            "Ref": "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "UserInterfacePrivateWebsiteDescribeNetworkInterfaces2228C5108": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "UserInterfacePrivateWebsiteDescribeNetworkInterfaces2CustomResourcePolicyDB53E110",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"EC2","action":"describeNetworkInterfaces","outputPaths":["NetworkInterfaces.0.PrivateIpAddress"],"parameters":{"NetworkInterfaceIds":["",
              {
                "Fn::GetAtt": [
                  "UserInterfacePrivateWebsitedescribeVpcEndpoints7709ECA3",
                  "VpcEndpoints.0.NetworkInterfaceIds.2",
                ],
              },
              ""],"Filters":[{"Name":"interface-type","Values":["vpc_endpoint"]}]},"physicalResourceId":{"id":"describeNetworkInterfaces"}}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
        "Update": {
          "Fn::Join": [
            "",
            [
              "{"service":"EC2","action":"describeNetworkInterfaces","outputPaths":["NetworkInterfaces.0.PrivateIpAddress"],"parameters":{"NetworkInterfaceIds":["",
              {
                "Fn::GetAtt": [
                  "UserInterfacePrivateWebsitedescribeVpcEndpoints7709ECA3",
                  "VpcEndpoints.0.NetworkInterfaceIds.2",
                ],
              },
              ""],"Filters":[{"Name":"interface-type","Values":["vpc_endpoint"]}]},"physicalResourceId":{"id":"describeNetworkInterfaces"}}",
            ],
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "UserInterfacePrivateWebsiteDescribeNetworkInterfaces2CustomResourcePolicyDB53E110": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "Custom Resource requires permissions to Describe VPC Endpoint Network Interfaces",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ec2:DescribeNetworkInterfaces",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "UserInterfacePrivateWebsiteDescribeNetworkInterfaces2CustomResourcePolicyDB53E110",
        "Roles": [
          {
            "Ref": "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "UserInterfacePrivateWebsiteWebsiteApplicationLoadBalancerSGA30AFFC0": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-EC23",
              "reason": "Website Application Load Balancer can be open to 0.0.0.0/0 on ports 80 & 443.",
            },
          ],
        },
      },
      "Properties": {
        "GroupDescription": "prefixGenAIChatBotStack/UserInterface/PrivateWebsite/WebsiteApplicationLoadBalancerSG",
        "SecurityGroupEgress": [
          {
            "CidrIp": {
              "Fn::GetAtt": [
                "SharedVPC6716DA5E",
                "CidrBlock",
              ],
            },
            "Description": {
              "Fn::Join": [
                "",
                [
                  "from ",
                  {
                    "Fn::GetAtt": [
                      "SharedVPC6716DA5E",
                      "CidrBlock",
                    ],
                  },
                  ":443",
                ],
              ],
            },
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "from 0.0.0.0/0:443",
            "FromPort": 443,
            "IpProtocol": "tcp",
            "ToPort": 443,
          },
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "from 0.0.0.0/0:80",
            "FromPort": 80,
            "IpProtocol": "tcp",
            "ToPort": 80,
          },
        ],
        "VpcId": {
          "Ref": "SharedVPC6716DA5E",
        },
      },
      "Type": "AWS::EC2::SecurityGroup",
    },
    "UserInterfacePrivateWebsitedescribeVpcEndpoints7709ECA3": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "UserInterfacePrivateWebsitedescribeVpcEndpointsCustomResourcePolicy568C0242",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"EC2","action":"describeVpcEndpoints","parameters":{"Filters":[{"Name":"vpc-id","Values":["",
              {
                "Ref": "SharedVPC6716DA5E",
              },
              ""]},{"Name":"vpc-endpoint-type","Values":["Interface"]},{"Name":"service-name","Values":["com.amazonaws.us-east-1.s3"]}]},"physicalResourceId":{"id":"describeNetworkInterfaces"},"outputPaths":["VpcEndpoints.0"]}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
        "Update": {
          "Fn::Join": [
            "",
            [
              "{"service":"EC2","action":"describeVpcEndpoints","parameters":{"Filters":[{"Name":"vpc-id","Values":["",
              {
                "Ref": "SharedVPC6716DA5E",
              },
              ""]},{"Name":"vpc-endpoint-type","Values":["Interface"]},{"Name":"service-name","Values":["com.amazonaws.us-east-1.s3"]}]},"physicalResourceId":{"id":"describeNetworkInterfaces"},"outputPaths":["VpcEndpoints.0"]}",
            ],
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "UserInterfacePrivateWebsitedescribeVpcEndpointsCustomResourcePolicy568C0242": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-IAM5",
              "reason": "Custom Resource requires permissions to Describe VPC Endpoint Network Interfaces",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "ec2:DescribeVpcEndpoints",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "UserInterfacePrivateWebsitedescribeVpcEndpointsCustomResourcePolicy568C0242",
        "Roles": [
          {
            "Ref": "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "UserInterfaceUserInterfaceDeploymentAwsCliLayerDB546DB8": {
      "Properties": {
        "Content": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111-us-east-1",
          "S3Key": "Dummy",
        },
        "Description": "/opt/awscli/aws",
      },
      "Type": "AWS::Lambda::LayerVersion",
    },
    "UserInterfaceUserInterfaceDeploymentCustomResource05D90D2B": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "DestinationBucketName": {
          "Ref": "UserInterfaceWebsiteBucket2BDEA247",
        },
        "Prune": false,
        "ServiceToken": {
          "Fn::GetAtt": [
            "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C81C01536",
            "Arn",
          ],
        },
        "SourceBucketNames": [
          "cdk-hnb659fds-assets-111111111-us-east-1",
          "cdk-hnb659fds-assets-111111111-us-east-1",
        ],
        "SourceMarkers": [
          {},
          {
            "<<marker:0xbaba:0>>": {
              "Ref": "AWS::Region",
            },
            "<<marker:0xbaba:1>>": {
              "Ref": "AWS::Region",
            },
            "<<marker:0xbaba:2>>": {
              "Ref": "AuthenticationUserPool28698864",
            },
            "<<marker:0xbaba:3>>": {
              "Ref": "AuthenticationUserPoolUserPoolClient8AE1704E",
            },
            "<<marker:0xbaba:4>>": {
              "Ref": "AWS::Region",
            },
            "<<marker:0xbaba:5>>": {
              "Ref": "AuthenticationUserPool28698864",
            },
            "<<marker:0xbaba:6>>": {
              "Ref": "AuthenticationUserPoolUserPoolClient8AE1704E",
            },
            "<<marker:0xbaba:7>>": {
              "Fn::GetAtt": [
                "ChatBotApiChatbotApiBABF9B87",
                "GraphQLUrl",
              ],
            },
            "<<marker:0xbaba:8>>": {
              "Ref": "AWS::Region",
            },
          },
        ],
        "SourceObjectKeys": [
          "Dummy",
        ],
      },
      "Type": "Custom::CDKBucketDeployment",
      "UpdateReplacePolicy": "Delete",
    },
    "UserInterfaceWebsiteBucket2BDEA247": {
      "DeletionPolicy": "Delete",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-S5",
              "reason": "Bucket has conditions to only allow access from S3 VPC Endpoints.",
            },
          ],
        },
      },
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256",
              },
            },
          ],
        },
        "LoggingConfiguration": {
          "DestinationBucketName": {
            "Ref": "UserInterfaceWebsiteLogsBucket54728780",
          },
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "Tags": [
          {
            "Key": "aws-cdk:auto-delete-objects",
            "Value": "true",
          },
          {
            "Key": "aws-cdk:cr-owned:5e688ffc",
            "Value": "true",
          },
        ],
        "VersioningConfiguration": {
          "Status": "Enabled",
        },
        "WebsiteConfiguration": {
          "ErrorDocument": "index.html",
          "IndexDocument": "index.html",
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Delete",
    },
    "UserInterfaceWebsiteBucketAutoDeleteObjectsCustomResourceD0AC653B": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "UserInterfaceWebsiteBucketPolicyEE27C04B",
      ],
      "Properties": {
        "BucketName": {
          "Ref": "UserInterfaceWebsiteBucket2BDEA247",
        },
        "ServiceToken": {
          "Fn::GetAtt": [
            "CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F",
            "Arn",
          ],
        },
      },
      "Type": "Custom::S3AutoDeleteObjects",
      "UpdateReplacePolicy": "Delete",
    },
    "UserInterfaceWebsiteBucketPolicyEE27C04B": {
      "Properties": {
        "Bucket": {
          "Ref": "UserInterfaceWebsiteBucket2BDEA247",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "UserInterfaceWebsiteBucket2BDEA247",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "UserInterfaceWebsiteBucket2BDEA247",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "s3:PutBucketPolicy",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
              ],
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::GetAtt": [
                    "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092",
                    "Arn",
                  ],
                },
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "UserInterfaceWebsiteBucket2BDEA247",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "UserInterfaceWebsiteBucket2BDEA247",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "s3:GetObject",
                "s3:List*",
              ],
              "Condition": {
                "StringEquals": {
                  "aws:SourceVpce": {
                    "Fn::GetAtt": [
                      "UserInterfacePrivateWebsitedescribeVpcEndpoints7709ECA3",
                      "VpcEndpoints.0.VpcEndpointId",
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "UserInterfaceWebsiteBucket2BDEA247",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "UserInterfaceWebsiteBucket2BDEA247",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "UserInterfaceWebsiteLogsBucket54728780": {
      "DeletionPolicy": "RetainExceptOnCreate",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-S1",
              "reason": "Bucket is the server access logs bucket for websiteBucket.",
            },
          ],
        },
      },
      "Properties": {
        "AccessControl": "LogDeliveryWrite",
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256",
              },
            },
          ],
        },
        "OwnershipControls": {
          "Rules": [
            {
              "ObjectOwnership": "ObjectWriter",
            },
          ],
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "VersioningConfiguration": {
          "Status": "Enabled",
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "UserInterfaceWebsiteLogsBucketPolicyB99816BB": {
      "Properties": {
        "Bucket": {
          "Ref": "UserInterfaceWebsiteLogsBucket54728780",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "UserInterfaceWebsiteLogsBucket54728780",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "UserInterfaceWebsiteLogsBucket54728780",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;
